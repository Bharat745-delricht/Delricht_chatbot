{
  "test_run_id": "test_run_2025-12-16_07-16-43",
  "timestamp": "2025-12-16T07:16:43.015942",
  "configuration": {
    "api_base_url": "https://gemini-chatbot-480267397633.us-central1.run.app",
    "num_tests": 50,
    "parallel": 5,
    "timeout": 120,
    "save_reports": true,
    "report_dir": "automated_testing/reports"
  },
  "summary": {
    "total_tests": 10,
    "passed": 0,
    "failed": 10,
    "pass_rate": 0.0,
    "average_overall_score": 57.8,
    "average_response_time": 24.382640698714688
  },
  "metrics": {
    "crash_prevention": {
      "average_score": 90.0,
      "passed": 9,
      "failed": 1
    },
    "eligibility_accuracy": {
      "average_score": 0.0,
      "passed": 0,
      "failed": 10
    },
    "conversation_quality": {
      "average_score": 61.5,
      "passed": 6,
      "failed": 4
    },
    "edge_case_handling": {
      "average_score": 75.0,
      "applicable_tests": 2,
      "passed": 9
    },
    "performance": {
      "average_response_time": 24.382640698714688,
      "passed": 1
    }
  },
  "failure_summary": {
    "total_failures": 59,
    "by_type": {
      "eligibility_logic_error": 10,
      "performance_issue": 9,
      "conversation_quality_issue": 38,
      "crash": 1,
      "edge_case_handling_failure": 1
    }
  },
  "failures": [
    {
      "test_id": "AUTO_TEST_random_001",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Bipolar Depression"
        ],
        "medications": [
          "Valproate",
          "Lamotrigine",
          "Lithium"
        ]
      },
      "type": "eligibility_logic_error",
      "reason": "No eligibility determination found in conversation",
      "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
      "severity": "high"
    },
    {
      "test_id": "AUTO_TEST_random_001",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Bipolar Depression"
        ],
        "medications": [
          "Valproate",
          "Lamotrigine",
          "Lithium"
        ]
      },
      "type": "performance_issue",
      "avg_response_time": 22.80364578962326,
      "max_response_time": 27.725183963775635,
      "severity": "low",
      "recommendation": "Investigate slow API responses or Gemini API delays"
    },
    {
      "test_id": "AUTO_TEST_random_002",
      "patient_profile": {
        "age": 25,
        "conditions": [
          "Hidradenitis Suppurativa"
        ],
        "medications": [
          "Antibiotics",
          "Spironolactone"
        ]
      },
      "type": "eligibility_logic_error",
      "reason": "No eligibility determination found in conversation",
      "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
      "severity": "high"
    },
    {
      "test_id": "AUTO_TEST_random_002",
      "patient_profile": {
        "age": 25,
        "conditions": [
          "Hidradenitis Suppurativa"
        ],
        "medications": [
          "Antibiotics",
          "Spironolactone"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Too few questions asked (0, expected at least 4)",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_random_002",
      "patient_profile": {
        "age": 25,
        "conditions": [
          "Hidradenitis Suppurativa"
        ],
        "medications": [
          "Antibiotics",
          "Spironolactone"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Hidradenitis Suppur...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_random_002",
      "patient_profile": {
        "age": 25,
        "conditions": [
          "Hidradenitis Suppurativa"
        ],
        "medications": [
          "Antibiotics",
          "Spironolactone"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Hidradenitis Suppur...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_random_002",
      "patient_profile": {
        "age": 25,
        "conditions": [
          "Hidradenitis Suppurativa"
        ],
        "medications": [
          "Antibiotics",
          "Spironolactone"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Hidradenitis Suppur...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_random_002",
      "patient_profile": {
        "age": 25,
        "conditions": [
          "Hidradenitis Suppurativa"
        ],
        "medications": [
          "Antibiotics",
          "Spironolactone"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Hidradenitis Suppur...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_random_002",
      "patient_profile": {
        "age": 25,
        "conditions": [
          "Hidradenitis Suppurativa"
        ],
        "medications": [
          "Antibiotics",
          "Spironolactone"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Hidradenitis Suppur...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_random_002",
      "patient_profile": {
        "age": 25,
        "conditions": [
          "Hidradenitis Suppurativa"
        ],
        "medications": [
          "Antibiotics",
          "Spironolactone"
        ]
      },
      "type": "performance_issue",
      "avg_response_time": 31.23820964495341,
      "max_response_time": 58.03314208984375,
      "severity": "low",
      "recommendation": "Investigate slow API responses or Gemini API delays"
    },
    {
      "test_id": "AUTO_TEST_random_000",
      "patient_profile": {
        "age": 26,
        "conditions": [
          "Type 2 Diabetes"
        ],
        "medications": [
          "Ozempic",
          "Glipizide"
        ]
      },
      "type": "eligibility_logic_error",
      "reason": "No eligibility determination found in conversation",
      "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
      "severity": "high"
    },
    {
      "test_id": "AUTO_TEST_random_000",
      "patient_profile": {
        "age": 26,
        "conditions": [
          "Type 2 Diabetes"
        ],
        "medications": [
          "Ozempic",
          "Glipizide"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Too few questions asked (0, expected at least 4)",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_random_000",
      "patient_profile": {
        "age": 26,
        "conditions": [
          "Type 2 Diabetes"
        ],
        "medications": [
          "Ozempic",
          "Glipizide"
        ]
      },
      "type": "performance_issue",
      "avg_response_time": 25.078229784965515,
      "max_response_time": 31.128626823425293,
      "severity": "low",
      "recommendation": "Investigate slow API responses or Gemini API delays"
    },
    {
      "test_id": "AUTO_TEST_targeted_diabetes_001",
      "patient_profile": {
        "age": 39,
        "conditions": [
          "Type 2 Diabetes",
          "Hypertension"
        ],
        "medications": [
          "Metformin",
          "Lisinopril"
        ]
      },
      "type": "eligibility_logic_error",
      "reason": "No eligibility determination found in conversation",
      "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
      "severity": "high"
    },
    {
      "test_id": "AUTO_TEST_targeted_diabetes_001",
      "patient_profile": {
        "age": 39,
        "conditions": [
          "Type 2 Diabetes",
          "Hypertension"
        ],
        "medications": [
          "Metformin",
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Too few questions asked (0, expected at least 5)",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_diabetes_001",
      "patient_profile": {
        "age": 39,
        "conditions": [
          "Type 2 Diabetes",
          "Hypertension"
        ],
        "medications": [
          "Metformin",
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Type 2 Diabetes in ...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_diabetes_001",
      "patient_profile": {
        "age": 39,
        "conditions": [
          "Type 2 Diabetes",
          "Hypertension"
        ],
        "medications": [
          "Metformin",
          "Lisinopril"
        ]
      },
      "type": "performance_issue",
      "avg_response_time": 24.071881818771363,
      "max_response_time": 39.845991134643555,
      "severity": "low",
      "recommendation": "Investigate slow API responses or Gemini API delays"
    },
    {
      "test_id": "AUTO_TEST_targeted_psoriasis_000",
      "patient_profile": {
        "age": 35,
        "conditions": [
          "Plaque Psoriasis"
        ],
        "medications": [
          "Topical Corticosteroids"
        ]
      },
      "type": "eligibility_logic_error",
      "reason": "No eligibility determination found in conversation",
      "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
      "severity": "high"
    },
    {
      "test_id": "AUTO_TEST_targeted_psoriasis_000",
      "patient_profile": {
        "age": 35,
        "conditions": [
          "Plaque Psoriasis"
        ],
        "medications": [
          "Topical Corticosteroids"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Too few questions asked (0, expected at least 4)",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_psoriasis_000",
      "patient_profile": {
        "age": 35,
        "conditions": [
          "Plaque Psoriasis"
        ],
        "medications": [
          "Topical Corticosteroids"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Psoriasis in Memphi...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_psoriasis_000",
      "patient_profile": {
        "age": 35,
        "conditions": [
          "Plaque Psoriasis"
        ],
        "medications": [
          "Topical Corticosteroids"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Psoriasis in Memphi...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_psoriasis_000",
      "patient_profile": {
        "age": 35,
        "conditions": [
          "Plaque Psoriasis"
        ],
        "medications": [
          "Topical Corticosteroids"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Psoriasis in Memphi...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_psoriasis_000",
      "patient_profile": {
        "age": 35,
        "conditions": [
          "Plaque Psoriasis"
        ],
        "medications": [
          "Topical Corticosteroids"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Psoriasis in Memphi...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_psoriasis_000",
      "patient_profile": {
        "age": 35,
        "conditions": [
          "Plaque Psoriasis"
        ],
        "medications": [
          "Topical Corticosteroids"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Psoriasis in Memphi...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_psoriasis_000",
      "patient_profile": {
        "age": 35,
        "conditions": [
          "Plaque Psoriasis"
        ],
        "medications": [
          "Topical Corticosteroids"
        ]
      },
      "type": "performance_issue",
      "avg_response_time": 25.86096236922524,
      "max_response_time": 50.923035860061646,
      "severity": "low",
      "recommendation": "Investigate slow API responses or Gemini API delays"
    },
    {
      "test_id": "AUTO_TEST_edge_contradictory_000",
      "patient_profile": {
        "age": 45,
        "conditions": [],
        "medications": [
          "Metformin",
          "Insulin"
        ]
      },
      "type": "crash",
      "error_type": "conversation_failure",
      "error_message": "maximum recursion depth exceeded",
      "likely_location": "Unknown - check full error trace",
      "severity": "critical"
    },
    {
      "test_id": "AUTO_TEST_edge_contradictory_000",
      "patient_profile": {
        "age": 45,
        "conditions": [],
        "medications": [
          "Metformin",
          "Insulin"
        ]
      },
      "type": "eligibility_logic_error",
      "reason": "Prescreening flow did not complete",
      "final_state": "failed",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
      "severity": "high"
    },
    {
      "test_id": "AUTO_TEST_edge_contradictory_000",
      "patient_profile": {
        "age": 45,
        "conditions": [],
        "medications": [
          "Metformin",
          "Insulin"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Too few questions asked (0, expected at least 4)",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_edge_contradictory_000",
      "patient_profile": {
        "age": 45,
        "conditions": [],
        "medications": [
          "Metformin",
          "Insulin"
        ]
      },
      "type": "edge_case_handling_failure",
      "edge_case_type": "contradictory_info",
      "final_state": "failed",
      "reason": "Edge case caused conversation to fail",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_edge_contradictory_000",
      "patient_profile": {
        "age": 45,
        "conditions": [],
        "medications": [
          "Metformin",
          "Insulin"
        ]
      },
      "type": "performance_issue",
      "avg_response_time": 21.279089331626892,
      "max_response_time": 25.482574701309204,
      "severity": "low",
      "recommendation": "Investigate slow API responses or Gemini API delays"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "eligibility_logic_error",
      "reason": "No eligibility determination found in conversation",
      "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
      "severity": "high"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Too few questions asked (0, expected at least 5)",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "age": 44,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_psoriasis_003",
      "patient_profile": {
        "age": 55,
        "conditions": [
          "Plaque Psoriasis"
        ],
        "medications": [
          "Topical Corticosteroids"
        ]
      },
      "type": "eligibility_logic_error",
      "reason": "No eligibility determination found in conversation",
      "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
      "severity": "high"
    },
    {
      "test_id": "AUTO_TEST_targeted_psoriasis_003",
      "patient_profile": {
        "age": 55,
        "conditions": [
          "Plaque Psoriasis"
        ],
        "medications": [
          "Topical Corticosteroids"
        ]
      },
      "type": "performance_issue",
      "avg_response_time": 28.048428575197857,
      "max_response_time": 45.08895492553711,
      "severity": "low",
      "recommendation": "Investigate slow API responses or Gemini API delays"
    },
    {
      "test_id": "AUTO_TEST_random_003",
      "patient_profile": {
        "age": 66,
        "conditions": [
          "Gout"
        ],
        "medications": [
          "Colchicine"
        ]
      },
      "type": "eligibility_logic_error",
      "reason": "No eligibility determination found in conversation",
      "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
      "severity": "high"
    },
    {
      "test_id": "AUTO_TEST_random_003",
      "patient_profile": {
        "age": 66,
        "conditions": [
          "Gout"
        ],
        "medications": [
          "Colchicine"
        ]
      },
      "type": "performance_issue",
      "avg_response_time": 20.052056431770325,
      "max_response_time": 21.55542778968811,
      "severity": "low",
      "recommendation": "Investigate slow API responses or Gemini API delays"
    },
    {
      "test_id": "AUTO_TEST_edge_multimorbid_001",
      "patient_profile": {
        "age": 56,
        "conditions": [
          "Plaque Psoriasis",
          "Gout",
          "Androgenetic Alopecia",
          "Major Depressive Disorder",
          "Acne Vulgaris"
        ],
        "medications": [
          "Allopurinol",
          "Escitalopram",
          "Biotin",
          "Biologics",
          "Probenecid"
        ]
      },
      "type": "eligibility_logic_error",
      "reason": "No eligibility determination found in conversation",
      "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
      "severity": "high"
    },
    {
      "test_id": "AUTO_TEST_edge_multimorbid_001",
      "patient_profile": {
        "age": 56,
        "conditions": [
          "Plaque Psoriasis",
          "Gout",
          "Androgenetic Alopecia",
          "Major Depressive Disorder",
          "Acne Vulgaris"
        ],
        "medications": [
          "Allopurinol",
          "Escitalopram",
          "Biotin",
          "Biologics",
          "Probenecid"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Too few questions asked (4, expected at least 5)",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_edge_multimorbid_001",
      "patient_profile": {
        "age": 56,
        "conditions": [
          "Plaque Psoriasis",
          "Gout",
          "Androgenetic Alopecia",
          "Major Depressive Disorder",
          "Acne Vulgaris"
        ],
        "medications": [
          "Allopurinol",
          "Escitalopram",
          "Biotin",
          "Biologics",
          "Probenecid"
        ]
      },
      "type": "performance_issue",
      "avg_response_time": 27.185002009073894,
      "max_response_time": 37.862247943878174,
      "severity": "low",
      "recommendation": "Investigate slow API responses or Gemini API delays"
    }
  ],
  "detailed_results": [
    {
      "patient_id": "AUTO_TEST_random_001",
      "patient_profile": {
        "patient_id": "AUTO_TEST_random_001",
        "profile_type": "random",
        "demographics": {
          "age": 44,
          "gender": "non-binary",
          "location": "Jackson, MS",
          "name": "Karen Davis",
          "first_name": "Karen",
          "last_name": "Davis"
        },
        "medical_history": {
          "primary_condition": "Bipolar Depression",
          "conditions": [
            "Bipolar Depression"
          ],
          "medications": [
            "Valproate",
            "Lamotrigine",
            "Lithium"
          ],
          "duration_years": 5
        },
        "expected_behavior": {
          "should_find_trials": true,
          "likely_eligible": true,
          "expected_question_count_range": [
            4,
            8
          ]
        }
      },
      "conversation_result": {
        "session_id": "AUTO_TEST_random_001",
        "patient_id": "AUTO_TEST_random_001",
        "conversation_log": [
          {
            "user_message": "Bipolar Depression trials in Jackson, MS",
            "bot_response": "I couldn't find any trials for Bipolar Depression in Jackson, MS at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_random_001",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Bipolar Depression",
                "location": "Jackson",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Bipolar Depression",
                  "location": "Jackson, MS"
                },
                "response_text": "Of course, I can help with that. Let's switch gears and look for clinical trials for Bipolar Depression in the Jackson, MS area. One moment while I search for you.",
                "new_state": "trials_found",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided a new condition and location, indicating a clear intent to start a new search. This overrides the current `prescreening_active` state for a different condition. The best action is to fulfill their explicit request by performing a new trial search with the provided information. The response acknowledges the context switch and confirms the new search parameters before initiating the search."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Bipolar Depression",
              "location": "Jackson, MS"
            },
            "response_time": 19.796962022781372,
            "timestamp": "2025-12-16T06:55:06.027585"
          },
          {
            "user_message": "Yes, check my eligibility",
            "bot_response": "Great! I'll help you check your eligibility.\n\nI need to ask you a few questions about the bipolar depression trial.\n\n**Question 1 of 4:** How old were you when this condition first started?",
            "metadata": {
              "session_id": "AUTO_TEST_random_001",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "start_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": "yes",
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "start_prescreening",
                "parameters": {},
                "response_text": "Of course. I can help with a preliminary eligibility check. I'll ask a few simple questions based on the common requirements for Bipolar Depression trials. Please remember, this is just a first step and not a guarantee of eligibility.\n\nTo start, could you please tell me your age?",
                "new_state": "prescreening",
                "collect_entities": [
                  "age"
                ],
                "metadata": {
                  "reasoning": "The user has explicitly confirmed their desire to check eligibility ('Yes, check my eligibility'). The conversation context indicates we have the necessary condition and location to have already presented trials. Therefore, the most appropriate action is to begin the prescreening process. The response acknowledges their request, sets expectations that this is a preliminary check, and asks the first common eligibility question (age) to move the process forward. The state is transitioned to 'prescreening' to reflect this new stage of the conversation."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "prescreening_started": true,
              "trial_id": 112,
              "trial_name": "A Phase 3, Randomized, Double-blind, Placebo-Controlled, Multicenter Study to Evaluate the Efficacy and Safety of Investigational Product in Depressive Episodes Associated With Bipolar I or II Disorder (Bipolar Depression)",
              "current_question_index": 0,
              "total_questions": 4,
              "current_question": "How old were you when this condition first started?",
              "expected_answer_type": "number"
            },
            "response_time": 27.725183963775635,
            "timestamp": "2025-12-16T06:55:33.753538"
          },
          {
            "user_message": "44",
            "bot_response": "Got it.\n\nHow many episodes have you had in the past 12 months?",
            "metadata": {
              "session_id": "AUTO_TEST_random_001",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "continue_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": 44,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "continue_prescreening",
                "parameters": {
                  "answered_question": "age_of_onset",
                  "value": 44
                },
                "response_text": "Okay, thank you for sharing that. Just a couple more questions. Are you currently taking any medication for Bipolar Depression?",
                "new_state": "prescreening_active",
                "collect_entities": [
                  "boolean_answer"
                ],
                "metadata": {
                  "reasoning": "The user is in an active prescreening flow and has provided their age in response to the previous question. The correct action is to acknowledge their answer and proceed with the next question in the prescreening script to continue determining their potential eligibility. The state remains 'prescreening_active' as the process is not yet complete. The next question is a yes/no question, so we will be looking for a boolean answer."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "current_question_index": 1,
              "total_questions": 4,
              "current_question": "How many episodes have you had in the past 12 months?",
              "expected_answer_type": "yes_no",
              "parsed_answer": {
                "interpretation": "number",
                "confidence": 1.0
              }
            },
            "response_time": 26.047570943832397,
            "timestamp": "2025-12-16T06:55:59.801859"
          },
          {
            "user_message": "3",
            "bot_response": "I couldn't determine if your answer is yes or no. Could you please respond with 'yes' or 'no'?\n\nPlease answer: 'yes' or 'no'",
            "metadata": {
              "session_id": "AUTO_TEST_random_001",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "continue_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": 3,
                "medication": null,
                "number": 3,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "continue_prescreening",
                "parameters": {},
                "response_text": "Okay, thank you for sharing that. Just a couple more questions. Are you currently taking any medication for Bipolar Depression?",
                "new_state": "prescreening_active",
                "collect_entities": [
                  "boolean_answer"
                ],
                "metadata": {
                  "reasoning": "The user is in an active prescreening session and has provided a direct numerical answer to the previous question. The correct action is to continue the prescreening process by acknowledging their answer and asking the next logical eligibility question. The state remains 'prescreening_active' as the screening is not yet complete."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "validation_error": true,
              "awaiting_correction": true,
              "current_question_index": 1
            },
            "response_time": 17.644866228103638,
            "timestamp": "2025-12-16T06:56:17.447397"
          }
        ],
        "final_state": "completed",
        "total_turns": 4,
        "total_questions_asked": 4,
        "errors": [
          {
            "type": "unexpected_state",
            "bot_response": "I couldn't determine if your answer is yes or no. Could you please respond with 'yes' or 'no'?\n\nPlease answer: 'yes' or 'no'"
          }
        ]
      },
      "validation": {
        "passed": false,
        "overall_score": 70.0,
        "crash_prevention": {
          "passed": true,
          "score": 100.0,
          "error_count": 0,
          "errors": [],
          "failures": []
        },
        "eligibility_accuracy": {
          "passed": false,
          "score": 0.0,
          "reason": "Could not extract eligibility result",
          "failures": [
            {
              "type": "eligibility_logic_error",
              "reason": "No eligibility determination found in conversation",
              "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
              "severity": "high"
            }
          ]
        },
        "conversation_quality": {
          "passed": true,
          "score": 100.0,
          "total_questions_asked": 4,
          "issues": [],
          "failures": []
        },
        "edge_case_handling": {
          "passed": true,
          "score": 100.0,
          "applicable": false,
          "failures": []
        },
        "performance": {
          "passed": false,
          "score": 40.0,
          "avg_response_time": 22.80364578962326,
          "max_response_time": 27.725183963775635,
          "status": "slow",
          "failures": [
            {
              "type": "performance_issue",
              "avg_response_time": 22.80364578962326,
              "max_response_time": 27.725183963775635,
              "severity": "low",
              "recommendation": "Investigate slow API responses or Gemini API delays"
            }
          ]
        },
        "failure_points": [
          {
            "type": "eligibility_logic_error",
            "reason": "No eligibility determination found in conversation",
            "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
            "severity": "high"
          },
          {
            "type": "performance_issue",
            "avg_response_time": 22.80364578962326,
            "max_response_time": 27.725183963775635,
            "severity": "low",
            "recommendation": "Investigate slow API responses or Gemini API delays"
          }
        ],
        "recommendations": [
          "\u26a0\ufe0f HIGH: Review eligibility evaluation logic in gemini_prescreening_manager.py",
          "\u2139\ufe0f LOW: Slow response times. Optimize API calls or consider caching."
        ]
      },
      "timestamp": "2025-12-16T06:56:17.447676"
    },
    {
      "patient_id": "AUTO_TEST_random_002",
      "patient_profile": {
        "patient_id": "AUTO_TEST_random_002",
        "profile_type": "random",
        "demographics": {
          "age": 25,
          "gender": "male",
          "location": "Birmingham, AL",
          "name": "Michael Jones",
          "first_name": "Michael",
          "last_name": "Jones"
        },
        "medical_history": {
          "primary_condition": "Hidradenitis Suppurativa",
          "conditions": [
            "Hidradenitis Suppurativa"
          ],
          "medications": [
            "Antibiotics",
            "Spironolactone"
          ],
          "duration_years": 2
        },
        "expected_behavior": {
          "should_find_trials": true,
          "likely_eligible": true,
          "expected_question_count_range": [
            4,
            8
          ]
        }
      },
      "conversation_result": {
        "session_id": "AUTO_TEST_random_002",
        "patient_id": "AUTO_TEST_random_002",
        "conversation_log": [
          {
            "user_message": "Hidradenitis Suppurativa trials in Birmingham, AL",
            "bot_response": "I couldn't find any trials for Hidradenitis Suppurativa in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_random_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Hidradenitis Suppurativa",
                "location": "Birmingham",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Hidradenitis Suppurativa",
                  "location": "Birmingham, AL"
                },
                "response_text": "Of course. Living with Hidradenitis Suppurativa can be challenging, and it's great that you're exploring potential new treatment options. I'll search for clinical trials in the Birmingham, Alabama area for you now. One moment...",
                "new_state": "awaiting_search_results",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both a specific condition ('Hidradenitis Suppurativa') and a location ('Birmingham, AL'). According to the action guidelines, the `search_trials` action is appropriate when both pieces of information are available. The response confirms the user's request, offers empathy, and sets the expectation that a search is being performed, transitioning the state to `awaiting_search_results`."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Hidradenitis Suppurativa",
              "location": "Birmingham, AL"
            },
            "response_time": 19.036580801010132,
            "timestamp": "2025-12-16T06:55:05.267860"
          },
          {
            "user_message": "Yes, check my eligibility",
            "bot_response": "I couldn't find any trials for Hidradenitis Suppurativa in Birmingham at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_random_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": "yes",
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Hidradenitis Suppurativa",
                  "location": "Birmingham"
                },
                "response_text": "Great, I can definitely help with that. First, I'll search for Hidradenitis Suppurativa trials happening near Birmingham. Once we have some results, I can ask you a few questions to see if you might be a good match for any of them. Searching now...",
                "new_state": "trials_found",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has confirmed they want to check eligibility. Before we can start a prescreening process, we must first find relevant trials. Since we have both the user's condition and location, the correct next action is to `search_trials`. The response confirms the user's request, explains the process (search first, then prescreen), and initiates the search, setting clear expectations for the next step."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Hidradenitis Suppurativa",
              "location": "Birmingham"
            },
            "response_time": 18.23425030708313,
            "timestamp": "2025-12-16T06:55:23.502400"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Hidradenitis Suppurativa in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_random_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Hidradenitis Suppurativa",
                  "location": "Birmingham, AL"
                },
                "response_text": "Perfect, thank you for confirming. I have what I need to look for Hidradenitis Suppurativa trials in the Birmingham, AL area. Please give me a moment to search.",
                "new_state": "trials_found",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided their location, 'Birmingham, AL', which was the final piece of information needed to perform a search. We already have their condition, 'Hidradenitis Suppurativa', from the conversation context. Therefore, the most appropriate and helpful action is to execute the `search_trials` action to fulfill the user's primary request."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Hidradenitis Suppurativa",
              "location": "Birmingham, AL"
            },
            "response_time": 27.020305156707764,
            "timestamp": "2025-12-16T06:55:50.523858"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Hidradenitis Suppurativa in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_random_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Hidradenitis Suppurativa",
                  "location": "Birmingham, AL"
                },
                "response_text": "Perfect, thank you for confirming. I'm now searching for clinical trials for Hidradenitis Suppurativa in the Birmingham, AL area. Please give me just a moment to find the most relevant options for you.",
                "new_state": "trials_found",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both their condition (Hidradenitis Suppurativa from the context) and location (Birmingham, AL). The user's message is a confirmation of their location, indicating they are ready for the search to proceed. The `search_trials` action is the most direct and helpful next step to meet the user's goal, as all necessary information has been collected."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Hidradenitis Suppurativa",
              "location": "Birmingham, AL"
            },
            "response_time": 22.638535022735596,
            "timestamp": "2025-12-16T06:56:13.163315"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "Thanks for confirming Birmingham, AL. I did search that area for Hidradenitis Suppurativa trials, but unfortunately, it looks like there aren't any active studies right in the city at the moment.\n\nI'd be happy to broaden the search for you. We could look at trials across the entire state of Alabama or check for any remote trials you could participate in from home.\n\nWould you like me to try either of those options?",
            "metadata": {
              "session_id": "AUTO_TEST_random_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "general_response",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "general_response",
                "parameters": {},
                "response_text": "Thanks for confirming Birmingham, AL. I did search that area for Hidradenitis Suppurativa trials, but unfortunately, it looks like there aren't any active studies right in the city at the moment.\n\nI'd be happy to broaden the search for you. We could look at trials across the entire state of Alabama or check for any remote trials you could participate in from home.\n\nWould you like me to try either of those options?",
                "new_state": "awaiting_search_modification",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has repeated their location after a previous search for 'Hidradenitis Suppurativa' in 'Birmingham, AL' yielded no results. Performing the same search again would create a frustrating conversational loop. The best action is to acknowledge their input, clearly state that no trials were found in that specific location, and proactively offer helpful alternatives. This response proposes expanding the search radius or looking for remote trials, which empowers the user and moves the conversation forward constructively."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "general_response": true
            },
            "response_time": 24.037919998168945,
            "timestamp": "2025-12-16T06:56:37.201622"
          },
          {
            "user_message": "I'm not sure, can you clarify?",
            "bot_response": "I'm here to help you find clinical trials. What condition are you interested in?",
            "metadata": {
              "session_id": "AUTO_TEST_random_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "general_response",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "general_response",
                "parameters": {},
                "response_text": "I'm here to help you find clinical trials. What condition are you interested in?",
                "new_state": "initial",
                "collect_entities": null,
                "metadata": {
                  "fallback": true
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "general_response": true
            },
            "response_time": 55.1969358921051,
            "timestamp": "2025-12-16T06:57:32.399332"
          },
          {
            "user_message": "Yes, I have Hidradenitis Suppurativa",
            "bot_response": "I couldn't find any trials for Hidradenitis Suppurativa in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_random_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Hidradenitis Suppurativa",
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": "yes",
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Hidradenitis Suppurativa",
                  "location": "Birmingham, AL"
                },
                "response_text": "Thank you for confirming. I'll now search for clinical trials for Hidradenitis Suppurativa near Birmingham, Alabama. Please give me just a moment to find the most relevant options for you.",
                "new_state": "trials_presented",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The system has successfully collected both the user's condition (Hidradenitis Suppurativa) and location (Birmingham, AL). The user has just confirmed their condition, making it the perfect time to proceed with their primary goal: finding relevant trials. The `search_trials` action is the logical next step. The response confirms the information received and sets the expectation for the search. The state is updated to `trials_presented` to reflect that the next turn will involve showing the search results."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Hidradenitis Suppurativa",
              "location": "Birmingham, AL"
            },
            "response_time": 22.341167211532593,
            "timestamp": "2025-12-16T06:57:54.740802"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "Thanks for confirming. It seems there are no matching trials for Hidradenitis Suppurativa directly in Birmingham, AL right now. I know that can be disappointing. \n\nWould you be open to expanding the search? We could look at the entire state of Alabama or check within a wider radius, like 100 miles.",
            "metadata": {
              "session_id": "AUTO_TEST_random_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "clarify_request",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "clarify_request",
                "parameters": {},
                "response_text": "Thanks for confirming. It seems there are no matching trials for Hidradenitis Suppurativa directly in Birmingham, AL right now. I know that can be disappointing. \n\nWould you be open to expanding the search? We could look at the entire state of Alabama or check within a wider radius, like 100 miles.",
                "new_state": "awaiting_location_clarification",
                "collect_entities": [
                  "location",
                  "boolean_answer"
                ],
                "metadata": {
                  "reasoning": "The user has re-confirmed their location ('Birmingham, AL') after a previous search likely yielded no results. Simply searching again with the same parameters would be unhelpful and frustrating. The best course of action is to acknowledge their confirmation, explain the situation (no trials in that specific city), and proactively offer a constructive alternative, such as widening the search radius. This clarifies their willingness to be flexible and provides a path forward."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "general_response": true
            },
            "response_time": 39.19546413421631,
            "timestamp": "2025-12-16T06:58:33.936451"
          },
          {
            "user_message": "Yes, that's correct",
            "bot_response": "I couldn't find any trials for Hidradenitis Suppurativa in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_random_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": true,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Hidradenitis Suppurativa",
                  "location": "Birmingham, AL",
                  "expanded_search": true
                },
                "response_text": "Perfect. I'll go ahead and expand the search radius for you. Let's see what other options we can find for Hidradenitis Suppurativa near Birmingham. This will just take a moment.",
                "new_state": "awaiting_search_results",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided their condition and location in previous turns. The immediate preceding turn involved the assistant offering to expand the search, and the user's message 'Yes, that's correct' is a direct confirmation of this. Therefore, the most logical and helpful action is to perform the expanded trial search as requested. The response confirms this action and sets the expectation that results are forthcoming."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Hidradenitis Suppurativa",
              "location": "Birmingham, AL"
            },
            "response_time": 38.529202938079834,
            "timestamp": "2025-12-16T06:59:12.465973"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "Thanks for confirming. I'm still not finding any trials for Hidradenitis Suppurativa specifically in Birmingham. Sometimes expanding the search area can help. Would you like me to search the entire state of Alabama, or perhaps within a 50-mile radius?",
            "metadata": {
              "session_id": "AUTO_TEST_random_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "clarify_request",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "clarify_request",
                "parameters": {},
                "response_text": "Thanks for confirming. I'm still not finding any trials for Hidradenitis Suppurativa specifically in Birmingham. Sometimes expanding the search area can help. Would you like me to search the entire state of Alabama, or perhaps within a 50-mile radius?",
                "new_state": "awaiting_search_clarification",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has repeated their location, for which a previous search likely found no results. Instead of re-running the same failed search, the best action is to clarify their intent and proactively offer a helpful next step, such as expanding the search radius. This acknowledges their input, explains the situation, and provides a clear path forward."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "general_response": true
            },
            "response_time": 19.179479837417603,
            "timestamp": "2025-12-16T06:59:31.645930"
          },
          {
            "user_message": "I'm not sure, can you clarify?",
            "bot_response": "Of course, I'm happy to clarify. Based on the information you've provided, I'm ready to search for clinical trials for Hidradenitis Suppurativa near Birmingham, AL. \n\nWould you like me to go ahead and start the search for you, or did you have another question first?",
            "metadata": {
              "session_id": "AUTO_TEST_random_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "general_response",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "general_response",
                "parameters": {},
                "response_text": "Of course, I'm happy to clarify. Based on the information you've provided, I'm ready to search for clinical trials for Hidradenitis Suppurativa near Birmingham, AL. \n\nWould you like me to go ahead and start the search for you, or did you have another question first?",
                "new_state": "ready_to_search",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user is explicitly asking for clarification and seems unsure about the next step. The best action is to provide a general response that re-explains the current situation and offers a clear path forward. Since we have both the user's condition and location, the logical next step is to search for trials. This response validates the information we have, simplifies the choice for the user, and gently prompts them to confirm they are ready to proceed with the search. The state is updated to 'ready_to_search' to reflect that we have all necessary information and are awaiting user confirmation."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "general_response": true
            },
            "response_time": 38.3967821598053,
            "timestamp": "2025-12-16T07:00:10.043128"
          },
          {
            "user_message": "I'm not sure, can you clarify?",
            "bot_response": "Of course, I'm happy to clarify. My goal is to help you find clinical trials that might be a good fit.\n\nBased on what you've told me \u2014 that you have Hidradenitis Suppurativa and are in Birmingham, AL \u2014 the next step is for me to search a large database for relevant studies. I can then show you a list of trials that are actively recruiting participants in your area.\n\nWould you like me to go ahead and run that search for you?",
            "metadata": {
              "session_id": "AUTO_TEST_random_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "clarify_request",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "clarify_request",
                "parameters": {},
                "response_text": "Of course, I'm happy to clarify. My goal is to help you find clinical trials that might be a good fit.\n\nBased on what you've told me \u2014 that you have Hidradenitis Suppurativa and are in Birmingham, AL \u2014 the next step is for me to search a large database for relevant studies. I can then show you a list of trials that are actively recruiting participants in your area.\n\nWould you like me to go ahead and run that search for you?",
                "new_state": "awaiting_search_confirmation",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has explicitly asked for clarification ('can you clarify?'). The most appropriate action is to explain the last step and the overall process. Since we have both the user's condition and location, the logical next step was to offer to search for trials. The response clarifies this process in simple terms and then re-asks for confirmation to proceed. This is helpful, empathetic, and moves the conversation forward constructively. The state is updated to 'awaiting_search_confirmation' to reflect that we are now waiting for the user's go-ahead to perform the search."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "general_response": true
            },
            "response_time": 39.323429107666016,
            "timestamp": "2025-12-16T07:00:49.366930"
          },
          {
            "user_message": "I'm not sure, can you clarify?",
            "bot_response": "Of course, I'm happy to clarify. My apologies if I was unclear. \n\nBased on our conversation, I have your condition as Hidradenitis Suppurativa and your location as Birmingham, AL. \n\nThe next step would be for me to use this information to search for relevant clinical trials near you. \n\nWould you like me to go ahead and do that now?",
            "metadata": {
              "session_id": "AUTO_TEST_random_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "general_response",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "general_response",
                "parameters": {},
                "response_text": "Of course, I'm happy to clarify. My apologies if I was unclear. \n\nBased on our conversation, I have your condition as Hidradenitis Suppurativa and your location as Birmingham, AL. \n\nThe next step would be for me to use this information to search for relevant clinical trials near you. \n\nWould you like me to go ahead and do that now?",
                "new_state": "initial",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user is expressing confusion ('I'm not sure, can you clarify?') after a lengthy conversation (12 turns). The provided analysis indicates this is the third time they've asked for clarification, signaling a potential breakdown in communication. Instead of proceeding directly to the next logical step (searching trials), the best action is to pause, re-orient the user, and ensure they are comfortable moving forward. This `general_response` acknowledges their confusion, summarizes the information gathered so far (condition and location), and proposes a clear, simple next step (searching for trials) in the form of a question. This approach is empathetic, addresses their immediate need for clarity, and seeks their explicit consent before proceeding, which should help get the conversation back on track."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "general_response": true
            },
            "response_time": 58.03314208984375,
            "timestamp": "2025-12-16T07:01:47.400658"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Hidradenitis Suppurativa in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_random_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Hidradenitis Suppurativa",
                  "location": "Birmingham, AL"
                },
                "response_text": "Perfect, thank you for confirming. I'm now searching for clinical trials for Hidradenitis Suppurativa near Birmingham, AL. I'll share what I find in just a moment.",
                "new_state": "trials_found",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both their condition (Hidradenitis Suppurativa) and location (Birmingham, AL). Their latest message, repeating the location, acts as a confirmation to proceed with the search, especially given the long conversation history. The `search_trials` action is the most logical next step to help the user achieve their goal. The response acknowledges their confirmation and clearly states the action being taken, moving the conversation into the results phase."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Hidradenitis Suppurativa",
              "location": "Birmingham, AL"
            },
            "response_time": 20.621936082839966,
            "timestamp": "2025-12-16T07:02:08.022877"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I understand you're looking for trials specifically in Birmingham, AL. I did run a search, and unfortunately, it seems there are no matching Hidradenitis Suppurativa trials in that immediate area right now. I know that can be disappointing. \n\nWould you be open to expanding the search? I can check the entire state of Alabama or look at options nationally if you'd be willing to travel.",
            "metadata": {
              "session_id": "AUTO_TEST_random_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "general_response",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "general_response",
                "parameters": {},
                "response_text": "I understand you're looking for trials specifically in Birmingham, AL. I did run a search, and unfortunately, it seems there are no matching Hidradenitis Suppurativa trials in that immediate area right now. I know that can be disappointing. \n\nWould you be open to expanding the search? I can check the entire state of Alabama or look at options nationally if you'd be willing to travel.",
                "new_state": "initial",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has repeated their location after a previous search for 'Hidradenitis Suppurativa' in 'Birmingham, AL' yielded no results. Simply re-running the same search would be unhelpful. The best course of action is to acknowledge the lack of local trials, show empathy, and offer a constructive alternative, such as expanding the search radius to the entire state or nationally. This general response aims to guide the user toward a more fruitful search while managing their expectations."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "general_response": true
            },
            "response_time": 26.78801393508911,
            "timestamp": "2025-12-16T07:02:34.812499"
          }
        ],
        "final_state": "completed",
        "total_turns": 15,
        "total_questions_asked": 0,
        "errors": [
          {
            "type": "unexpected_state",
            "bot_response": "I understand you're looking for trials specifically in Birmingham, AL. I did run a search, and unfortunately, it seems there are no matching Hidradenitis Suppurativa trials in that immediate area right now. I know that can be disappointing. \n\nWould you be open to expanding the search? I can check the entire state of Alabama or look at options nationally if you'd be willing to travel."
          }
        ]
      },
      "validation": {
        "passed": false,
        "overall_score": 51.0,
        "crash_prevention": {
          "passed": true,
          "score": 100.0,
          "error_count": 0,
          "errors": [],
          "failures": []
        },
        "eligibility_accuracy": {
          "passed": false,
          "score": 0.0,
          "reason": "Could not extract eligibility result",
          "failures": [
            {
              "type": "eligibility_logic_error",
              "reason": "No eligibility determination found in conversation",
              "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
              "severity": "high"
            }
          ]
        },
        "conversation_quality": {
          "passed": false,
          "score": 5.0,
          "total_questions_asked": 0,
          "issues": [
            "Too few questions asked (0, expected at least 4)",
            "Repeated question: I couldn't find any trials for Hidradenitis Suppur...",
            "Repeated question: I couldn't find any trials for Hidradenitis Suppur...",
            "Repeated question: I couldn't find any trials for Hidradenitis Suppur...",
            "Repeated question: I couldn't find any trials for Hidradenitis Suppur...",
            "Repeated question: I couldn't find any trials for Hidradenitis Suppur..."
          ],
          "failures": [
            {
              "type": "conversation_quality_issue",
              "issue": "Too few questions asked (0, expected at least 4)",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Hidradenitis Suppur...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Hidradenitis Suppur...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Hidradenitis Suppur...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Hidradenitis Suppur...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Hidradenitis Suppur...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            }
          ]
        },
        "edge_case_handling": {
          "passed": true,
          "score": 100.0,
          "applicable": false,
          "failures": []
        },
        "performance": {
          "passed": false,
          "score": 40.0,
          "avg_response_time": 31.23820964495341,
          "max_response_time": 58.03314208984375,
          "status": "slow",
          "failures": [
            {
              "type": "performance_issue",
              "avg_response_time": 31.23820964495341,
              "max_response_time": 58.03314208984375,
              "severity": "low",
              "recommendation": "Investigate slow API responses or Gemini API delays"
            }
          ]
        },
        "failure_points": [
          {
            "type": "eligibility_logic_error",
            "reason": "No eligibility determination found in conversation",
            "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
            "severity": "high"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Too few questions asked (0, expected at least 4)",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Hidradenitis Suppur...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Hidradenitis Suppur...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Hidradenitis Suppur...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Hidradenitis Suppur...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Hidradenitis Suppur...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "performance_issue",
            "avg_response_time": 31.23820964495341,
            "max_response_time": 58.03314208984375,
            "severity": "low",
            "recommendation": "Investigate slow API responses or Gemini API delays"
          }
        ],
        "recommendations": [
          "\u26a0\ufe0f HIGH: Review eligibility evaluation logic in gemini_prescreening_manager.py",
          "\u26a0\ufe0f MEDIUM: Major conversation quality issues. Review question generation and response handling.",
          "\u2139\ufe0f LOW: Slow response times. Optimize API calls or consider caching."
        ]
      },
      "timestamp": "2025-12-16T07:02:34.813122"
    },
    {
      "patient_id": "AUTO_TEST_random_000",
      "patient_profile": {
        "patient_id": "AUTO_TEST_random_000",
        "profile_type": "random",
        "demographics": {
          "age": 26,
          "gender": "male",
          "location": "New Orleans, LA",
          "name": "Charles Davis",
          "first_name": "Charles",
          "last_name": "Davis"
        },
        "medical_history": {
          "primary_condition": "Type 2 Diabetes",
          "conditions": [
            "Type 2 Diabetes"
          ],
          "medications": [
            "Ozempic",
            "Glipizide"
          ],
          "duration_years": 4
        },
        "expected_behavior": {
          "should_find_trials": true,
          "likely_eligible": true,
          "expected_question_count_range": [
            4,
            8
          ]
        }
      },
      "conversation_result": {
        "session_id": "AUTO_TEST_random_000",
        "patient_id": "AUTO_TEST_random_000",
        "conversation_log": [
          {
            "user_message": "Type 2 Diabetes trials in New Orleans, LA",
            "bot_response": "Great! I found 5 clinical trial(s) available in New Orleans:\n\n**Dr. Patrick Dennis**\n  \u2022 Overweight (2 trials)\n  \u2022 Overweight or Obesity and Type 2 Diabetes (1 trial)\n  \u2022 Osteoarthritis of the Knee (1 trial)\n  \u2022 COVID-19 (1 trial)\n\nWould you like to:\n1. Check your eligibility for any of these trials?\n2. Learn more about a specific condition?\n3. See trials in a different location?",
            "metadata": {
              "session_id": "AUTO_TEST_random_000",
              "current_state": "trials_shown",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Type 2 Diabetes",
                "location": "New Orleans",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Type 2 Diabetes",
                  "location": "New Orleans"
                },
                "response_text": "Of course, we can switch gears. I'll look for clinical trials for Type 2 Diabetes in the New Orleans, LA area for you now. One moment...",
                "new_state": "search_complete",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided a new condition and location, explicitly requesting a new search. This overrides the previous context of prescreening for Hidradenitis Suppurativa. The best action is to acknowledge the context switch and fulfill this new, complete request by searching for trials with the provided information."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "trials_found": 5,
              "condition": "Type 2 Diabetes",
              "location": "New Orleans",
              "trials_data": [
                {
                  "id": 111,
                  "trial_name": "A Randomized, Double-Blind, Phase 2 Trial of Once Weekly Petrelintide Compared with Placebo in Participants with Overweight or Obesity and Type 2 Diabetes",
                  "conditions": "Overweight",
                  "description": "This is a Phase 2 clinical research study, sponsored by Zealand Pharma A/S, to learn about an investigational weekly injection called petrelintide. The study is designed to see if petrelintide can help people with overweight or obesity and type 2 diabetes lose weight and manage their blood sugar. It is a \"randomized, double-blind, placebo-controlled\" trial, which means you will be randomly assigned (like a coin flip) to receive either petrelintide or a placebo, an inactive substance with no medicine. Neither you nor your study doctor will know which treatment you are receiving to ensure the results are unbiased. The study will take place at multiple research sites across the United States, and your total participation will last for approximately 39 weeks.\n\nThis study is looking for approximately 216 adults who have been diagnosed with both type 2 diabetes and have overweight or obesity. To be eligible, you must be willing to follow a reduced-calorie diet and increase your physical activity, as you will receive counseling on these lifestyle changes throughout the trial. The study aims to include a balanced number of men and women. As a participant, you will be closely monitored by a team of healthcare professionals. Your commitment to attending all study visits and following the study plan is essential for us to gather accurate information about the investigational drug's safety and effectiveness.\n\nIf you join the study, you will be assigned to one of six groups to receive a once-weekly injection, which you will learn to give yourself at home. Three groups will receive different doses of the investigational drug, petrelintide, and three groups will receive a matching placebo. The main goal is to see how the treatment affects your body weight after 28 weeks. We will also monitor changes in your blood sugar (HbA1c), waist circumference, cholesterol, and blood pressure. Your participation involves regular clinic visits over about 39 weeks, including a screening period, a 28-week treatment phase, and a 9-week follow-up. During these visits, you can expect procedures like blood tests, physical exams, ECGs, and completing health questionnaires.",
                  "investigator_name": "Dr. Patrick Dennis",
                  "site_location": "New Orleans, LA",
                  "protocol_summary": "This is a Phase 2 clinical research study, sponsored by Zealand Pharma A/S, to learn about an investigational weekly injection called petrelintide. The study is designed to see if petrelintide can help people with overweight or obesity and type 2 diabetes lose weight and manage their blood sugar. It is a \"randomized, double-blind, placebo-controlled\" trial, which means you will be randomly assigned (like a coin flip) to receive either petrelintide or a placebo, an inactive substance with no medicine. Neither you nor your study doctor will know which treatment you are receiving to ensure the results are unbiased. The study will take place at multiple research sites across the United States, and your total participation will last for approximately 39 weeks.\n\nThis study is looking for approximately 216 adults who have been diagnosed with both type 2 diabetes and have overweight or obesity. To be eligible, you must be willing to follow a reduced-calorie diet and increase your physical activity, as you will receive counseling on these lifestyle changes throughout the trial. The study aims to include a balanced number of men and women. As a participant, you will be closely monitored by a team of healthcare professionals. Your commitment to attending all study visits and following the study plan is essential for us to gather accurate information about the investigational drug's safety and effectiveness.\n\nIf you join the study, you will be assigned to one of six groups to receive a once-weekly injection, which you will learn to give yourself at home. Three groups will receive different doses of the investigational drug, petrelintide, and three groups will receive a matching placebo. The main goal is to see how the treatment affects your body weight after 28 weeks. We will also monitor changes in your blood sugar (HbA1c), waist circumference, cholesterol, and blood pressure. Your participation involves regular clinic visits over about 39 weeks, including a screening period, a 28-week treatment phase, and a 9-week follow-up. During these visits, you can expect procedures like blood tests, physical exams, ECGs, and completing health questionnaires.",
                  "total_sites": 1,
                  "similarity_score": 0.7810015813138492
                },
                {
                  "id": 55,
                  "trial_name": "A Randomized, Double-Blind, Phase 2 Trial of Once-Weekly Petrelintide Compared with Placebo in Participants with Overweight or Obesity and Type 2 Diabetes",
                  "conditions": "Overweight or Obesity and Type 2 Diabetes",
                  "description": "This is a Phase 2, randomized, double-blind, placebo-controlled, multi-center clinical trial sponsored by Zealand Pharma A/S.  \"Double-blind\" means neither you nor the study staff will know whether you are receiving the study drug or a placebo. \"Randomized\" means you will be assigned to a treatment group by chance, like flipping a coin. The study will be conducted at multiple locations and will last approximately 40 weeks.\n\nThis study is for adults with type 2 diabetes who are overweight or obese.  You must be willing to follow a reduced-calorie diet and increase your physical activity. Key inclusion criteria include a diagnosis of type 2 diabetes and a Body Mass Index (BMI) indicating overweight or obesity. You may not be eligible to participate if you have certain medical conditions, such as a history of pancreatitis, or are taking certain medications. During the study, you will receive either petrelintide or a placebo injection once a week. You will also attend regular study visits where your weight, blood sugar levels, and other health measures will be monitored. \n\nThis study is investigating the effectiveness and safety of petrelintide for weight management.  You will receive one of three doses of petrelintide or a placebo injection once weekly.  Researchers will measure changes in your body weight, waist circumference, blood sugar levels (HbA1c and fasting glucose), cholesterol levels, blood pressure, and other health indicators. The primary outcome is the percentage change in body weight from the start of the study to week 28. Secondary outcomes include the proportion of participants achieving at least 5% or 10% weight loss, changes in other health measures, and any side effects experienced.  You will have study visits approximately every 4 weeks for the first 16 weeks, then every 4 weeks until week 28, with a final follow-up visit 10 weeks after your last injection.",
                  "investigator_name": "Dr. Patrick Dennis",
                  "site_location": "New Orleans, LA",
                  "protocol_summary": "This is a Phase 2, randomized, double-blind, placebo-controlled, multi-center clinical trial sponsored by Zealand Pharma A/S.  \"Double-blind\" means neither you nor the study staff will know whether you are receiving the study drug or a placebo. \"Randomized\" means you will be assigned to a treatment group by chance, like flipping a coin. The study will be conducted at multiple locations and will last approximately 40 weeks.\n\nThis study is for adults with type 2 diabetes who are overweight or obese.  You must be willing to follow a reduced-calorie diet and increase your physical activity. Key inclusion criteria include a diagnosis of type 2 diabetes and a Body Mass Index (BMI) indicating overweight or obesity. You may not be eligible to participate if you have certain medical conditions, such as a history of pancreatitis, or are taking certain medications. During the study, you will receive either petrelintide or a placebo injection once a week. You will also attend regular study visits where your weight, blood sugar levels, and other health measures will be monitored. \n\nThis study is investigating the effectiveness and safety of petrelintide for weight management.  You will receive one of three doses of petrelintide or a placebo injection once weekly.  Researchers will measure changes in your body weight, waist circumference, blood sugar levels (HbA1c and fasting glucose), cholesterol levels, blood pressure, and other health indicators. The primary outcome is the percentage change in body weight from the start of the study to week 28. Secondary outcomes include the proportion of participants achieving at least 5% or 10% weight loss, changes in other health measures, and any side effects experienced.  You will have study visits approximately every 4 weeks for the first 16 weeks, then every 4 weeks until week 28, with a final follow-up visit 10 weeks after your last injection.",
                  "total_sites": 1,
                  "similarity_score": 0.779941130811298
                },
                {
                  "id": 96,
                  "trial_name": "A Phase 2b, Multicenter, Randomized, Double-Blind, Placebo-Controlled, Multiple Dose Study with Open-Label Extension to Assess the Efficacy, Safety, and Pharmacokinetics of Subcutaneously Administered Taldefgrobep alfa in Adults Living with Overweight and Obesity",
                  "conditions": "Overweight",
                  "description": "This is a Phase 2b clinical research study, sponsored by Biohaven Therapeutics Ltd., to evaluate an investigational drug called taldefgrobep alfa for adults with overweight or obesity. The study will take place at multiple research centers. For the first 24 weeks, it is a randomized, double-blind, placebo-controlled trial. This means participants will be randomly assigned (like a coin flip) to receive either the study drug or a placebo (an inactive substance), and neither the participant nor the study team will know which treatment is being given. After this period, eligible participants may choose to continue in a 24-week extension where all participants will receive the active study drug. The total study participation can last up to 60 weeks, including screening and follow-up periods.\n\nThis study is seeking approximately 150 adult participants who are living with overweight or obesity. To be eligible, you must provide written informed consent and meet specific criteria related to your body mass index (BMI) and overall health, which the study team will review with you. The study aims to include a diverse group of participants, with a goal that no more than 70% of those enrolled will be female. As part of the study, all participants will receive counseling on maintaining a healthy diet and are encouraged to follow standard exercise guidelines. Participation is entirely voluntary, and you can decide to leave the study at any time.\n\nThe investigational drug, taldefgrobep alfa, or a matching placebo, is administered as an injection under the skin either once weekly or once every four weeks. The main purpose of the study is to measure the change in total body weight after 24 weeks of treatment. Researchers will also closely monitor changes in body composition, specifically total body fat and lean muscle mass, using methods like DXA scans. Your safety will be monitored throughout the study with physical exams, blood tests, and tracking of any side effects. The study involves approximately 16 in-person visits and one phone call over the 60-week period, where you will undergo procedures, complete health questionnaires, and perform simple physical function tests.",
                  "investigator_name": "Dr. Patrick Dennis",
                  "site_location": "New Orleans, LA",
                  "protocol_summary": "This is a Phase 2b clinical research study, sponsored by Biohaven Therapeutics Ltd., to evaluate an investigational drug called taldefgrobep alfa for adults with overweight or obesity. The study will take place at multiple research centers. For the first 24 weeks, it is a randomized, double-blind, placebo-controlled trial. This means participants will be randomly assigned (like a coin flip) to receive either the study drug or a placebo (an inactive substance), and neither the participant nor the study team will know which treatment is being given. After this period, eligible participants may choose to continue in a 24-week extension where all participants will receive the active study drug. The total study participation can last up to 60 weeks, including screening and follow-up periods.\n\nThis study is seeking approximately 150 adult participants who are living with overweight or obesity. To be eligible, you must provide written informed consent and meet specific criteria related to your body mass index (BMI) and overall health, which the study team will review with you. The study aims to include a diverse group of participants, with a goal that no more than 70% of those enrolled will be female. As part of the study, all participants will receive counseling on maintaining a healthy diet and are encouraged to follow standard exercise guidelines. Participation is entirely voluntary, and you can decide to leave the study at any time.\n\nThe investigational drug, taldefgrobep alfa, or a matching placebo, is administered as an injection under the skin either once weekly or once every four weeks. The main purpose of the study is to measure the change in total body weight after 24 weeks of treatment. Researchers will also closely monitor changes in body composition, specifically total body fat and lean muscle mass, using methods like DXA scans. Your safety will be monitored throughout the study with physical exams, blood tests, and tracking of any side effects. The study involves approximately 16 in-person visits and one phone call over the 60-week period, where you will undergo procedures, complete health questionnaires, and perform simple physical function tests.",
                  "total_sites": 2,
                  "similarity_score": 0.7493696580610724
                }
              ],
              "semantic_search": true
            },
            "response_time": 31.128626823425293,
            "timestamp": "2025-12-16T06:55:17.375361"
          },
          {
            "user_message": "Yes, check my eligibility",
            "bot_response": "I'm having trouble loading the prescreening questions for this trial. Please try searching for trials again, or contact support if this continues.",
            "metadata": {
              "session_id": "AUTO_TEST_random_000",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "start_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": "yes",
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "start_prescreening",
                "parameters": {},
                "response_text": "Great! I can help with that. To get started, could you please tell me the number of the trial you're most interested in from the list I just sent?",
                "new_state": "prescreening_started",
                "collect_entities": [
                  "number"
                ],
                "metadata": {
                  "reasoning": "The user has explicitly confirmed they want to check their eligibility after being shown a list of trials (state: trials_shown). The most appropriate action is to start the prescreening process. The response first confirms their request and then asks for the specific trial number they are interested in, which is the necessary first step to begin the eligibility questionnaire."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "prescreening_error": "failed_to_load_questions",
              "error_details": "No criteria found for trial 111"
            },
            "response_time": 19.027832746505737,
            "timestamp": "2025-12-16T06:55:36.403603"
          }
        ],
        "final_state": "completed",
        "total_turns": 2,
        "total_questions_asked": 0,
        "errors": [
          {
            "type": "prescreening_not_started",
            "bot_response": "I'm having trouble loading the prescreening questions for this trial. Please try searching for trials again, or contact support if this continues."
          }
        ]
      },
      "validation": {
        "passed": false,
        "overall_score": 66.0,
        "crash_prevention": {
          "passed": true,
          "score": 100.0,
          "error_count": 0,
          "errors": [],
          "failures": []
        },
        "eligibility_accuracy": {
          "passed": false,
          "score": 0.0,
          "reason": "Could not extract eligibility result",
          "failures": [
            {
              "type": "eligibility_logic_error",
              "reason": "No eligibility determination found in conversation",
              "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
              "severity": "high"
            }
          ]
        },
        "conversation_quality": {
          "passed": true,
          "score": 80.0,
          "total_questions_asked": 0,
          "issues": [
            "Too few questions asked (0, expected at least 4)"
          ],
          "failures": [
            {
              "type": "conversation_quality_issue",
              "issue": "Too few questions asked (0, expected at least 4)",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            }
          ]
        },
        "edge_case_handling": {
          "passed": true,
          "score": 100.0,
          "applicable": false,
          "failures": []
        },
        "performance": {
          "passed": false,
          "score": 40.0,
          "avg_response_time": 25.078229784965515,
          "max_response_time": 31.128626823425293,
          "status": "slow",
          "failures": [
            {
              "type": "performance_issue",
              "avg_response_time": 25.078229784965515,
              "max_response_time": 31.128626823425293,
              "severity": "low",
              "recommendation": "Investigate slow API responses or Gemini API delays"
            }
          ]
        },
        "failure_points": [
          {
            "type": "eligibility_logic_error",
            "reason": "No eligibility determination found in conversation",
            "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
            "severity": "high"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Too few questions asked (0, expected at least 4)",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "performance_issue",
            "avg_response_time": 25.078229784965515,
            "max_response_time": 31.128626823425293,
            "severity": "low",
            "recommendation": "Investigate slow API responses or Gemini API delays"
          }
        ],
        "recommendations": [
          "\u26a0\ufe0f HIGH: Review eligibility evaluation logic in gemini_prescreening_manager.py",
          "\u2139\ufe0f LOW: Slow response times. Optimize API calls or consider caching."
        ]
      },
      "timestamp": "2025-12-16T06:55:36.404095"
    },
    {
      "patient_id": "AUTO_TEST_targeted_diabetes_001",
      "patient_profile": {
        "patient_id": "AUTO_TEST_targeted_diabetes_001",
        "profile_type": "targeted",
        "demographics": {
          "age": 39,
          "gender": "male",
          "location": "Nashville, TN",
          "name": "Test Diabetes Patient",
          "first_name": "Test",
          "last_name": "Patient"
        },
        "medical_history": {
          "primary_condition": "Type 2 Diabetes",
          "conditions": [
            "Type 2 Diabetes",
            "Hypertension"
          ],
          "medications": [
            "Metformin",
            "Lisinopril"
          ],
          "duration_years": 7,
          "a1c": 8.2,
          "blood_glucose": 180
        },
        "expected_behavior": {
          "should_find_trials": true,
          "likely_eligible": true,
          "expected_question_count_range": [
            5,
            9
          ],
          "target_trial_keywords": [
            "diabetes"
          ]
        }
      },
      "conversation_result": {
        "session_id": "AUTO_TEST_targeted_diabetes_001",
        "patient_id": "AUTO_TEST_targeted_diabetes_001",
        "conversation_log": [
          {
            "user_message": "Type 2 Diabetes trials in Nashville, TN",
            "bot_response": "I couldn't find any trials for Type 2 Diabetes in Nashville, TN at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_diabetes_001",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Type 2 Diabetes",
                "location": "Nashville",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Type 2 Diabetes",
                  "location": "Nashville, TN"
                },
                "response_text": "Of course. Let's switch the location to Nashville. I'm now searching for Type 2 Diabetes clinical trials in or near Nashville, TN. I'll have some options for you in just a moment.",
                "new_state": "trials_found",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided a new location, Nashville, TN, along with the previously established condition, Type 2 Diabetes. Since both the condition and location are now known and the user's intent is to find trials, the correct action is to perform a search with the updated information. The response confirms the change in location and sets the expectation that a search is underway."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Type 2 Diabetes",
              "location": "Nashville, TN"
            },
            "response_time": 16.551720142364502,
            "timestamp": "2025-12-16T07:02:51.365247"
          },
          {
            "user_message": "Yes, check my eligibility",
            "bot_response": "I need to know which specific trial you'd like to check eligibility for. Could you please search for trials first, or let me know what condition and location you're interested in?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_diabetes_001",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "start_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": "yes",
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "start_prescreening",
                "parameters": {},
                "response_text": "Great! I can help with that. To check your eligibility, I'll need to ask a few questions. This will only take a minute.\n\nFirst, could you please tell me your age?",
                "new_state": "prescreening",
                "collect_entities": [
                  "age"
                ],
                "metadata": {
                  "reasoning": "The user has explicitly confirmed their desire to check eligibility. The current state indicates we have the necessary information (condition and location) to have already presented trials. Therefore, the next logical action is to begin the prescreening process. The response acknowledges their request, sets expectations, and asks the first common eligibility question (age) to move the conversation forward. The state is updated to 'prescreening' to reflect this new phase."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "prescreening_error": "no_trial_id_found"
            },
            "response_time": 19.70528817176819,
            "timestamp": "2025-12-16T07:03:11.070881"
          },
          {
            "user_message": "Nashville, TN",
            "bot_response": "I couldn't find any trials for Type 2 Diabetes in Nashville, TN at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_diabetes_001",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Nashville, TN",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Type 2 Diabetes",
                  "location": "Nashville, TN"
                },
                "response_text": "Perfect, thank you. I'm now searching for clinical trials for Type 2 Diabetes in the Nashville, TN area. I'll have some options for you in just a moment.",
                "new_state": "trials_found",
                "collect_entities": null,
                "metadata": {
                  "reasoning": "The user has provided the final piece of required information (location) to perform a trial search. The conversation context confirms we already have their condition (Type 2 Diabetes). Therefore, the most appropriate action is to execute the search as requested by the user's intent and the logical flow of the conversation."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Type 2 Diabetes",
              "location": "Nashville, TN"
            },
            "response_time": 21.746729850769043,
            "timestamp": "2025-12-16T07:03:32.818062"
          },
          {
            "user_message": "Nashville, TN",
            "bot_response": "Thanks for confirming your location in Nashville, TN. I wasn't able to find any matching trials for Type 2 Diabetes right in that area in my previous search, and I know that can be disappointing. Sometimes trials are located in larger medical centers nearby. Would you be open to me expanding the search to a wider area, like the entire state of Tennessee?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_diabetes_001",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "clarify_request",
              "entities_collected": {
                "condition": null,
                "location": "Nashville, TN",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "clarify_request",
                "parameters": {
                  "location": "Nashville, TN",
                  "condition": "Type 2 Diabetes"
                },
                "response_text": "Thanks for confirming your location in Nashville, TN. I wasn't able to find any matching trials for Type 2 Diabetes right in that area in my previous search, and I know that can be disappointing. Sometimes trials are located in larger medical centers nearby. Would you be open to me expanding the search to a wider area, like the entire state of Tennessee?",
                "new_state": "awaiting_new_search_criteria",
                "collect_entities": [
                  "location",
                  "boolean_answer"
                ],
                "metadata": {
                  "reasoning": "The user is repeating a location that previously resulted in no trials found. Re-running the same search would be unhelpful and create a frustrating loop. The best action is to clarify the situation, explain why the search failed, and proactively suggest a more productive alternative, such as expanding the search radius. This acknowledges their input while guiding the conversation forward constructively."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "general_response": true
            },
            "response_time": 22.509679794311523,
            "timestamp": "2025-12-16T07:03:55.328105"
          },
          {
            "user_message": "Nashville, TN",
            "bot_response": "I understand you want to keep the search focused on Nashville. I've double-checked, and unfortunately, there are no Type 2 Diabetes trials listed in that specific area right now.\n\nSometimes new trials open up. Would you like me to set up an alert to let you know if one becomes available in Nashville?\n\nWe could also check for any trials that can be done remotely from home, if you're interested.",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_diabetes_001",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "general_response",
              "entities_collected": {
                "condition": null,
                "location": "Nashville, TN",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "general_response",
                "parameters": {},
                "response_text": "I understand you want to keep the search focused on Nashville. I've double-checked, and unfortunately, there are no Type 2 Diabetes trials listed in that specific area right now.\n\nSometimes new trials open up. Would you like me to set up an alert to let you know if one becomes available in Nashville?\n\nWe could also check for any trials that can be done remotely from home, if you're interested.",
                "new_state": "no_results_offered_alternatives",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has re-confirmed their location after a previous search likely yielded no results. The best action is to acknowledge their preference, confirm the lack of trials in that specific location, and offer helpful alternatives like setting up an alert or searching for remote trials. This avoids repeating the failed search and moves the conversation forward constructively."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "general_response": true
            },
            "response_time": 39.845991134643555,
            "timestamp": "2025-12-16T07:04:35.175064"
          }
        ],
        "final_state": "completed",
        "total_turns": 5,
        "total_questions_asked": 0,
        "errors": [
          {
            "type": "unexpected_state",
            "bot_response": "I understand you want to keep the search focused on Nashville. I've double-checked, and unfortunately, there are no Type 2 Diabetes trials listed in that specific area right now.\n\nSometimes new trials open up. Would you like me to set up an alert to let you know if one becomes available in Nashville?\n\nWe could also check for any trials that can be done remotely from home, if you're interested."
          }
        ]
      },
      "validation": {
        "passed": false,
        "overall_score": 63.0,
        "crash_prevention": {
          "passed": true,
          "score": 100.0,
          "error_count": 0,
          "errors": [],
          "failures": []
        },
        "eligibility_accuracy": {
          "passed": false,
          "score": 0.0,
          "reason": "Could not extract eligibility result",
          "failures": [
            {
              "type": "eligibility_logic_error",
              "reason": "No eligibility determination found in conversation",
              "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
              "severity": "high"
            }
          ]
        },
        "conversation_quality": {
          "passed": false,
          "score": 65.0,
          "total_questions_asked": 0,
          "issues": [
            "Too few questions asked (0, expected at least 5)",
            "Repeated question: I couldn't find any trials for Type 2 Diabetes in ..."
          ],
          "failures": [
            {
              "type": "conversation_quality_issue",
              "issue": "Too few questions asked (0, expected at least 5)",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Type 2 Diabetes in ...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            }
          ]
        },
        "edge_case_handling": {
          "passed": true,
          "score": 100.0,
          "applicable": false,
          "failures": []
        },
        "performance": {
          "passed": false,
          "score": 40.0,
          "avg_response_time": 24.071881818771363,
          "max_response_time": 39.845991134643555,
          "status": "slow",
          "failures": [
            {
              "type": "performance_issue",
              "avg_response_time": 24.071881818771363,
              "max_response_time": 39.845991134643555,
              "severity": "low",
              "recommendation": "Investigate slow API responses or Gemini API delays"
            }
          ]
        },
        "failure_points": [
          {
            "type": "eligibility_logic_error",
            "reason": "No eligibility determination found in conversation",
            "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
            "severity": "high"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Too few questions asked (0, expected at least 5)",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Type 2 Diabetes in ...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "performance_issue",
            "avg_response_time": 24.071881818771363,
            "max_response_time": 39.845991134643555,
            "severity": "low",
            "recommendation": "Investigate slow API responses or Gemini API delays"
          }
        ],
        "recommendations": [
          "\u26a0\ufe0f HIGH: Review eligibility evaluation logic in gemini_prescreening_manager.py",
          "\u2139\ufe0f LOW: Minor conversation quality issues. Consider refining prompts and validation.",
          "\u2139\ufe0f LOW: Slow response times. Optimize API calls or consider caching."
        ]
      },
      "timestamp": "2025-12-16T07:04:35.175535"
    },
    {
      "patient_id": "AUTO_TEST_targeted_psoriasis_000",
      "patient_profile": {
        "patient_id": "AUTO_TEST_targeted_psoriasis_000",
        "profile_type": "targeted",
        "demographics": {
          "age": 35,
          "gender": "male",
          "location": "Memphis, TN",
          "name": "Test Psoriasis Patient",
          "first_name": "Test",
          "last_name": "Patient"
        },
        "medical_history": {
          "primary_condition": "Psoriasis",
          "conditions": [
            "Plaque Psoriasis"
          ],
          "medications": [
            "Topical Corticosteroids"
          ],
          "duration_years": 5,
          "pasi_score": 15,
          "body_surface_area": "20%"
        },
        "expected_behavior": {
          "should_find_trials": true,
          "likely_eligible": true,
          "expected_question_count_range": [
            4,
            7
          ],
          "target_trial_keywords": [
            "psoriasis",
            "dermatology"
          ]
        }
      },
      "conversation_result": {
        "session_id": "AUTO_TEST_targeted_psoriasis_000",
        "patient_id": "AUTO_TEST_targeted_psoriasis_000",
        "conversation_log": [
          {
            "user_message": "Psoriasis trials in Memphis, TN",
            "bot_response": "I couldn't find any trials for Psoriasis in Memphis, TN at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_000",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Psoriasis",
                "location": "Memphis",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Psoriasis",
                  "location": "Memphis, TN"
                },
                "response_text": "Of course, I can help with that. I'm searching for clinical trials for Psoriasis in the Memphis, TN area now. I'll share what I find in just a moment. After that, I can also help you check if you might be eligible for any of them, if you'd like.",
                "new_state": "trials_found",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both a specific condition ('Psoriasis') and a location ('Memphis, TN'), which are the two necessary pieces of information to perform a trial search. The `search_trials` action is the most direct way to fulfill their request. The response confirms their request, sets the expectation that a search is underway, and proactively offers the next logical step (eligibility prescreening) to guide the conversation forward."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Psoriasis",
              "location": "Memphis, TN"
            },
            "response_time": 17.598725080490112,
            "timestamp": "2025-12-16T07:02:52.413153"
          },
          {
            "user_message": "Yes, check my eligibility",
            "bot_response": "I couldn't find any trials for Psoriasis in Memphis at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_000",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": "yes",
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Psoriasis",
                  "location": "Memphis"
                },
                "response_text": "Of course. To check your eligibility, I first need to find some relevant Psoriasis trials in the Memphis area. Let me start that search for you now. Once I have a list, we can definitely look at the eligibility criteria for any that seem like a good fit.",
                "new_state": "trials_found",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has requested an eligibility check. However, we have not yet searched for or presented any trials. The logical first step is to perform the `search_trials` action using the condition and location we have already collected. The response acknowledges the user's goal while guiding them through the necessary process of finding trials first."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Psoriasis",
              "location": "Memphis"
            },
            "response_time": 23.59272289276123,
            "timestamp": "2025-12-16T07:03:16.006282"
          },
          {
            "user_message": "Memphis, TN",
            "bot_response": "I couldn't find any trials for Psoriasis in Memphis, TN at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_000",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Memphis, TN",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Psoriasis",
                  "location": "Memphis, TN"
                },
                "response_text": "Great, Memphis it is. I'm searching now for Psoriasis clinical trials in your area. This should just take a moment.",
                "new_state": "trials_found",
                "collect_entities": null,
                "metadata": {
                  "reasoning": "The user has confirmed their location, and we already have their condition (Psoriasis). With both necessary pieces of information, the most direct and helpful action is to proceed with the search for clinical trials. The response confirms the location and informs the user what is happening next, setting clear expectations. The state is updated to 'trials_found' to reflect that the next step will be presenting the search results."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Psoriasis",
              "location": "Memphis, TN"
            },
            "response_time": 22.858896017074585,
            "timestamp": "2025-12-16T07:03:38.865588"
          },
          {
            "user_message": "Memphis, TN",
            "bot_response": "I couldn't find any trials for Psoriasis in Memphis, TN at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_000",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Memphis, TN",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Psoriasis",
                  "location": "Memphis, TN"
                },
                "response_text": "Perfect, thanks for confirming Memphis, TN. I'm now searching for Psoriasis clinical trials in your area. I'll share what I find in just a moment.",
                "new_state": "trials_presented",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both the necessary condition (Psoriasis from context) and location (Memphis, TN). The most logical and helpful next step is to execute the search for clinical trials. The response confirms the search parameters and sets the expectation that results are forthcoming, moving the conversation forward efficiently."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Psoriasis",
              "location": "Memphis, TN"
            },
            "response_time": 21.46294403076172,
            "timestamp": "2025-12-16T07:04:00.329206"
          },
          {
            "user_message": "Memphis, TN",
            "bot_response": "I couldn't find any trials for Psoriasis in Memphis, TN at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_000",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Memphis, TN",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Psoriasis",
                  "location": "Memphis, TN"
                },
                "response_text": "Great, thank you. I'm now looking for Psoriasis clinical trials near Memphis, TN. Please give me a moment to find the latest results for you.",
                "new_state": "searching",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided the final piece of required information (location) after previously providing their condition. The system now has both the condition ('Psoriasis') and location ('Memphis, TN'). The most logical and helpful next step is to perform the search to fulfill the user's request."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Psoriasis",
              "location": "Memphis, TN"
            },
            "response_time": 24.36733913421631,
            "timestamp": "2025-12-16T07:04:24.696982"
          },
          {
            "user_message": "Memphis, TN",
            "bot_response": "I understand you're looking for trials in Memphis, TN. I've re-checked for Psoriasis studies in that area, but it seems there are no matching trials available right at this moment. Sometimes trial locations are very specific. Would you be open to expanding the search to a wider area, like the entire state of Tennessee, or would you prefer I notify you if a new trial opens up near Memphis?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_000",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "general_response",
              "entities_collected": {
                "condition": null,
                "location": "Memphis, TN",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "general_response",
                "parameters": {},
                "response_text": "I understand you're looking for trials in Memphis, TN. I've re-checked for Psoriasis studies in that area, but it seems there are no matching trials available right at this moment. Sometimes trial locations are very specific. Would you be open to expanding the search to a wider area, like the entire state of Tennessee, or would you prefer I notify you if a new trial opens up near Memphis?",
                "new_state": "awaiting_next_step",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user is repeating their location after a search likely yielded no results. Running the same search again would be unhelpful and create a frustrating loop. The best action is to acknowledge their request, explain the situation, and proactively offer alternative solutions like expanding the search radius or setting up notifications. This breaks the loop and provides a constructive path forward."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "general_response": true
            },
            "response_time": 24.110136032104492,
            "timestamp": "2025-12-16T07:04:48.807386"
          },
          {
            "user_message": "Memphis, TN",
            "bot_response": "I couldn't find any trials for Psoriasis in Memphis, TN at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_000",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Memphis, TN",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Psoriasis",
                  "location": "Memphis, TN"
                },
                "response_text": "Great, thank you. I'll search for Psoriasis clinical trials in the Memphis, TN area for you now. This will just take a moment.",
                "new_state": "awaiting_search_results",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided their location, which was the final piece of information needed to perform a search. The `search_trials` action is now appropriate as we have both the user's condition (Psoriasis) and location (Memphis, TN). The response confirms the information received and informs the user about the next step, which is to initiate the search."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Psoriasis",
              "location": "Memphis, TN"
            },
            "response_time": 50.923035860061646,
            "timestamp": "2025-12-16T07:05:39.731253"
          },
          {
            "user_message": "Memphis, TN",
            "bot_response": "I understand you're looking for trials specifically in Memphis, TN. I've double-checked, and unfortunately, I'm still not finding any active Psoriasis trials right in the Memphis area at this time. Trial availability can change quickly, though. Would you be interested in expanding the search to nearby cities, or I can set up an alert to notify you if a new trial for Psoriasis starts in Memphis?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_000",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "clarify_request",
              "entities_collected": {
                "condition": null,
                "location": "Memphis, TN",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "clarify_request",
                "parameters": {},
                "response_text": "I understand you're looking for trials specifically in Memphis, TN. I've double-checked, and unfortunately, I'm still not finding any active Psoriasis trials right in the Memphis area at this time. Trial availability can change quickly, though. Would you be interested in expanding the search to nearby cities, or I can set up an alert to notify you if a new trial for Psoriasis starts in Memphis?",
                "new_state": "no_trials_found",
                "collect_entities": [
                  "boolean_answer"
                ],
                "metadata": {
                  "reasoning": "The user is repeating their location after likely being told no trials were found. Simply searching again would be unhelpful and lead to a frustrating conversational loop. The best action is to acknowledge their specific request, gently reiterate that no trials are available at that exact location, and then proactively offer alternative, helpful solutions. This breaks the loop, shows empathy, and provides a constructive path forward. The state is updated to 'no_trials_found' to reflect the outcome of the search and guide the next turn."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "general_response": true
            },
            "response_time": 23.52488088607788,
            "timestamp": "2025-12-16T07:06:03.256627"
          },
          {
            "user_message": "I'm not sure, can you clarify?",
            "bot_response": "Of course, I'm happy to clarify. Based on what you've told me, we have two main options right now:\n\n1.  I can use your condition (Psoriasis) and location (Memphis, TN) to search for clinical trials that might be a good fit for you.\n2.  We can pause on the search, and I can answer any other questions you might have about clinical trials in general.\n\nWhat feels like the right next step for you?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_000",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "general_response",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "general_response",
                "parameters": {},
                "response_text": "Of course, I'm happy to clarify. Based on what you've told me, we have two main options right now:\n\n1.  I can use your condition (Psoriasis) and location (Memphis, TN) to search for clinical trials that might be a good fit for you.\n2.  We can pause on the search, and I can answer any other questions you might have about clinical trials in general.\n\nWhat feels like the right next step for you?",
                "new_state": "initial",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has explicitly asked for clarification on the next steps. The most appropriate action is a `general_response` that clearly re-states the available options (search for trials or answer more questions) to help them make an informed decision. This directly addresses their question while keeping the conversation moving forward. The state remains `initial` as no new phase of the process has begun."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "general_response": true
            },
            "response_time": 23.287094116210938,
            "timestamp": "2025-12-16T07:06:26.544578"
          },
          {
            "user_message": "Memphis, TN",
            "bot_response": "I couldn't find any trials for Psoriasis in Memphis, TN at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_000",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Memphis, TN",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Psoriasis",
                  "location": "Memphis, TN"
                },
                "response_text": "Okay, thank you for confirming. I am now searching for Psoriasis clinical trials specifically in and around Memphis, TN. Please give me just a moment to see what I can find.",
                "new_state": "search_initiated",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided all the necessary information (condition and location) and has re-confirmed their location, indicating a clear intent to proceed with the search. The most appropriate action is to execute the search for clinical trials. The response acknowledges their confirmation and clearly states the next step, managing expectations for the user."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Psoriasis",
              "location": "Memphis, TN"
            },
            "response_time": 27.9378821849823,
            "timestamp": "2025-12-16T07:06:54.483032"
          },
          {
            "user_message": "Memphis, TN",
            "bot_response": "I understand you're looking for trials specifically in Memphis, TN. It looks like my previous search didn't find any active Psoriasis trials right in that area at the moment. \n\nWould you be open to expanding the search? We could look at a wider radius, like the entire state of Tennessee, or check for any virtual trials that you could participate in from home.",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_000",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "clarify_request",
              "entities_collected": {
                "condition": null,
                "location": "Memphis, TN",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "clarify_request",
                "parameters": {},
                "response_text": "I understand you're looking for trials specifically in Memphis, TN. It looks like my previous search didn't find any active Psoriasis trials right in that area at the moment. \n\nWould you be open to expanding the search? We could look at a wider radius, like the entire state of Tennessee, or check for any virtual trials that you could participate in from home.",
                "new_state": "clarifying_search_scope",
                "collect_entities": [
                  "boolean_answer",
                  "location"
                ],
                "metadata": {
                  "reasoning": "The user is repeating their location after a previous search for 'Psoriasis' in 'Memphis, TN' yielded no results. Simply re-running the same search would be unhelpful and keep the conversation in a loop. The best action is to clarify the user's intent and offer alternative, more productive search options, such as expanding the search radius or looking for virtual trials. This acknowledges their request, explains the situation empathetically, and provides a clear path forward, moving the state to 'clarifying_search_scope' to handle their response to these new options."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "general_response": true
            },
            "response_time": 24.80692982673645,
            "timestamp": "2025-12-16T07:07:19.290635"
          }
        ],
        "final_state": "completed",
        "total_turns": 11,
        "total_questions_asked": 0,
        "errors": [
          {
            "type": "unexpected_state",
            "bot_response": "I understand you're looking for trials specifically in Memphis, TN. It looks like my previous search didn't find any active Psoriasis trials right in that area at the moment. \n\nWould you be open to expanding the search? We could look at a wider radius, like the entire state of Tennessee, or check for any virtual trials that you could participate in from home."
          }
        ]
      },
      "validation": {
        "passed": false,
        "overall_score": 51.0,
        "crash_prevention": {
          "passed": true,
          "score": 100.0,
          "error_count": 0,
          "errors": [],
          "failures": []
        },
        "eligibility_accuracy": {
          "passed": false,
          "score": 0.0,
          "reason": "Could not extract eligibility result",
          "failures": [
            {
              "type": "eligibility_logic_error",
              "reason": "No eligibility determination found in conversation",
              "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
              "severity": "high"
            }
          ]
        },
        "conversation_quality": {
          "passed": false,
          "score": 5.0,
          "total_questions_asked": 0,
          "issues": [
            "Too few questions asked (0, expected at least 4)",
            "Repeated question: I couldn't find any trials for Psoriasis in Memphi...",
            "Repeated question: I couldn't find any trials for Psoriasis in Memphi...",
            "Repeated question: I couldn't find any trials for Psoriasis in Memphi...",
            "Repeated question: I couldn't find any trials for Psoriasis in Memphi...",
            "Repeated question: I couldn't find any trials for Psoriasis in Memphi..."
          ],
          "failures": [
            {
              "type": "conversation_quality_issue",
              "issue": "Too few questions asked (0, expected at least 4)",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Psoriasis in Memphi...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Psoriasis in Memphi...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Psoriasis in Memphi...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Psoriasis in Memphi...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Psoriasis in Memphi...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            }
          ]
        },
        "edge_case_handling": {
          "passed": true,
          "score": 100.0,
          "applicable": false,
          "failures": []
        },
        "performance": {
          "passed": false,
          "score": 40.0,
          "avg_response_time": 25.86096236922524,
          "max_response_time": 50.923035860061646,
          "status": "slow",
          "failures": [
            {
              "type": "performance_issue",
              "avg_response_time": 25.86096236922524,
              "max_response_time": 50.923035860061646,
              "severity": "low",
              "recommendation": "Investigate slow API responses or Gemini API delays"
            }
          ]
        },
        "failure_points": [
          {
            "type": "eligibility_logic_error",
            "reason": "No eligibility determination found in conversation",
            "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
            "severity": "high"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Too few questions asked (0, expected at least 4)",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Psoriasis in Memphi...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Psoriasis in Memphi...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Psoriasis in Memphi...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Psoriasis in Memphi...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Psoriasis in Memphi...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "performance_issue",
            "avg_response_time": 25.86096236922524,
            "max_response_time": 50.923035860061646,
            "severity": "low",
            "recommendation": "Investigate slow API responses or Gemini API delays"
          }
        ],
        "recommendations": [
          "\u26a0\ufe0f HIGH: Review eligibility evaluation logic in gemini_prescreening_manager.py",
          "\u26a0\ufe0f MEDIUM: Major conversation quality issues. Review question generation and response handling.",
          "\u2139\ufe0f LOW: Slow response times. Optimize API calls or consider caching."
        ]
      },
      "timestamp": "2025-12-16T07:07:19.291397"
    },
    {
      "patient_id": "AUTO_TEST_edge_contradictory_000",
      "patient_profile": {
        "patient_id": "AUTO_TEST_edge_contradictory_000",
        "profile_type": "edge_case",
        "demographics": {
          "age": 45,
          "gender": "male",
          "location": "Birmingham, AL",
          "name": "Contradictory Patient",
          "first_name": "Contradictory",
          "last_name": "Patient"
        },
        "medical_history": {
          "primary_condition": "Diabetes",
          "conditions": [],
          "medications": [
            "Metformin",
            "Insulin"
          ],
          "duration_years": 0,
          "contradictions": {
            "says_no_diabetes": true,
            "but_takes_diabetes_meds": true
          }
        },
        "expected_behavior": {
          "should_find_trials": true,
          "likely_eligible": "unclear",
          "expected_question_count_range": [
            4,
            8
          ],
          "edge_case_type": "contradictory_info",
          "should_handle_gracefully": true
        }
      },
      "conversation_result": {
        "session_id": "AUTO_TEST_edge_contradictory_000",
        "patient_id": "AUTO_TEST_edge_contradictory_000",
        "conversation_log": [
          {
            "user_message": "Diabetes trials in Birmingham, AL",
            "bot_response": "I couldn't find any trials for Diabetes in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_edge_contradictory_000",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Diabetes",
                "location": "Birmingham",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Diabetes",
                  "location": "Birmingham, AL"
                },
                "response_text": "Of course, I can help you look for diabetes trials in Birmingham, AL. Finding the right information is an important step. Let me see what I can find for you. \n\nOnce I have a list, we can go over the details and even check if you might be eligible for any that interest you.",
                "new_state": "trial_search_results",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both a specific condition ('Diabetes') and a location ('Birmingham, AL'), which are the two necessary pieces of information to perform a trial search. The `search_trials` action is the most direct and helpful way to fulfill their request. The response confirms the user's request, states the action being taken, and sets the stage for the next logical step (reviewing eligibility), which aligns with the goal of guiding the user through the process."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Diabetes",
              "location": "Birmingham, AL"
            },
            "response_time": 17.07560396194458,
            "timestamp": "2025-12-16T07:02:51.890529"
          },
          {
            "user_message": "Yes, check my eligibility",
            "bot_response": "I couldn't find any trials for Diabetes in Birmingham at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_edge_contradictory_000",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": true,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Diabetes",
                  "location": "Birmingham"
                },
                "response_text": "Great! I can certainly help with that. Before we can check eligibility, we first need to find some relevant trials. I'll start searching for Diabetes clinical trials near Birmingham for you right now.",
                "new_state": "trials_found",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has confirmed they want to proceed and has provided the necessary information (condition: Diabetes, location: Birmingham). The immediate next logical step is to search for trials. Although the user mentioned 'check my eligibility', we must first find trials to check eligibility against. This action performs the search and the response clearly explains the process to the user, managing their expectations while moving toward their ultimate goal."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Diabetes",
              "location": "Birmingham"
            },
            "response_time": 25.482574701309204,
            "timestamp": "2025-12-16T07:03:17.373595"
          }
        ],
        "final_state": "failed",
        "total_turns": 2,
        "total_questions_asked": 0,
        "errors": [
          {
            "type": "conversation_failure",
            "error": "maximum recursion depth exceeded",
            "state": "prescreening_active",
            "timestamp": "2025-12-16T07:03:17.375329"
          }
        ]
      },
      "validation": {
        "passed": false,
        "overall_score": 21.0,
        "crash_prevention": {
          "passed": false,
          "score": 0.0,
          "error_count": 1,
          "errors": [
            {
              "type": "conversation_failure",
              "error": "maximum recursion depth exceeded",
              "state": "prescreening_active",
              "timestamp": "2025-12-16T07:03:17.375329"
            }
          ],
          "failures": [
            {
              "type": "crash",
              "error_type": "conversation_failure",
              "error_message": "maximum recursion depth exceeded",
              "likely_location": "Unknown - check full error trace",
              "severity": "critical"
            }
          ]
        },
        "eligibility_accuracy": {
          "passed": false,
          "score": 0.0,
          "reason": "Prescreening did not complete",
          "failures": [
            {
              "type": "eligibility_logic_error",
              "reason": "Prescreening flow did not complete",
              "final_state": "failed",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
              "severity": "high"
            }
          ]
        },
        "conversation_quality": {
          "passed": true,
          "score": 80.0,
          "total_questions_asked": 0,
          "issues": [
            "Too few questions asked (0, expected at least 4)"
          ],
          "failures": [
            {
              "type": "conversation_quality_issue",
              "issue": "Too few questions asked (0, expected at least 4)",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            }
          ]
        },
        "edge_case_handling": {
          "passed": false,
          "score": 50.0,
          "applicable": true,
          "edge_case_type": "contradictory_info",
          "completed": false,
          "failures": [
            {
              "type": "edge_case_handling_failure",
              "edge_case_type": "contradictory_info",
              "final_state": "failed",
              "reason": "Edge case caused conversation to fail",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            }
          ]
        },
        "performance": {
          "passed": false,
          "score": 40.0,
          "avg_response_time": 21.279089331626892,
          "max_response_time": 25.482574701309204,
          "status": "slow",
          "failures": [
            {
              "type": "performance_issue",
              "avg_response_time": 21.279089331626892,
              "max_response_time": 25.482574701309204,
              "severity": "low",
              "recommendation": "Investigate slow API responses or Gemini API delays"
            }
          ]
        },
        "failure_points": [
          {
            "type": "crash",
            "error_type": "conversation_failure",
            "error_message": "maximum recursion depth exceeded",
            "likely_location": "Unknown - check full error trace",
            "severity": "critical"
          },
          {
            "type": "eligibility_logic_error",
            "reason": "Prescreening flow did not complete",
            "final_state": "failed",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
            "severity": "high"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Too few questions asked (0, expected at least 4)",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "edge_case_handling_failure",
            "edge_case_type": "contradictory_info",
            "final_state": "failed",
            "reason": "Edge case caused conversation to fail",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "performance_issue",
            "avg_response_time": 21.279089331626892,
            "max_response_time": 25.482574701309204,
            "severity": "low",
            "recommendation": "Investigate slow API responses or Gemini API delays"
          }
        ],
        "recommendations": [
          "\ud83d\udea8 CRITICAL: Fix crashes and exceptions. Review error logs and add error handling.",
          "\u26a0\ufe0f HIGH: Review eligibility evaluation logic in gemini_prescreening_manager.py",
          "\u26a0\ufe0f MEDIUM: Improve edge case handling. Add input validation and clarification prompts.",
          "\u2139\ufe0f LOW: Slow response times. Optimize API calls or consider caching."
        ]
      },
      "timestamp": "2025-12-16T07:03:17.375537"
    },
    {
      "patient_id": "AUTO_TEST_targeted_gout_002",
      "patient_profile": {
        "patient_id": "AUTO_TEST_targeted_gout_002",
        "profile_type": "targeted",
        "demographics": {
          "age": 44,
          "gender": "male",
          "location": "Birmingham, AL",
          "name": "Test Gout Patient",
          "first_name": "Test",
          "last_name": "Patient"
        },
        "medical_history": {
          "primary_condition": "Gout",
          "conditions": [
            "Gout",
            "Hypertension"
          ],
          "medications": [
            "Lisinopril"
          ],
          "duration_years": 3,
          "flares_per_year": 4,
          "uric_acid_level": 8.5
        },
        "expected_behavior": {
          "should_find_trials": true,
          "likely_eligible": true,
          "expected_question_count_range": [
            5,
            8
          ],
          "target_trial_keywords": [
            "gout"
          ]
        }
      },
      "conversation_result": {
        "session_id": "AUTO_TEST_targeted_gout_002",
        "patient_id": "AUTO_TEST_targeted_gout_002",
        "conversation_log": [
          {
            "user_message": "Gout trials in Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Gout",
                "location": "Birmingham",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Of course. Finding the right clinical trial is an important step. I'm searching for Gout trials in the Birmingham, AL area for you now. Once I have the results, we can look them over, and I can even help you check if you might be eligible for any of them.",
                "new_state": "trials_found",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both a condition ('Gout') and a location ('Birmingham, AL'), which are the two necessary pieces of information to perform a trial search. The `search_trials` action is the most direct way to fulfill their request. The response confirms the search parameters and sets the stage for the next logical step, which is reviewing the trials and checking eligibility."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 19.753050804138184,
            "timestamp": "2025-12-16T07:07:39.044879"
          },
          {
            "user_message": "Yes, check my eligibility",
            "bot_response": "I need to know which specific trial you'd like to check eligibility for. Could you please search for trials first, or let me know what condition and location you're interested in?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "start_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": "yes",
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "start_prescreening",
                "parameters": {},
                "response_text": "Of course. I'll ask a few simple questions to see if you might be a match for any of the Gout trials in Birmingham. To start, could you please tell me your age?",
                "new_state": "prescreening",
                "collect_entities": [
                  "age"
                ],
                "metadata": {
                  "reasoning": "The user has explicitly confirmed they want to check their eligibility. We have the necessary condition (Gout) and location (Birmingham) to proceed. The next logical step is to begin the prescreening process by asking the first common eligibility question, which is typically age. This moves the conversation forward and directly addresses the user's request."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "prescreening_error": "no_trial_id_found"
            },
            "response_time": 23.311632871627808,
            "timestamp": "2025-12-16T07:08:02.356862"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Gout",
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Great, thank you for providing your location. I'm now searching for clinical trials for Gout near Birmingham, Alabama. I'll show you what I find, and if any look interesting, we can go through a few questions to see if you might be eligible. Please give me just a moment.",
                "new_state": "trials_presented",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both their condition (Gout, from the conversation context) and their location (Birmingham, AL). With this necessary information, the correct action is to search for relevant clinical trials. The response confirms the search parameters, sets the expectation that results are coming, and proactively introduces the next step of checking eligibility, aligning with the system's core principles."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 25.276487112045288,
            "timestamp": "2025-12-16T07:08:27.633946"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Great, thank you. I'll start searching for clinical trials for Gout in the Birmingham, Alabama area now. One moment while I look for studies that are currently recruiting.",
                "new_state": "trials_found",
                "collect_entities": null,
                "metadata": {
                  "reasoning": "The user has provided both their condition (Gout, from the context) and their location (Birmingham, AL). With this necessary information and a clear intent to find trials, the most appropriate action is to execute the search. This directly addresses the user's request and moves the conversation toward its goal."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 21.997498989105225,
            "timestamp": "2025-12-16T07:08:49.632094"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Okay, thank you. I will now search for Gout clinical trials happening near Birmingham, AL. Please give me just a moment to find the most relevant studies for you.",
                "new_state": "trials_found",
                "collect_entities": null,
                "metadata": {
                  "reasoning": "The user has provided both their condition (Gout) and their location (Birmingham, AL), which are the two essential pieces of information needed to find clinical trials. The user's message explicitly confirms the location for the search. Therefore, the most logical and helpful next step is to execute the search for trials."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 18.18388605117798,
            "timestamp": "2025-12-16T07:09:07.816410"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Great, thank you for confirming. I'm now searching for Gout clinical trials near Birmingham, Alabama. Please give me a moment to look that up for you.",
                "new_state": "trials_found",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided their location, which was the last piece of information needed. We now have both the condition (Gout) and location (Birmingham, AL), so the next logical step is to perform the search for clinical trials as requested. The response confirms the action and sets the user's expectation that a search is underway."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 12.064804315567017,
            "timestamp": "2025-12-16T07:09:19.881708"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Got it, thank you for confirming. I'll search for clinical trials for Gout in and around Birmingham, Alabama. One moment while I look that up for you.",
                "new_state": "search_complete",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has explicitly confirmed their location, and the system already has their condition (Gout). With both necessary pieces of information now available and confirmed, the most direct and helpful action is to proceed with the clinical trial search. The response acknowledges the user's confirmation, clearly states the action being taken, and sets a brief expectation for the search process."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 16.006380796432495,
            "timestamp": "2025-12-16T07:09:35.888813"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Thanks for confirming. I'm searching for clinical trials for Gout in Birmingham, Alabama now. I'll let you know what I find.",
                "new_state": "search_complete",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both the necessary condition (Gout) and location (Birmingham, AL). They are re-confirming their location, indicating a clear intent to find trials with this information. The most direct and helpful action is to execute the search for clinical trials based on the confirmed parameters. The response acknowledges their confirmation and clearly states the next step, moving the conversation forward."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 14.099792957305908,
            "timestamp": "2025-12-16T07:09:49.989601"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Thanks for confirming Birmingham, AL. I'll run the search again for Gout trials right now. Sometimes new studies are added, so it's always worth another look. If nothing comes up directly in the city this time, would you be open to me expanding the search to a wider area?",
                "new_state": "searching_trials",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both their condition (Gout) and location (Birmingham, AL). They are re-stating their location, which, given the conversation history, suggests they are prompting another search after a previous one likely failed. The most helpful and empathetic action is to perform the search again, acknowledging their persistence. Proactively suggesting an alternative (expanding the search radius) is a constructive next step in case this search also yields no results, keeping the conversation moving forward."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 31.23099684715271,
            "timestamp": "2025-12-16T07:10:21.221313"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Thanks for confirming. I'll search for Gout clinical trials happening in the Birmingham, AL area for you right now. Please give me a moment to find the latest results.",
                "new_state": "trials_presented",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided all the necessary information (condition: Gout, location: Birmingham, AL) to proceed with a search. They are re-stating their location, which signals a clear intent to find trials in that specific area. The best action is to execute the search and inform the user that the process has started."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 16.77013611793518,
            "timestamp": "2025-12-16T07:10:37.992114"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Thanks for confirming Birmingham, AL. I'm now searching for clinical trials for Gout in your area. Please give me a moment to find the latest studies.",
                "new_state": "trials_presented",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both the required condition (Gout) and location (Birmingham, AL). The last message confirmed the location. Therefore, the most appropriate action is to proceed with the search for clinical trials. The response acknowledges the user's confirmation and clearly states the next step, managing their expectations."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 16.3284969329834,
            "timestamp": "2025-12-16T07:10:54.321048"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Thanks for confirming. I'm searching for Gout clinical trials in and around Birmingham, AL for you now. One moment...",
                "new_state": "searching_trials",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided their location, and we already have their condition (Gout). The most direct and helpful action is to perform the clinical trial search they are requesting. Acknowledging their re-confirmed location and re-running the search respects their input, even if a previous search may have failed. The response confirms the action and sets expectations for the search results. The state is updated to `searching_trials` to reflect the current process."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 14.808373928070068,
            "timestamp": "2025-12-16T07:11:09.129894"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Thank you for confirming. I'm now searching for Gout clinical trials in the Birmingham, AL area. Please give me just a moment to see what's available.",
                "new_state": "trials_presented",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both the necessary pieces of information: their condition (Gout) and their location (Birmingham, AL). The user is repeating their location, which signals a strong intent to move forward with the search. Therefore, the most appropriate and helpful action is to execute the search for clinical trials immediately. The response confirms the information received and sets the expectation that results are forthcoming, moving the conversation into the next logical phase."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 13.245492219924927,
            "timestamp": "2025-12-16T07:11:22.375754"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Perfect, thank you for confirming. I'm searching for Gout clinical trials near Birmingham, AL for you now. This should only take a moment.",
                "new_state": "trials_presented",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both their condition (Gout) and location (Birmingham, AL), which are the two required pieces of information to perform a search. The user's message is a confirmation of their location, signaling they are ready to proceed. Therefore, the most appropriate action is to execute the search and inform the user that the results are on their way."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 17.744275093078613,
            "timestamp": "2025-12-16T07:11:40.120788"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Thanks for confirming. I'll run another search for Gout clinical trials specifically in Birmingham, AL for you right now. Let me see what I can find.",
                "new_state": "searching_trials",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both a condition (Gout) and a location (Birmingham, AL). The most recent message is a re-affirmation of the location, indicating a clear intent to have a search performed for that specific area. Despite the conversation history suggesting a previous search may have been unsuccessful, the most helpful and user-centric action is to honor their request and perform the search again. The response acknowledges their input and clearly states the next action, maintaining a supportive and helpful tone."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 33.81753993034363,
            "timestamp": "2025-12-16T07:12:13.938865"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Thank you for confirming. I'm now searching for clinical trials for Gout located in Birmingham, Alabama. I'll share what I find right away.",
                "new_state": "searching_trials",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both the necessary condition (Gout) and location (Birmingham, AL). They are re-stating their location, which indicates a clear intent to find trials specifically there. The previous search may have failed or been too broad, so re-running the search with the confirmed parameters is the most helpful next step. The response acknowledges their input, confirms the action being taken, and sets the expectation for the next turn."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 15.728101968765259,
            "timestamp": "2025-12-16T07:12:29.667674"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Got it, Birmingham, AL. Thank you for confirming. I'm searching for Gout clinical trials in your area now. I'll share the results with you in just a moment.",
                "new_state": "trials_found",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both their condition (Gout) and location (Birmingham, AL). Their repetition of the location indicates a clear intent to proceed with the search. Therefore, the most appropriate action is to execute the search for clinical trials using the information provided. This moves the conversation forward and directly addresses the user's goal."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 14.450078964233398,
            "timestamp": "2025-12-16T07:12:44.118601"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Perfect, thank you for confirming. I have everything I need now. Searching for Gout clinical trials near Birmingham, AL. This might take a moment.",
                "new_state": "trials_found",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both the required condition ('Gout') and location ('Birmingham, AL'). The user's message is a re-confirmation of their location, indicating they are ready for the search. Therefore, the most appropriate action is to execute the 'search_trials' function to find relevant studies and move the conversation forward."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 17.83299708366394,
            "timestamp": "2025-12-16T07:13:01.952261"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Got it, thanks for confirming. I'll search again for Gout clinical trials in Birmingham, AL. Let me see what I can find for you.",
                "new_state": "search_results",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both a condition (Gout) and a location (Birmingham, AL). The OpenAI reasoning suggests the user is re-confirming their location, likely after a previous search yielded no results. The most helpful and direct action is to honor their request and perform the search with the information we have. This moves the conversation forward toward the user's goal of finding relevant trials."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 14.482604742050171,
            "timestamp": "2025-12-16T07:13:16.435382"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Great, thanks for confirming Birmingham, AL. I'm now looking for Gout clinical trials in and around that area. Please give me a moment to find the most relevant results for you.",
                "new_state": "trials_found",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both their condition (Gout) and their location (Birmingham, AL). The necessary information to perform a search has been collected. The user is repeating their location, which strongly indicates they are waiting for the search to be executed. The most appropriate action is to proceed with the search to meet the user's primary goal. The state will be updated to 'trials_found' to reflect the next stage of the conversation."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 13.528110980987549,
            "timestamp": "2025-12-16T07:13:29.964181"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Thank you for confirming. I'll search again for Gout clinical trials specifically in the Birmingham, AL area for you now.",
                "new_state": "searching",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided all the necessary information (condition and location) and is re-confirming their location, indicating a clear intent to find trials. The previous search may have failed, but the user is insisting on the location. The most helpful action is to honor this request and execute the search again to show I've listened. This directly addresses their goal and moves the conversation forward."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 16.839507341384888,
            "timestamp": "2025-12-16T07:13:46.804136"
          },
          {
            "user_message": "Birmingham, AL",
            "bot_response": "I couldn't find any trials for Gout in Birmingham, AL at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_002",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Birmingham, AL",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Birmingham, AL"
                },
                "response_text": "Great, thanks for confirming Birmingham, AL. I'm searching for Gout clinical trials in your area now and will share what I find in just a moment.",
                "new_state": "trials_presented",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided their location, which was the final piece of information needed to perform a search. We have both the condition (Gout) and the location (Birmingham, AL). Therefore, the most helpful and logical next step is to execute the search for clinical trials and inform the user that this is what's happening. This directly addresses their implicit request and moves them closer to their goal of finding relevant trials."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Birmingham, AL"
            },
            "response_time": 13.0955810546875,
            "timestamp": "2025-12-16T07:13:59.900279"
          }
        ],
        "final_state": "completed",
        "total_turns": 22,
        "total_questions_asked": 0,
        "errors": [
          {
            "type": "too_many_questions",
            "questions_answered": 20
          }
        ]
      },
      "validation": {
        "passed": false,
        "overall_score": 50.0,
        "crash_prevention": {
          "passed": true,
          "score": 100.0,
          "error_count": 0,
          "errors": [],
          "failures": []
        },
        "eligibility_accuracy": {
          "passed": false,
          "score": 0.0,
          "reason": "Could not extract eligibility result",
          "failures": [
            {
              "type": "eligibility_logic_error",
              "reason": "No eligibility determination found in conversation",
              "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
              "severity": "high"
            }
          ]
        },
        "conversation_quality": {
          "passed": false,
          "score": 0.0,
          "total_questions_asked": 0,
          "issues": [
            "Too few questions asked (0, expected at least 5)",
            "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "Repeated question: I couldn't find any trials for Gout in Birmingham,..."
          ],
          "failures": [
            {
              "type": "conversation_quality_issue",
              "issue": "Too few questions asked (0, expected at least 5)",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            }
          ]
        },
        "edge_case_handling": {
          "passed": true,
          "score": 100.0,
          "applicable": false,
          "failures": []
        },
        "performance": {
          "passed": true,
          "score": 70.0,
          "avg_response_time": 18.20890123193914,
          "max_response_time": 33.81753993034363,
          "status": "acceptable",
          "failures": []
        },
        "failure_points": [
          {
            "type": "eligibility_logic_error",
            "reason": "No eligibility determination found in conversation",
            "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
            "severity": "high"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Too few questions asked (0, expected at least 5)",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Birmingham,...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          }
        ],
        "recommendations": [
          "\u26a0\ufe0f HIGH: Review eligibility evaluation logic in gemini_prescreening_manager.py",
          "\u26a0\ufe0f MEDIUM: Major conversation quality issues. Review question generation and response handling."
        ]
      },
      "timestamp": "2025-12-16T07:13:59.900901"
    },
    {
      "patient_id": "AUTO_TEST_targeted_psoriasis_003",
      "patient_profile": {
        "patient_id": "AUTO_TEST_targeted_psoriasis_003",
        "profile_type": "targeted",
        "demographics": {
          "age": 55,
          "gender": "female",
          "location": "Atlanta, GA",
          "name": "Test Psoriasis Patient",
          "first_name": "Test",
          "last_name": "Patient"
        },
        "medical_history": {
          "primary_condition": "Psoriasis",
          "conditions": [
            "Plaque Psoriasis"
          ],
          "medications": [
            "Topical Corticosteroids"
          ],
          "duration_years": 5,
          "pasi_score": 15,
          "body_surface_area": "20%"
        },
        "expected_behavior": {
          "should_find_trials": true,
          "likely_eligible": true,
          "expected_question_count_range": [
            4,
            7
          ],
          "target_trial_keywords": [
            "psoriasis",
            "dermatology"
          ]
        }
      },
      "conversation_result": {
        "session_id": "AUTO_TEST_targeted_psoriasis_003",
        "patient_id": "AUTO_TEST_targeted_psoriasis_003",
        "conversation_log": [
          {
            "user_message": "Psoriasis trials in Atlanta, GA",
            "bot_response": "Great! I found 5 clinical trial(s) available in Atlanta, GA:\n\n**Dr. Robert Springer**\n  \u2022 Female Pattern Hair Loss (Androgenetic Alopecia) (1 trial)\n  \u2022 Idiopathic Gastroparesis (1 trial)\n  \u2022 Gout (1 trial)\n  \u2022 Fibromyalgia (1 trial)\n\n**Dr. Zachary Eyre**\n  \u2022 Moderate to Severe Hidradenitis Suppurativa (1 trial)\n\nWould you like to:\n1. Check your eligibility for any of these trials?\n2. Learn more about a specific condition?\n3. See trials in a different location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_003",
              "current_state": "trials_shown",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Psoriasis",
                "location": "Atlanta",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Psoriasis",
                  "location": "Atlanta, GA"
                },
                "response_text": "Absolutely. I can search for Psoriasis clinical trials in the Atlanta, GA area for you. Let me pull up a list of what's available.\n\nOnce I have the results, I can also help you check if you might be eligible for any of them. I'll be right back with what I find.",
                "new_state": "awaiting_search_results",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both a specific condition ('Psoriasis') and a location ('Atlanta, GA'), which are the two essential pieces of information needed to perform a trial search. Therefore, the most appropriate action is `search_trials`. The response confirms that I have understood their request, tells them what I am doing, and proactively offers the next logical step (eligibility prescreening) to guide the conversation forward in a helpful way."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "trials_found": 5,
              "condition": "Psoriasis",
              "location": "Atlanta, GA",
              "trials_data": [
                {
                  "id": 14,
                  "trial_name": "Clinical Trial 250-13951-306",
                  "conditions": "Female Pattern Hair Loss (Androgenetic Alopecia)",
                  "description": null,
                  "investigator_name": "Dr. Robert Springer",
                  "site_location": "Atlanta, GA",
                  "protocol_summary": "This clinical trial aims to investigate the effectiveness and safety of an oral medication called VDPHL01 for treating female pattern hair loss (androgenetic alopecia).  The study will evaluate two different dosing regimens of VDPHL01: twice daily and once daily.  It will compare these regimens against a placebo to see if the medication promotes hair growth and improves patient satisfaction with their hair.\n\nWomen aged 18-65 with mild to moderate hair loss, as measured by the Savin Scale, are eligible to participate.  Key inclusion criteria include good general health, adequate kidney and liver function, and a commitment to maintaining consistent hair care routines throughout the study.  Women who are pregnant, breastfeeding, have certain medical conditions (like uncontrolled blood pressure or a history of heart problems), or have recently used other hair growth treatments are excluded.\n\nThe study will last approximately 13 months and consist of two parts. Part A is a 6-month placebo-controlled period, where participants are randomly assigned to one of four groups: VDPHL01 twice daily, VDPHL01 once daily plus placebo, placebo twice daily, or placebo twice daily.  Part B is a 6-month treatment extension, where those initially receiving placebo will start taking VDPHL01 according to their initial group assignment, while those already on VDPHL01 will continue.  Participants will have regular clinic visits (approximately 11) for assessments including physical exams, blood and urine tests, electrocardiograms, photographs of the scalp, and questionnaires about their hair and quality of life. A small group of participants will also take part in interviews.  A final follow-up will occur one month after the treatment period ends.\n",
                  "total_sites": 2,
                  "similarity_score": 0.8174656906579815
                },
                {
                  "id": 15,
                  "trial_name": "CIN-102-124",
                  "conditions": "Idiopathic Gastroparesis",
                  "description": null,
                  "investigator_name": "Dr. Robert Springer",
                  "site_location": "Atlanta, GA",
                  "protocol_summary": "This clinical trial aims to investigate the effectiveness and safety of CIN-102 (deudomperidone) in adults with idiopathic gastroparesis, a condition that slows the movement of food through the stomach.  Participants will receive either a placebo or one of two doses of CIN-102 (10mg or 15mg twice daily) for 12 weeks. The study's main goal is to determine if CIN-102 can reduce nausea severity compared to placebo.  Researchers will also assess changes in other gastroparesis symptoms like vomiting, fullness, early satiety, and abdominal pain.\n\nTo be eligible for the study, participants must be 18 years or older with a confirmed diagnosis of idiopathic gastroparesis, including both persistent symptoms and evidence of delayed gastric emptying.  Key exclusion criteria include having a known cause for their gastroparesis (like diabetes or surgery), certain heart conditions, specific gastrointestinal issues, or use of certain medications that could interfere with the study drug.  Women who are pregnant, breastfeeding, or planning to become pregnant are also excluded.\n\nThe study will last approximately 18 weeks, including a prescreening period, a screening and lead-in period of up to 5 weeks, a 12-week treatment period, and a follow-up period of up to 1 week.  Participants will attend up to 8 scheduled visits, including a gastric emptying breath test.  Throughout the study, they will track their symptoms daily using an electronic diary and will have regular assessments of their overall health and well-being.  Some participants may also choose to participate in additional assessments to help researchers understand how the drug is absorbed and processed by the body.",
                  "total_sites": 1,
                  "similarity_score": 0.7605316085699039
                },
                {
                  "id": 10,
                  "trial_name": "A Phase 2b, Randomized, Double-Blind, Placebo-Controlled, Multicenter Study of the Efficacy and Safety of Brensocatib in Adults with Moderate to Severe Hidradenitis Suppurativa \u2013 The CEDAR Study",
                  "conditions": "Moderate to Severe Hidradenitis Suppurativa",
                  "description": "",
                  "investigator_name": "Dr. Zachary Eyre",
                  "site_location": "Atlanta, GA",
                  "protocol_summary": "This study, called CEDAR, is investigating the effectiveness and safety of a new oral drug, brensocatib, for adults with moderate to severe hidradenitis suppurativa (HS). HS is a chronic skin condition that causes painful lumps, abscesses, and tunnels under the skin, often leaving scars.  Researchers believe brensocatib may help by reducing the activity of certain inflammatory cells involved in HS. The study aims to determine if brensocatib can reduce the number of skin lesions and improve overall skin condition in people with HS.\n\nTo be eligible for the study, participants must be between 18 and 80 years old with a confirmed HS diagnosis for at least six months. They must have at least six inflammatory lesions for at least eight weeks before joining the study and these lesions must be located in at least two different areas of the body, with at least one area having a certain level of severity (Hurley Stage II or III).  People with an excessively high number of draining tunnels or certain other skin conditions will be excluded, as will those who have recently received certain medications like systemic antibiotics (except for stable doses of doxycycline or minocycline), opioid painkillers (except tramadol), or biologic treatments for HS.\n\nThe CEDAR study is a 52-week, randomized, double-blind, placebo-controlled trial. This means participants are randomly assigned to receive either brensocatib (at a dose of 10mg or 40mg once daily) or a placebo pill. The study is divided into two treatment periods.  Period 1 lasts 16 weeks and compares brensocatib to placebo. Period 2 lasts 36 weeks, and all participants receive brensocatib (those initially on placebo will switch to either the 10mg or 40mg dose).  Throughout the study, participants will have regular visits to the clinic for assessments of their skin condition, pain levels, and overall quality of life. Blood samples will also be collected to monitor the drug's safety and measure its levels in the body.  Some participants will also be part of a sub-study involving skin tissue samples.  After the treatment periods, there is a 4-week follow-up period.",
                  "total_sites": 2,
                  "similarity_score": 0.7400376333369378
                }
              ],
              "semantic_search": true
            },
            "response_time": 22.26575803756714,
            "timestamp": "2025-12-16T07:07:41.558545"
          },
          {
            "user_message": "Yes, check my eligibility",
            "bot_response": "Great! I'll help you check your eligibility.\n\nI need to ask you a few questions about the psoriasis trial.\n\n**Question 1 of 4:** What is your age?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_003",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "start_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": "yes",
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "start_prescreening",
                "parameters": {},
                "response_text": "Great, I can help with that. To get started, could you please tell me which trial you're interested in? You can just tell me the number from the list.",
                "new_state": "prescreening_started",
                "collect_entities": [
                  "number"
                ],
                "metadata": {
                  "reasoning": "The user has explicitly confirmed they want to check their eligibility after being shown a list of trials. The current state is 'trials_shown'. The most logical next step is to begin the prescreening process. Since the user didn't specify which trial, the response needs to ask for clarification by asking for the trial number. This transitions the state to 'prescreening_started' to manage the eligibility check flow."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "prescreening_started": true,
              "trial_id": 14,
              "trial_name": "Clinical Trial 250-13951-306",
              "current_question_index": 0,
              "total_questions": 4,
              "current_question": "What is your age?",
              "expected_answer_type": "number"
            },
            "response_time": 18.631009101867676,
            "timestamp": "2025-12-16T07:08:00.190030"
          },
          {
            "user_message": "55",
            "bot_response": "Got it.\n\nHave you been diagnosed with mild to moderate aga with a score of i-4 by a doctor?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_003",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "continue_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": 55,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "continue_prescreening",
                "parameters": {
                  "last_answer": "55"
                },
                "response_text": "Got it, thanks. Just a couple more questions to see if this might be a good fit. Have you been diagnosed with moderate to severe plaque psoriasis for at least 6 months?",
                "new_state": "prescreening_active",
                "collect_entities": [
                  "boolean_answer"
                ],
                "metadata": {
                  "reasoning": "The user is in an active prescreening state and has just provided their age in response to a direct question. The most logical and helpful action is to continue the prescreening process by asking the next eligibility question. This moves the user closer to their goal of checking their potential eligibility for a trial."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "current_question_index": 1,
              "total_questions": 4,
              "current_question": "Have you been diagnosed with mild to moderate aga with a score of i-4 by a doctor?",
              "expected_answer_type": "yes_no",
              "parsed_answer": {
                "interpretation": "number",
                "confidence": 1.0
              }
            },
            "response_time": 20.599312782287598,
            "timestamp": "2025-12-16T07:08:20.789927"
          },
          {
            "user_message": "Yes, I have Psoriasis",
            "bot_response": "Thank you for that information.\n\nDo you meet the medical requirements needed to participate in this study?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_003",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "continue_prescreening",
              "entities_collected": {
                "condition": "Psoriasis",
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": true,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "continue_prescreening",
                "parameters": {},
                "response_text": "Okay, thank you for confirming. To continue with the eligibility check, could you please tell me your age? This is a common requirement for many studies.",
                "new_state": "prescreening_active",
                "collect_entities": [
                  "age"
                ],
                "metadata": {
                  "reasoning": "The user is in an active prescreening session and has just confirmed their condition. The logical next step is to continue the prescreening process by asking the next question. Age is a fundamental eligibility criterion for most clinical trials, making it a natural and necessary question to ask at this stage. The state remains 'prescreening_active' as we are still in the middle of the eligibility check."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "current_question_index": 2,
              "total_questions": 4,
              "current_question": "Do you meet the medical requirements needed to participate in this study?",
              "expected_answer_type": "yes_no",
              "parsed_answer": {
                "interpretation": "unclear",
                "confidence": 0.8
              }
            },
            "response_time": 38.111552715301514,
            "timestamp": "2025-12-16T07:08:58.901822"
          },
          {
            "user_message": "Yes, I believe I do",
            "bot_response": "Thank you.\n\nHave you been diagnosed with cancer within the past 5 years (excluding successfully treated skin cancer)?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_003",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "continue_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": true,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "continue_prescreening",
                "parameters": {},
                "response_text": "Okay, thank you for confirming. The next question is: Have you previously been treated with a biologic medication (such as Humira, Enbrel, or Stelara) for your psoriasis?",
                "new_state": "prescreening_active",
                "collect_entities": [
                  "boolean_answer",
                  "medication"
                ],
                "metadata": {
                  "reasoning": "The user has answered a prescreening question affirmatively. The current state is `prescreening_active`, indicating we are in the middle of an eligibility check. The most logical and helpful next step is to acknowledge their answer and proceed with the next question in the prescreening sequence to help them determine their potential eligibility. The new question is a common and relevant one for psoriasis trials."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "current_question_index": 3,
              "total_questions": 4,
              "current_question": "Have you been diagnosed with cancer within the past 5 years (excluding successfully treated skin cancer)?",
              "expected_answer_type": "yes_no",
              "parsed_answer": {
                "interpretation": "yes",
                "confidence": 1.0
              }
            },
            "response_time": 23.5939838886261,
            "timestamp": "2025-12-16T07:09:22.496376"
          },
          {
            "user_message": "Yes, I have Psoriasis",
            "bot_response": "Thanks for completing the prescreening! I have a few questions that need clarification:\n\n\u2713 Age: 55\n\u2713 Medical history: Yes\n\u2713 Current condition: Yes\n? Medical history: Yes, I have Psoriasis - needs clarification\n\nWould you like to:\n1. Continue with your current answers\n2. Update any responses\n\nPlease respond with '1' to continue or '2' to make changes.",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_003",
              "current_state": "prescreening_review",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "continue_prescreening",
              "entities_collected": {
                "condition": "Psoriasis",
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": true,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "continue_prescreening",
                "parameters": {},
                "response_text": "Thanks for confirming. Just a couple more questions to see if this trial might be a good fit. Are you over 18 years of age?",
                "new_state": "prescreening_active",
                "collect_entities": [
                  "age",
                  "boolean_answer"
                ],
                "metadata": {
                  "reasoning": "The user is in an active prescreening flow (state: prescreening_active) and has just answered the previous question, confirming their condition. The most logical next step is to continue with the next question in the prescreening sequence. A question about age is a standard and common eligibility criterion for clinical trials. The response acknowledges their answer, sets the expectation of a few more questions, and asks the next clear, simple question to move the process forward."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "pending_evaluation": true,
              "eligibility_result": "<coroutine object GeminiPrescreeningManager.evaluate_eligibility at 0x7fcc564f7ae0>",
              "summary": "\u2713 Age: 55\n\u2713 Medical history: Yes\n\u2713 Current condition: Yes\n? Medical history: Yes, I have Psoriasis - needs clarification"
            },
            "response_time": 45.08895492553711,
            "timestamp": "2025-12-16T07:10:07.585850"
          }
        ],
        "final_state": "completed",
        "total_turns": 6,
        "total_questions_asked": 4,
        "errors": [
          {
            "type": "unexpected_state",
            "bot_response": "Thanks for completing the prescreening! I have a few questions that need clarification:\n\n\u2713 Age: 55\n\u2713 Medical history: Yes\n\u2713 Current condition: Yes\n? Medical history: Yes, I have Psoriasis - needs clarification\n\nWould you like to:\n1. Continue with your current answers\n2. Update any responses\n\nPlease respond with '1' to continue or '2' to make changes."
          }
        ]
      },
      "validation": {
        "passed": false,
        "overall_score": 70.0,
        "crash_prevention": {
          "passed": true,
          "score": 100.0,
          "error_count": 0,
          "errors": [],
          "failures": []
        },
        "eligibility_accuracy": {
          "passed": false,
          "score": 0.0,
          "reason": "Could not extract eligibility result",
          "failures": [
            {
              "type": "eligibility_logic_error",
              "reason": "No eligibility determination found in conversation",
              "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
              "severity": "high"
            }
          ]
        },
        "conversation_quality": {
          "passed": true,
          "score": 100.0,
          "total_questions_asked": 4,
          "issues": [],
          "failures": []
        },
        "edge_case_handling": {
          "passed": true,
          "score": 100.0,
          "applicable": false,
          "failures": []
        },
        "performance": {
          "passed": false,
          "score": 40.0,
          "avg_response_time": 28.048428575197857,
          "max_response_time": 45.08895492553711,
          "status": "slow",
          "failures": [
            {
              "type": "performance_issue",
              "avg_response_time": 28.048428575197857,
              "max_response_time": 45.08895492553711,
              "severity": "low",
              "recommendation": "Investigate slow API responses or Gemini API delays"
            }
          ]
        },
        "failure_points": [
          {
            "type": "eligibility_logic_error",
            "reason": "No eligibility determination found in conversation",
            "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
            "severity": "high"
          },
          {
            "type": "performance_issue",
            "avg_response_time": 28.048428575197857,
            "max_response_time": 45.08895492553711,
            "severity": "low",
            "recommendation": "Investigate slow API responses or Gemini API delays"
          }
        ],
        "recommendations": [
          "\u26a0\ufe0f HIGH: Review eligibility evaluation logic in gemini_prescreening_manager.py",
          "\u2139\ufe0f LOW: Slow response times. Optimize API calls or consider caching."
        ]
      },
      "timestamp": "2025-12-16T07:10:07.586636"
    },
    {
      "patient_id": "AUTO_TEST_random_003",
      "patient_profile": {
        "patient_id": "AUTO_TEST_random_003",
        "profile_type": "random",
        "demographics": {
          "age": 66,
          "gender": "female",
          "location": "Baton Rouge, LA",
          "name": "Elizabeth Garcia",
          "first_name": "Elizabeth",
          "last_name": "Garcia"
        },
        "medical_history": {
          "primary_condition": "Gout",
          "conditions": [
            "Gout"
          ],
          "medications": [
            "Colchicine"
          ],
          "duration_years": 3
        },
        "expected_behavior": {
          "should_find_trials": true,
          "likely_eligible": true,
          "expected_question_count_range": [
            4,
            8
          ]
        }
      },
      "conversation_result": {
        "session_id": "AUTO_TEST_random_003",
        "patient_id": "AUTO_TEST_random_003",
        "conversation_log": [
          {
            "user_message": "Gout trials in Baton Rouge, LA",
            "bot_response": "Great! I found 5 clinical trial(s) available in Baton Rouge, LA:\n\n**Dr. Taylor Sanders**\n  \u2022 Gout (3 trials)\n  \u2022 Fibromyalgia (1 trial)\n\n**Dr. Ira Thorla**\n  \u2022 Female Pattern Hair Loss (Androgenetic Alopecia) (1 trial)\n\nWould you like to:\n1. Check your eligibility for any of these trials?\n2. Learn more about a specific condition?\n3. See trials in a different location?",
            "metadata": {
              "session_id": "AUTO_TEST_random_003",
              "current_state": "trials_shown",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Gout",
                "location": "Baton Rouge",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Baton Rouge, LA"
                },
                "response_text": "I can certainly help you look for gout clinical trials in Baton Rouge, LA. Let me start a search for you now. Once I find some options, I can also help you check if you might be eligible for them.",
                "new_state": "awaiting_search_results",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both a specific condition ('Gout') and a location ('Baton Rouge, LA'), which are the two required pieces of information to perform a trial search. The `search_trials` action is the most direct and helpful next step to fulfill the user's request. The response confirms the search parameters and proactively offers the next logical step (eligibility prescreening) to guide the conversation forward."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "trials_found": 5,
              "condition": "Gout",
              "location": "Baton Rouge, LA",
              "trials_data": [
                {
                  "id": 2,
                  "trial_name": "A Phase 3 Randomized, Double-blind, Multi-center, Placebo-controlled Study to Evaluate the Efficacy and Safety of AR882 in Participants with Gout",
                  "conditions": "Gout",
                  "description": "",
                  "investigator_name": "Dr. Taylor Sanders",
                  "site_location": "Baton Rouge, LA",
                  "protocol_summary": "The clinical trial, identified as Protocol AR882-301, is a Phase 3, randomized, double-blind, multi-center, placebo-controlled study designed to evaluate the efficacy and safety of the investigational drug AR882 in participants with gout. Sponsored by Arthrosi Therapeutics, Inc., this trial will be conducted across approximately 100 sites in the United States and Canada. The primary objective is to assess the ability of AR882 to reduce serum uric acid (sUA) levels in participants, with a specific focus on achieving sUA levels below 6.0 mg/dL by Month 6.\n\nParticipants in the trial will be randomly assigned to receive either AR882 or a placebo. The study will be double-blind, meaning neither the participants nor the investigators will know which treatment each participant is receiving. The intervention involves the administration of AR882, with the primary aim of evaluating its efficacy in lowering sUA levels and reducing tophus burden. The CAPER method will be employed to assess the response of target tophi, with evaluations conducted at Months 6 and 12 to determine the presence of disease progression.\n\nThe primary endpoint of the study is the proportion of participants achieving sUA levels below 6.0 mg/dL at Month 6. Secondary endpoints include the reduction of tophus burden and the maintenance of sUA levels below 6.0 mg/dL at Months 9 and 12, alongside the absence of gout flares over a three-month period. The trial will last until all participants have completed 12 months or have discontinued. Notable inclusion criteria include a diagnosis of gout and baseline tophi, while exclusion criteria may involve other significant health conditions that could interfere with the study's outcomes.",
                  "total_sites": 17,
                  "similarity_score": 0.8027487136996964
                },
                {
                  "id": 66,
                  "trial_name": "A Randomized, Double-blind, Multicenter, Colchicine and Placebo-controlled Study to Evaluate the Efficacy and Safety of ABP-745 in Subjects with an Acute Gout Flare",
                  "conditions": "Gout",
                  "description": "This is a Phase II, randomized, double-blind, placebo-controlled, multi-center study sponsored by Atom Therapeutics Co., Ltd.  The study will be conducted in the United States, Australia, and China and will last approximately 6 months for each participant, with the possibility of re-screening and continuing for another 6 months if no flare occurs in the initial period.  This means that neither you nor your doctor will know which treatment you are receiving, and participants will be randomly assigned to different treatment groups.  The study aims to determine how well ABP-745 works to treat acute gout flares compared to colchicine and a placebo.\n\nThis study is looking for men and women aged 18-70 with a BMI between 18 and 40 who have been diagnosed with gout and have experienced at least two gout flares in the past year.  You must be able to contact the study site and receive your first dose within 10 hours of a new flare starting, and you must be able to return to the site 24 hours after the first dose.  You will need to be able to attend several visits at the study site over a 7-day period during a flare and a final visit after treatment, as well as a safety follow-up phone call.  You may not be eligible to participate if you have certain other medical conditions or are taking certain medications.  Your doctor will discuss these criteria with you in more detail.\n\nParticipants will be randomly assigned to receive either ABP-745 (at one of two doses), colchicine, or a placebo.  The study will measure pain levels, tenderness, and swelling in your most affected joint.  The main goals are to see how much ABP-745 reduces pain at 24 hours after the first dose compared to colchicine and placebo.  Other measurements will include pain levels at later time points, the percentage of people who experience significant pain reduction, and how the treatment affects markers of inflammation in your blood.  You will take the study medication twice daily for 7 days during a flare.  You will have several visits to the study site during this time for assessments and blood draws.",
                  "investigator_name": "Dr. Taylor Sanders",
                  "site_location": "Baton Rouge, LA",
                  "protocol_summary": "This is a Phase II, randomized, double-blind, placebo-controlled, multi-center study sponsored by Atom Therapeutics Co., Ltd.  The study will be conducted in the United States, Australia, and China and will last approximately 6 months for each participant, with the possibility of re-screening and continuing for another 6 months if no flare occurs in the initial period.  This means that neither you nor your doctor will know which treatment you are receiving, and participants will be randomly assigned to different treatment groups.  The study aims to determine how well ABP-745 works to treat acute gout flares compared to colchicine and a placebo.\n\nThis study is looking for men and women aged 18-70 with a BMI between 18 and 40 who have been diagnosed with gout and have experienced at least two gout flares in the past year.  You must be able to contact the study site and receive your first dose within 10 hours of a new flare starting, and you must be able to return to the site 24 hours after the first dose.  You will need to be able to attend several visits at the study site over a 7-day period during a flare and a final visit after treatment, as well as a safety follow-up phone call.  You may not be eligible to participate if you have certain other medical conditions or are taking certain medications.  Your doctor will discuss these criteria with you in more detail.\n\nParticipants will be randomly assigned to receive either ABP-745 (at one of two doses), colchicine, or a placebo.  The study will measure pain levels, tenderness, and swelling in your most affected joint.  The main goals are to see how much ABP-745 reduces pain at 24 hours after the first dose compared to colchicine and placebo.  Other measurements will include pain levels at later time points, the percentage of people who experience significant pain reduction, and how the treatment affects markers of inflammation in your blood.  You will take the study medication twice daily for 7 days during a flare.  You will have several visits to the study site during this time for assessments and blood draws.",
                  "total_sites": 4,
                  "similarity_score": 0.7992400049183908
                },
                {
                  "id": 74,
                  "trial_name": "A Phase 3, Randomized, Double-Blind, Multicenter Study to Evaluate the Efficacy and Safety of Dotinurad Compared With Allopurinol in Adult Participants With Hyperuricemia Associated With Gout",
                  "conditions": "Gout",
                  "description": "This is a Phase 3, randomized, double-blind, multicenter study sponsored by Crystalys Therapeutics, Inc.  The study will be conducted at up to 100 sites across North America and Europe and is expected to last approximately 2.5 years.  \"Double-blind\" means neither you nor your study doctor will know which medicine you are taking. \"Randomized\" means you will be assigned to a treatment group by chance, like flipping a coin.  This helps ensure the results are unbiased.\n\nThis study is for adults with gout who have experienced at least two gout flares in the past year and have been taking a stable dose of allopurinol (300-600mg daily, or 200mg for those with moderate kidney problems) for at least 3 months.  You must also have a serum uric acid (sUA) level of 6.5 mg/dL or higher at two screening visits.  You will not be able to participate if you have certain other medical conditions (these will be discussed during screening).  During the study, you will be asked to keep a diary of your medication intake, any gout flares you experience, and any related healthcare visits.  \n\nIn this study, you will receive either dotinurad (the investigational drug) or allopurinol.  Dotinurad will be given in increasing doses over the first 12 weeks.  Allopurinol will be given at the same dose you were taking before the study began.  The study will measure how well each medication lowers sUA levels in your blood, reduces the number of gout flares you experience, and assess any side effects.  The main goal is to see if dotinurad is as effective as allopurinol in lowering sUA at 24 weeks.  Other goals include evaluating the impact on gout flares and overall safety.  You will have regular check-ups every 2 weeks initially, then every 4 weeks, and will be asked to complete questionnaires about your health.  Even if you stop taking the study medication, you will be encouraged to continue with the follow-up visits.",
                  "investigator_name": "Dr. Taylor Sanders",
                  "site_location": "Baton Rouge, LA",
                  "protocol_summary": "This is a Phase 3, randomized, double-blind, multicenter study sponsored by Crystalys Therapeutics, Inc.  The study will be conducted at up to 100 sites across North America and Europe and is expected to last approximately 2.5 years.  \"Double-blind\" means neither you nor your study doctor will know which medicine you are taking. \"Randomized\" means you will be assigned to a treatment group by chance, like flipping a coin.  This helps ensure the results are unbiased.\n\nThis study is for adults with gout who have experienced at least two gout flares in the past year and have been taking a stable dose of allopurinol (300-600mg daily, or 200mg for those with moderate kidney problems) for at least 3 months.  You must also have a serum uric acid (sUA) level of 6.5 mg/dL or higher at two screening visits.  You will not be able to participate if you have certain other medical conditions (these will be discussed during screening).  During the study, you will be asked to keep a diary of your medication intake, any gout flares you experience, and any related healthcare visits.  \n\nIn this study, you will receive either dotinurad (the investigational drug) or allopurinol.  Dotinurad will be given in increasing doses over the first 12 weeks.  Allopurinol will be given at the same dose you were taking before the study began.  The study will measure how well each medication lowers sUA levels in your blood, reduces the number of gout flares you experience, and assess any side effects.  The main goal is to see if dotinurad is as effective as allopurinol in lowering sUA at 24 weeks.  Other goals include evaluating the impact on gout flares and overall safety.  You will have regular check-ups every 2 weeks initially, then every 4 weeks, and will be asked to complete questionnaires about your health.  Even if you stop taking the study medication, you will be encouraged to continue with the follow-up visits.",
                  "total_sites": 13,
                  "similarity_score": 0.7947402273735418
                }
              ],
              "semantic_search": true
            },
            "response_time": 21.55542778968811,
            "timestamp": "2025-12-16T07:07:40.851518"
          },
          {
            "user_message": "Yes, check my eligibility",
            "bot_response": "Great! I'll help you check your eligibility.\n\nI need to ask you a few questions about the gout trial.\n\n**Question 1 of 5:** What is your age?",
            "metadata": {
              "session_id": "AUTO_TEST_random_003",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "start_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": "yes",
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "start_prescreening",
                "parameters": {},
                "response_text": "Great, I can certainly help with that. To get started, could you please tell me which trial from the list you're interested in? Just the number is fine. I'll then ask a few simple questions to see if it might be a good fit.",
                "new_state": "prescreening_started",
                "collect_entities": [
                  "number"
                ],
                "metadata": {
                  "reasoning": "The user has explicitly confirmed their interest in checking eligibility ('Yes, check my eligibility') after being shown a list of trials (State: trials_shown). The most logical next step is to begin the prescreening process. The action 'start_prescreening' is chosen to initiate this flow. The response acknowledges the user's request, explains the next step (asking a few questions), and prompts the user to specify which trial they are interested in, as multiple options may have been presented. This moves the conversation into the 'prescreening_started' state."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "prescreening_started": true,
              "trial_id": 2,
              "trial_name": "A Phase 3 Randomized, Double-blind, Multi-center, Placebo-controlled Study to Evaluate the Efficacy and Safety of AR882 in Participants with Gout",
              "current_question_index": 0,
              "total_questions": 5,
              "current_question": "What is your age?",
              "expected_answer_type": "number"
            },
            "response_time": 18.28030490875244,
            "timestamp": "2025-12-16T07:07:59.132161"
          },
          {
            "user_message": "66",
            "bot_response": "Got it.\n\nWhat is your current weight and height?",
            "metadata": {
              "session_id": "AUTO_TEST_random_003",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "continue_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": 66,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "continue_prescreening",
                "parameters": {},
                "response_text": "Great, thank you. Next question: Have you been officially diagnosed with Gout by a healthcare professional?",
                "new_state": "prescreening_active",
                "collect_entities": [
                  "boolean_answer"
                ],
                "metadata": {
                  "reasoning": "The user has answered the previous prescreening question (age) and the conversation state is 'prescreening_active'. The most logical and helpful next step is to continue with the next question in the eligibility screener to help the user complete the process."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "current_question_index": 1,
              "total_questions": 5,
              "current_question": "What is your current weight and height?",
              "expected_answer_type": "text",
              "parsed_answer": {
                "interpretation": "number",
                "confidence": 1.0
              }
            },
            "response_time": 20.76685619354248,
            "timestamp": "2025-12-16T07:08:19.899404"
          },
          {
            "user_message": "6'8\"",
            "bot_response": "I found your height (6'8\") but couldn't determine your weight. Could you specify your weight?\n\nExamples: '180 pounds', '180 lbs', '215', or '82 kg'",
            "metadata": {
              "session_id": "AUTO_TEST_random_003",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "continue_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": "6'8\"",
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "continue_prescreening",
                "parameters": {},
                "response_text": "Thanks for sharing that. And what is your current weight?",
                "new_state": "prescreening_active",
                "collect_entities": [
                  "number"
                ],
                "metadata": {
                  "reasoning": "The user is in an active prescreening session and has provided their height in response to a previous question. The logical next step is to acknowledge this information and ask for the remaining piece of information (their weight) to continue the eligibility check. This keeps the conversation flowing smoothly towards the user's goal of determining their eligibility."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "validation_error": true,
              "awaiting_correction": true,
              "current_question_index": 1
            },
            "response_time": 19.605636835098267,
            "timestamp": "2025-12-16T07:08:39.505700"
          }
        ],
        "final_state": "completed",
        "total_turns": 4,
        "total_questions_asked": 5,
        "errors": [
          {
            "type": "unexpected_state",
            "bot_response": "I found your height (6'8\") but couldn't determine your weight. Could you specify your weight?\n\nExamples: '180 pounds', '180 lbs', '215', or '82 kg'"
          }
        ]
      },
      "validation": {
        "passed": false,
        "overall_score": 70.0,
        "crash_prevention": {
          "passed": true,
          "score": 100.0,
          "error_count": 0,
          "errors": [],
          "failures": []
        },
        "eligibility_accuracy": {
          "passed": false,
          "score": 0.0,
          "reason": "Could not extract eligibility result",
          "failures": [
            {
              "type": "eligibility_logic_error",
              "reason": "No eligibility determination found in conversation",
              "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
              "severity": "high"
            }
          ]
        },
        "conversation_quality": {
          "passed": true,
          "score": 100.0,
          "total_questions_asked": 5,
          "issues": [],
          "failures": []
        },
        "edge_case_handling": {
          "passed": true,
          "score": 100.0,
          "applicable": false,
          "failures": []
        },
        "performance": {
          "passed": false,
          "score": 40.0,
          "avg_response_time": 20.052056431770325,
          "max_response_time": 21.55542778968811,
          "status": "slow",
          "failures": [
            {
              "type": "performance_issue",
              "avg_response_time": 20.052056431770325,
              "max_response_time": 21.55542778968811,
              "severity": "low",
              "recommendation": "Investigate slow API responses or Gemini API delays"
            }
          ]
        },
        "failure_points": [
          {
            "type": "eligibility_logic_error",
            "reason": "No eligibility determination found in conversation",
            "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
            "severity": "high"
          },
          {
            "type": "performance_issue",
            "avg_response_time": 20.052056431770325,
            "max_response_time": 21.55542778968811,
            "severity": "low",
            "recommendation": "Investigate slow API responses or Gemini API delays"
          }
        ],
        "recommendations": [
          "\u26a0\ufe0f HIGH: Review eligibility evaluation logic in gemini_prescreening_manager.py",
          "\u2139\ufe0f LOW: Slow response times. Optimize API calls or consider caching."
        ]
      },
      "timestamp": "2025-12-16T07:08:39.506503"
    },
    {
      "patient_id": "AUTO_TEST_edge_multimorbid_001",
      "patient_profile": {
        "patient_id": "AUTO_TEST_edge_multimorbid_001",
        "profile_type": "edge_case",
        "demographics": {
          "age": 56,
          "gender": "male",
          "location": "Atlanta, GA",
          "name": "Multi Condition Patient",
          "first_name": "Multi",
          "last_name": "Patient"
        },
        "medical_history": {
          "primary_condition": "Plaque Psoriasis",
          "conditions": [
            "Plaque Psoriasis",
            "Gout",
            "Androgenetic Alopecia",
            "Major Depressive Disorder",
            "Acne Vulgaris"
          ],
          "medications": [
            "Allopurinol",
            "Escitalopram",
            "Biotin",
            "Biologics",
            "Probenecid"
          ],
          "duration_years": 10
        },
        "expected_behavior": {
          "should_find_trials": true,
          "likely_eligible": false,
          "expected_question_count_range": [
            5,
            10
          ],
          "edge_case_type": "multi_morbidity"
        }
      },
      "conversation_result": {
        "session_id": "AUTO_TEST_edge_multimorbid_001",
        "patient_id": "AUTO_TEST_edge_multimorbid_001",
        "conversation_log": [
          {
            "user_message": "Plaque Psoriasis trials in Atlanta, GA",
            "bot_response": "Great! I found 5 clinical trial(s) available in Atlanta, GA:\n\n**Dr. Robert Springer**\n  \u2022 Female Pattern Hair Loss (Androgenetic Alopecia) (1 trial)\n  \u2022 Idiopathic Gastroparesis (1 trial)\n  \u2022 Gout (1 trial)\n  \u2022 COVID-19 (1 trial)\n\n**Dr. Zachary Eyre**\n  \u2022 Moderate to Severe Hidradenitis Suppurativa (1 trial)\n\nWould you like to:\n1. Check your eligibility for any of these trials?\n2. Learn more about a specific condition?\n3. See trials in a different location?",
            "metadata": {
              "session_id": "AUTO_TEST_edge_multimorbid_001",
              "current_state": "trials_shown",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Plaque Psoriasis",
                "location": "Atlanta",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Plaque Psoriasis",
                  "location": "Atlanta, GA"
                },
                "response_text": "Of course. Finding the right clinical trial is an important step, and I'm here to help you with that. Let me search for Plaque Psoriasis trials in the Atlanta, GA area for you now. One moment...",
                "new_state": "trial_search_results",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both a specific condition ('Plaque Psoriasis') and a location ('Atlanta, GA'), which are the two necessary pieces of information to perform a trial search. The intent is clearly 'trial_search'. Therefore, the most direct and helpful action is to execute the search immediately. The response confirms the user's request, sets expectations for the search, and maintains a supportive and helpful tone."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "trials_found": 5,
              "condition": "Plaque Psoriasis",
              "location": "Atlanta, GA",
              "trials_data": [
                {
                  "id": 14,
                  "trial_name": "Clinical Trial 250-13951-306",
                  "conditions": "Female Pattern Hair Loss (Androgenetic Alopecia)",
                  "description": null,
                  "investigator_name": "Dr. Robert Springer",
                  "site_location": "Atlanta, GA",
                  "protocol_summary": "This clinical trial aims to investigate the effectiveness and safety of an oral medication called VDPHL01 for treating female pattern hair loss (androgenetic alopecia).  The study will evaluate two different dosing regimens of VDPHL01: twice daily and once daily.  It will compare these regimens against a placebo to see if the medication promotes hair growth and improves patient satisfaction with their hair.\n\nWomen aged 18-65 with mild to moderate hair loss, as measured by the Savin Scale, are eligible to participate.  Key inclusion criteria include good general health, adequate kidney and liver function, and a commitment to maintaining consistent hair care routines throughout the study.  Women who are pregnant, breastfeeding, have certain medical conditions (like uncontrolled blood pressure or a history of heart problems), or have recently used other hair growth treatments are excluded.\n\nThe study will last approximately 13 months and consist of two parts. Part A is a 6-month placebo-controlled period, where participants are randomly assigned to one of four groups: VDPHL01 twice daily, VDPHL01 once daily plus placebo, placebo twice daily, or placebo twice daily.  Part B is a 6-month treatment extension, where those initially receiving placebo will start taking VDPHL01 according to their initial group assignment, while those already on VDPHL01 will continue.  Participants will have regular clinic visits (approximately 11) for assessments including physical exams, blood and urine tests, electrocardiograms, photographs of the scalp, and questionnaires about their hair and quality of life. A small group of participants will also take part in interviews.  A final follow-up will occur one month after the treatment period ends.\n",
                  "total_sites": 2,
                  "similarity_score": 0.8104076557281819
                },
                {
                  "id": 15,
                  "trial_name": "CIN-102-124",
                  "conditions": "Idiopathic Gastroparesis",
                  "description": null,
                  "investigator_name": "Dr. Robert Springer",
                  "site_location": "Atlanta, GA",
                  "protocol_summary": "This clinical trial aims to investigate the effectiveness and safety of CIN-102 (deudomperidone) in adults with idiopathic gastroparesis, a condition that slows the movement of food through the stomach.  Participants will receive either a placebo or one of two doses of CIN-102 (10mg or 15mg twice daily) for 12 weeks. The study's main goal is to determine if CIN-102 can reduce nausea severity compared to placebo.  Researchers will also assess changes in other gastroparesis symptoms like vomiting, fullness, early satiety, and abdominal pain.\n\nTo be eligible for the study, participants must be 18 years or older with a confirmed diagnosis of idiopathic gastroparesis, including both persistent symptoms and evidence of delayed gastric emptying.  Key exclusion criteria include having a known cause for their gastroparesis (like diabetes or surgery), certain heart conditions, specific gastrointestinal issues, or use of certain medications that could interfere with the study drug.  Women who are pregnant, breastfeeding, or planning to become pregnant are also excluded.\n\nThe study will last approximately 18 weeks, including a prescreening period, a screening and lead-in period of up to 5 weeks, a 12-week treatment period, and a follow-up period of up to 1 week.  Participants will attend up to 8 scheduled visits, including a gastric emptying breath test.  Throughout the study, they will track their symptoms daily using an electronic diary and will have regular assessments of their overall health and well-being.  Some participants may also choose to participate in additional assessments to help researchers understand how the drug is absorbed and processed by the body.",
                  "total_sites": 1,
                  "similarity_score": 0.7528921997285716
                },
                {
                  "id": 2,
                  "trial_name": "A Phase 3 Randomized, Double-blind, Multi-center, Placebo-controlled Study to Evaluate the Efficacy and Safety of AR882 in Participants with Gout",
                  "conditions": "Gout",
                  "description": "",
                  "investigator_name": "Dr. Robert Springer",
                  "site_location": "Atlanta, GA",
                  "protocol_summary": "The clinical trial, identified as Protocol AR882-301, is a Phase 3, randomized, double-blind, multi-center, placebo-controlled study designed to evaluate the efficacy and safety of the investigational drug AR882 in participants with gout. Sponsored by Arthrosi Therapeutics, Inc., this trial will be conducted across approximately 100 sites in the United States and Canada. The primary objective is to assess the ability of AR882 to reduce serum uric acid (sUA) levels in participants, with a specific focus on achieving sUA levels below 6.0 mg/dL by Month 6.\n\nParticipants in the trial will be randomly assigned to receive either AR882 or a placebo. The study will be double-blind, meaning neither the participants nor the investigators will know which treatment each participant is receiving. The intervention involves the administration of AR882, with the primary aim of evaluating its efficacy in lowering sUA levels and reducing tophus burden. The CAPER method will be employed to assess the response of target tophi, with evaluations conducted at Months 6 and 12 to determine the presence of disease progression.\n\nThe primary endpoint of the study is the proportion of participants achieving sUA levels below 6.0 mg/dL at Month 6. Secondary endpoints include the reduction of tophus burden and the maintenance of sUA levels below 6.0 mg/dL at Months 9 and 12, alongside the absence of gout flares over a three-month period. The trial will last until all participants have completed 12 months or have discontinued. Notable inclusion criteria include a diagnosis of gout and baseline tophi, while exclusion criteria may involve other significant health conditions that could interfere with the study's outcomes.",
                  "total_sites": 17,
                  "similarity_score": 0.732665658527864
                }
              ],
              "semantic_search": true
            },
            "response_time": 19.974045991897583,
            "timestamp": "2025-12-16T07:14:19.875419"
          },
          {
            "user_message": "Yes, check my eligibility",
            "bot_response": "Great! I'll help you check your eligibility.\n\nI need to ask you a few questions about the plaque psoriasis trial.\n\n**Question 1 of 4:** What is your age?",
            "metadata": {
              "session_id": "AUTO_TEST_edge_multimorbid_001",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "start_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": true,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "start_prescreening",
                "parameters": {},
                "response_text": "Great, I can help with that. I'll ask a few simple questions to see if you might be a match for any of these trials. This is just a preliminary check, and the final decision is always up to the study team.\n\nTo start, could you please tell me your age?",
                "new_state": "prescreening_started",
                "collect_entities": [
                  "age"
                ],
                "metadata": {
                  "reasoning": "The user has explicitly confirmed their desire to check eligibility after being shown a list of trials. The current state is 'trials_shown', and we have the necessary condition and location. The most logical next step is to initiate the prescreening process. The first standard question in a prescreening flow is age, as it's a common and critical eligibility criterion. The state is updated to 'prescreening_started' to reflect this new phase of the conversation."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "prescreening_started": true,
              "trial_id": 14,
              "trial_name": "Clinical Trial 250-13951-306",
              "current_question_index": 0,
              "total_questions": 4,
              "current_question": "What is your age?",
              "expected_answer_type": "number"
            },
            "response_time": 19.12433099746704,
            "timestamp": "2025-12-16T07:14:39.000199"
          },
          {
            "user_message": "56",
            "bot_response": "Got it.\n\nHave you been diagnosed with mild to moderate aga with a score of i-4 by a doctor?",
            "metadata": {
              "session_id": "AUTO_TEST_edge_multimorbid_001",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "continue_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": 56,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "continue_prescreening",
                "parameters": {
                  "last_answer": {
                    "question": "age",
                    "answer": 56
                  }
                },
                "response_text": "Okay, thank you. Next question: Have you previously used a biologic medication (like Humira, Stelara, or Cosentyx) for your psoriasis?",
                "new_state": "prescreening_active",
                "collect_entities": [
                  "boolean_answer"
                ],
                "metadata": {
                  "reasoning": "The user is in an active prescreening flow and has just provided their age in response to a question. The correct action is to continue the prescreening process by acknowledging their answer and asking the next logical eligibility question for a Plaque Psoriasis trial. The state remains 'prescreening_active' as the process is not yet complete."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "current_question_index": 1,
              "total_questions": 4,
              "current_question": "Have you been diagnosed with mild to moderate aga with a score of i-4 by a doctor?",
              "expected_answer_type": "yes_no",
              "parsed_answer": {
                "interpretation": "number",
                "confidence": 1.0
              }
            },
            "response_time": 27.54667901992798,
            "timestamp": "2025-12-16T07:15:06.547371"
          },
          {
            "user_message": "Yes, I have Plaque Psoriasis",
            "bot_response": "I noted that down.\n\nDo you meet the medical requirements needed to participate in this study?",
            "metadata": {
              "session_id": "AUTO_TEST_edge_multimorbid_001",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "continue_prescreening",
              "entities_collected": {
                "condition": "Plaque Psoriasis",
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": true,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "continue_prescreening",
                "parameters": {},
                "response_text": "Great, thank you for confirming. To continue with the prescreening, could you tell me if you are 18 years of age or older?",
                "new_state": "prescreening_active",
                "collect_entities": [
                  "age",
                  "boolean_answer"
                ],
                "metadata": {
                  "reasoning": "The user is in an active prescreening session (state: prescreening_active) and has just answered the previous question. The correct action is to continue the process by asking the next logical eligibility question. Age is a fundamental and common screening criterion, making it a natural next step. The response acknowledges their answer and clearly poses the next question to keep the process moving smoothly."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "current_question_index": 2,
              "total_questions": 4,
              "current_question": "Do you meet the medical requirements needed to participate in this study?",
              "expected_answer_type": "yes_no",
              "parsed_answer": {
                "interpretation": "unclear",
                "confidence": 0.7
              }
            },
            "response_time": 34.2875189781189,
            "timestamp": "2025-12-16T07:15:40.835630"
          },
          {
            "user_message": "Yes, I believe I do",
            "bot_response": "Thank you.\n\nHave you been diagnosed with cancer within the past 5 years (excluding successfully treated skin cancer)?",
            "metadata": {
              "session_id": "AUTO_TEST_edge_multimorbid_001",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "continue_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": true,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "continue_prescreening",
                "parameters": {},
                "response_text": "Great, thank you for confirming. The next question is: Have you used any biologic medications (like Humira, Stelara, or Cosentyx) to treat your psoriasis in the past 6 months?",
                "new_state": "prescreening_active",
                "collect_entities": [
                  "boolean_answer",
                  "medication"
                ],
                "metadata": {
                  "reasoning": "The user is in an active prescreening session and has provided an affirmative answer to the previous question. The correct action is to continue the process by asking the next logical eligibility question. This question about prior biologic medication use is a common and critical inclusion/exclusion criterion for psoriasis trials. The state remains 'prescreening_active' as the screening is not yet complete."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "current_question_index": 3,
              "total_questions": 4,
              "current_question": "Have you been diagnosed with cancer within the past 5 years (excluding successfully treated skin cancer)?",
              "expected_answer_type": "yes_no",
              "parsed_answer": {
                "interpretation": "yes",
                "confidence": 1.0
              }
            },
            "response_time": 24.315189123153687,
            "timestamp": "2025-12-16T07:16:05.151826"
          },
          {
            "user_message": "Yes, I have Plaque Psoriasis",
            "bot_response": "Thanks for completing the prescreening! I have a few questions that need clarification:\n\n\u2713 Age: 56\n? Medical history: Yes, I have Plaque Psoriasis - needs clarification\n\u2713 Current condition: Yes\n\u2713 Medical history: Yes\n\nWould you like to:\n1. Continue with your current answers\n2. Update any responses\n\nPlease respond with '1' to continue or '2' to make changes.",
            "metadata": {
              "session_id": "AUTO_TEST_edge_multimorbid_001",
              "current_state": "prescreening_review",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "continue_prescreening",
              "entities_collected": {
                "condition": "Plaque Psoriasis",
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": true,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "continue_prescreening",
                "parameters": {},
                "response_text": "Great, thank you for confirming. The next question is: are you 18 years of age or older?",
                "new_state": "prescreening_active",
                "collect_entities": [
                  "age",
                  "boolean_answer"
                ],
                "metadata": {
                  "reasoning": "The user has confirmed their condition, which was likely the first question in the prescreening flow. The current state is 'prescreening_active', indicating we are in the middle of an eligibility check. The most logical next step is to continue with the next question. Asking for age is a standard, non-intrusive, and common eligibility criterion, making it a good follow-up question. The state remains 'prescreening_active' as the process is ongoing."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "pending_evaluation": true,
              "eligibility_result": "<coroutine object GeminiPrescreeningManager.evaluate_eligibility at 0x7fcc56311540>",
              "summary": "\u2713 Age: 56\n? Medical history: Yes, I have Plaque Psoriasis - needs clarification\n\u2713 Current condition: Yes\n\u2713 Medical history: Yes"
            },
            "response_time": 37.862247943878174,
            "timestamp": "2025-12-16T07:16:43.014804"
          }
        ],
        "final_state": "completed",
        "total_turns": 6,
        "total_questions_asked": 4,
        "errors": [
          {
            "type": "unexpected_state",
            "bot_response": "Thanks for completing the prescreening! I have a few questions that need clarification:\n\n\u2713 Age: 56\n? Medical history: Yes, I have Plaque Psoriasis - needs clarification\n\u2713 Current condition: Yes\n\u2713 Medical history: Yes\n\nWould you like to:\n1. Continue with your current answers\n2. Update any responses\n\nPlease respond with '1' to continue or '2' to make changes."
          }
        ]
      },
      "validation": {
        "passed": false,
        "overall_score": 66.0,
        "crash_prevention": {
          "passed": true,
          "score": 100.0,
          "error_count": 0,
          "errors": [],
          "failures": []
        },
        "eligibility_accuracy": {
          "passed": false,
          "score": 0.0,
          "reason": "Could not extract eligibility result",
          "failures": [
            {
              "type": "eligibility_logic_error",
              "reason": "No eligibility determination found in conversation",
              "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
              "severity": "high"
            }
          ]
        },
        "conversation_quality": {
          "passed": true,
          "score": 80.0,
          "total_questions_asked": 4,
          "issues": [
            "Too few questions asked (4, expected at least 5)"
          ],
          "failures": [
            {
              "type": "conversation_quality_issue",
              "issue": "Too few questions asked (4, expected at least 5)",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            }
          ]
        },
        "edge_case_handling": {
          "passed": true,
          "score": 100.0,
          "applicable": true,
          "edge_case_type": "multi_morbidity",
          "completed": true,
          "failures": []
        },
        "performance": {
          "passed": false,
          "score": 40.0,
          "avg_response_time": 27.185002009073894,
          "max_response_time": 37.862247943878174,
          "status": "slow",
          "failures": [
            {
              "type": "performance_issue",
              "avg_response_time": 27.185002009073894,
              "max_response_time": 37.862247943878174,
              "severity": "low",
              "recommendation": "Investigate slow API responses or Gemini API delays"
            }
          ]
        },
        "failure_points": [
          {
            "type": "eligibility_logic_error",
            "reason": "No eligibility determination found in conversation",
            "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
            "severity": "high"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Too few questions asked (4, expected at least 5)",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "performance_issue",
            "avg_response_time": 27.185002009073894,
            "max_response_time": 37.862247943878174,
            "severity": "low",
            "recommendation": "Investigate slow API responses or Gemini API delays"
          }
        ],
        "recommendations": [
          "\u26a0\ufe0f HIGH: Review eligibility evaluation logic in gemini_prescreening_manager.py",
          "\u2139\ufe0f LOW: Slow response times. Optimize API calls or consider caching."
        ]
      },
      "timestamp": "2025-12-16T07:16:43.015565"
    }
  ]
}