{
  "test_run_id": "test_run_2025-12-16_05-04-32",
  "timestamp": "2025-12-16T05:04:32.371882",
  "configuration": {
    "api_base_url": "https://gemini-chatbot-480267397633.us-central1.run.app",
    "num_tests": 50,
    "parallel": 5,
    "timeout": 120,
    "save_reports": true,
    "report_dir": "automated_testing/reports"
  },
  "summary": {
    "total_tests": 10,
    "passed": 0,
    "failed": 10,
    "pass_rate": 0.0,
    "average_overall_score": 34.9,
    "average_response_time": 19.681273823976518
  },
  "metrics": {
    "crash_prevention": {
      "average_score": 20.0,
      "passed": 2,
      "failed": 8
    },
    "eligibility_accuracy": {
      "average_score": 0.0,
      "passed": 0,
      "failed": 10
    },
    "conversation_quality": {
      "average_score": 90.5,
      "passed": 9,
      "failed": 1
    },
    "edge_case_handling": {
      "average_score": 40.0,
      "applicable_tests": 2,
      "passed": 8
    },
    "performance": {
      "average_response_time": 19.681273823976518,
      "passed": 5
    }
  },
  "failure_summary": {
    "total_failures": 38,
    "by_type": {
      "eligibility_logic_error": 10,
      "conversation_quality_issue": 5,
      "performance_issue": 5,
      "crash": 16,
      "edge_case_handling_failure": 2
    }
  },
  "failures": [
    {
      "test_id": "AUTO_TEST_random_000",
      "patient_profile": {
        "age": 53,
        "conditions": [
          "Copd"
        ],
        "medications": [
          "Breo Ellipta"
        ]
      },
      "type": "eligibility_logic_error",
      "reason": "No eligibility determination found in conversation",
      "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
      "severity": "high"
    },
    {
      "test_id": "AUTO_TEST_random_000",
      "patient_profile": {
        "age": 53,
        "conditions": [
          "Copd"
        ],
        "medications": [
          "Breo Ellipta"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Too few questions asked (0, expected at least 4)",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_random_000",
      "patient_profile": {
        "age": 53,
        "conditions": [
          "Copd"
        ],
        "medications": [
          "Breo Ellipta"
        ]
      },
      "type": "performance_issue",
      "avg_response_time": 20.241539359092712,
      "max_response_time": 23.898568868637085,
      "severity": "low",
      "recommendation": "Investigate slow API responses or Gemini API delays"
    },
    {
      "test_id": "AUTO_TEST_random_002",
      "patient_profile": {
        "age": 63,
        "conditions": [
          "Hypertension"
        ],
        "medications": [
          "Amlodipine"
        ]
      },
      "type": "crash",
      "error_type": "timeout",
      "error_message": "Unknown error",
      "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
      "severity": "critical"
    },
    {
      "test_id": "AUTO_TEST_random_002",
      "patient_profile": {
        "age": 63,
        "conditions": [
          "Hypertension"
        ],
        "medications": [
          "Amlodipine"
        ]
      },
      "type": "crash",
      "error_type": "conversation_failure",
      "error_message": "",
      "likely_location": "Unknown - check full error trace",
      "severity": "critical"
    },
    {
      "test_id": "AUTO_TEST_random_002",
      "patient_profile": {
        "age": 63,
        "conditions": [
          "Hypertension"
        ],
        "medications": [
          "Amlodipine"
        ]
      },
      "type": "eligibility_logic_error",
      "reason": "Prescreening flow did not complete",
      "final_state": "failed",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
      "severity": "high"
    },
    {
      "test_id": "AUTO_TEST_targeted_psoriasis_003",
      "patient_profile": {
        "age": 32,
        "conditions": [
          "Plaque Psoriasis"
        ],
        "medications": [
          "Topical Corticosteroids"
        ]
      },
      "type": "crash",
      "error_type": "timeout",
      "error_message": "Unknown error",
      "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
      "severity": "critical"
    },
    {
      "test_id": "AUTO_TEST_targeted_psoriasis_003",
      "patient_profile": {
        "age": 32,
        "conditions": [
          "Plaque Psoriasis"
        ],
        "medications": [
          "Topical Corticosteroids"
        ]
      },
      "type": "crash",
      "error_type": "conversation_failure",
      "error_message": "",
      "likely_location": "Unknown - check full error trace",
      "severity": "critical"
    },
    {
      "test_id": "AUTO_TEST_targeted_psoriasis_003",
      "patient_profile": {
        "age": 32,
        "conditions": [
          "Plaque Psoriasis"
        ],
        "medications": [
          "Topical Corticosteroids"
        ]
      },
      "type": "eligibility_logic_error",
      "reason": "Prescreening flow did not complete",
      "final_state": "failed",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
      "severity": "high"
    },
    {
      "test_id": "AUTO_TEST_targeted_psoriasis_003",
      "patient_profile": {
        "age": 32,
        "conditions": [
          "Plaque Psoriasis"
        ],
        "medications": [
          "Topical Corticosteroids"
        ]
      },
      "type": "performance_issue",
      "avg_response_time": 20.24653124809265,
      "max_response_time": 22.55450701713562,
      "severity": "low",
      "recommendation": "Investigate slow API responses or Gemini API delays"
    },
    {
      "test_id": "AUTO_TEST_edge_age_001",
      "patient_profile": {
        "age": 18,
        "conditions": [
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "crash",
      "error_type": "timeout",
      "error_message": "Unknown error",
      "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
      "severity": "critical"
    },
    {
      "test_id": "AUTO_TEST_edge_age_001",
      "patient_profile": {
        "age": 18,
        "conditions": [
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "crash",
      "error_type": "conversation_failure",
      "error_message": "",
      "likely_location": "Unknown - check full error trace",
      "severity": "critical"
    },
    {
      "test_id": "AUTO_TEST_edge_age_001",
      "patient_profile": {
        "age": 18,
        "conditions": [
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "eligibility_logic_error",
      "reason": "Prescreening flow did not complete",
      "final_state": "failed",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
      "severity": "high"
    },
    {
      "test_id": "AUTO_TEST_edge_age_001",
      "patient_profile": {
        "age": 18,
        "conditions": [
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "edge_case_handling_failure",
      "edge_case_type": "extreme_age",
      "final_state": "failed",
      "reason": "Edge case caused conversation to fail",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_edge_age_001",
      "patient_profile": {
        "age": 18,
        "conditions": [
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "performance_issue",
      "avg_response_time": 22.75115712483724,
      "max_response_time": 25.04991626739502,
      "severity": "low",
      "recommendation": "Investigate slow API responses or Gemini API delays"
    },
    {
      "test_id": "AUTO_TEST_random_003",
      "patient_profile": {
        "age": 48,
        "conditions": [
          "Gout",
          "Diabetes"
        ],
        "medications": [
          "Probenecid",
          "Allopurinol"
        ]
      },
      "type": "crash",
      "error_type": "timeout",
      "error_message": "Unknown error",
      "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
      "severity": "critical"
    },
    {
      "test_id": "AUTO_TEST_random_003",
      "patient_profile": {
        "age": 48,
        "conditions": [
          "Gout",
          "Diabetes"
        ],
        "medications": [
          "Probenecid",
          "Allopurinol"
        ]
      },
      "type": "crash",
      "error_type": "conversation_failure",
      "error_message": "",
      "likely_location": "Unknown - check full error trace",
      "severity": "critical"
    },
    {
      "test_id": "AUTO_TEST_random_003",
      "patient_profile": {
        "age": 48,
        "conditions": [
          "Gout",
          "Diabetes"
        ],
        "medications": [
          "Probenecid",
          "Allopurinol"
        ]
      },
      "type": "eligibility_logic_error",
      "reason": "Prescreening flow did not complete",
      "final_state": "failed",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
      "severity": "high"
    },
    {
      "test_id": "AUTO_TEST_random_003",
      "patient_profile": {
        "age": 48,
        "conditions": [
          "Gout",
          "Diabetes"
        ],
        "medications": [
          "Probenecid",
          "Allopurinol"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Too few questions asked (0, expected at least 4)",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_000",
      "patient_profile": {
        "age": 34,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "crash",
      "error_type": "timeout",
      "error_message": "Unknown error",
      "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
      "severity": "critical"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_000",
      "patient_profile": {
        "age": 34,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "crash",
      "error_type": "conversation_failure",
      "error_message": "",
      "likely_location": "Unknown - check full error trace",
      "severity": "critical"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_000",
      "patient_profile": {
        "age": 34,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "eligibility_logic_error",
      "reason": "Prescreening flow did not complete",
      "final_state": "failed",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
      "severity": "high"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_000",
      "patient_profile": {
        "age": 34,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Too few questions asked (0, expected at least 5)",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_000",
      "patient_profile": {
        "age": 34,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Repeated question: I couldn't find any trials for Gout in Jackson, MS...",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_targeted_gout_000",
      "patient_profile": {
        "age": 34,
        "conditions": [
          "Gout",
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "performance_issue",
      "avg_response_time": 20.15944677591324,
      "max_response_time": 25.12214708328247,
      "severity": "low",
      "recommendation": "Investigate slow API responses or Gemini API delays"
    },
    {
      "test_id": "AUTO_TEST_targeted_diabetes_001",
      "patient_profile": {
        "age": 49,
        "conditions": [
          "Type 2 Diabetes",
          "Hypertension"
        ],
        "medications": [
          "Metformin",
          "Lisinopril"
        ]
      },
      "type": "eligibility_logic_error",
      "reason": "No eligibility determination found in conversation",
      "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
      "severity": "high"
    },
    {
      "test_id": "AUTO_TEST_random_001",
      "patient_profile": {
        "age": 48,
        "conditions": [
          "Psoriasis"
        ],
        "medications": [
          "Cyclosporine",
          "Methotrexate",
          "Topical Corticosteroids"
        ]
      },
      "type": "crash",
      "error_type": "timeout",
      "error_message": "Unknown error",
      "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
      "severity": "critical"
    },
    {
      "test_id": "AUTO_TEST_random_001",
      "patient_profile": {
        "age": 48,
        "conditions": [
          "Psoriasis"
        ],
        "medications": [
          "Cyclosporine",
          "Methotrexate",
          "Topical Corticosteroids"
        ]
      },
      "type": "crash",
      "error_type": "conversation_failure",
      "error_message": "",
      "likely_location": "Unknown - check full error trace",
      "severity": "critical"
    },
    {
      "test_id": "AUTO_TEST_random_001",
      "patient_profile": {
        "age": 48,
        "conditions": [
          "Psoriasis"
        ],
        "medications": [
          "Cyclosporine",
          "Methotrexate",
          "Topical Corticosteroids"
        ]
      },
      "type": "eligibility_logic_error",
      "reason": "Prescreening flow did not complete",
      "final_state": "failed",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
      "severity": "high"
    },
    {
      "test_id": "AUTO_TEST_random_001",
      "patient_profile": {
        "age": 48,
        "conditions": [
          "Psoriasis"
        ],
        "medications": [
          "Cyclosporine",
          "Methotrexate",
          "Topical Corticosteroids"
        ]
      },
      "type": "performance_issue",
      "avg_response_time": 20.17135230700175,
      "max_response_time": 22.05758309364319,
      "severity": "low",
      "recommendation": "Investigate slow API responses or Gemini API delays"
    },
    {
      "test_id": "AUTO_TEST_targeted_psoriasis_002",
      "patient_profile": {
        "age": 25,
        "conditions": [
          "Plaque Psoriasis"
        ],
        "medications": [
          "Topical Corticosteroids"
        ]
      },
      "type": "crash",
      "error_type": "timeout",
      "error_message": "Unknown error",
      "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
      "severity": "critical"
    },
    {
      "test_id": "AUTO_TEST_targeted_psoriasis_002",
      "patient_profile": {
        "age": 25,
        "conditions": [
          "Plaque Psoriasis"
        ],
        "medications": [
          "Topical Corticosteroids"
        ]
      },
      "type": "crash",
      "error_type": "conversation_failure",
      "error_message": "",
      "likely_location": "Unknown - check full error trace",
      "severity": "critical"
    },
    {
      "test_id": "AUTO_TEST_targeted_psoriasis_002",
      "patient_profile": {
        "age": 25,
        "conditions": [
          "Plaque Psoriasis"
        ],
        "medications": [
          "Topical Corticosteroids"
        ]
      },
      "type": "eligibility_logic_error",
      "reason": "Prescreening flow did not complete",
      "final_state": "failed",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
      "severity": "high"
    },
    {
      "test_id": "AUTO_TEST_edge_unclear_000",
      "patient_profile": {
        "age": 50,
        "conditions": [
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "crash",
      "error_type": "timeout",
      "error_message": "Unknown error",
      "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
      "severity": "critical"
    },
    {
      "test_id": "AUTO_TEST_edge_unclear_000",
      "patient_profile": {
        "age": 50,
        "conditions": [
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "crash",
      "error_type": "conversation_failure",
      "error_message": "",
      "likely_location": "Unknown - check full error trace",
      "severity": "critical"
    },
    {
      "test_id": "AUTO_TEST_edge_unclear_000",
      "patient_profile": {
        "age": 50,
        "conditions": [
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "eligibility_logic_error",
      "reason": "Prescreening flow did not complete",
      "final_state": "failed",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
      "severity": "high"
    },
    {
      "test_id": "AUTO_TEST_edge_unclear_000",
      "patient_profile": {
        "age": 50,
        "conditions": [
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "conversation_quality_issue",
      "issue": "Too few questions asked (0, expected at least 5)",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    },
    {
      "test_id": "AUTO_TEST_edge_unclear_000",
      "patient_profile": {
        "age": 50,
        "conditions": [
          "Hypertension"
        ],
        "medications": [
          "Lisinopril"
        ]
      },
      "type": "edge_case_handling_failure",
      "edge_case_type": "unclear_responses",
      "final_state": "failed",
      "reason": "Edge case caused conversation to fail",
      "severity": "medium",
      "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
    }
  ],
  "detailed_results": [
    {
      "patient_id": "AUTO_TEST_random_000",
      "patient_profile": {
        "patient_id": "AUTO_TEST_random_000",
        "profile_type": "random",
        "demographics": {
          "age": 53,
          "gender": "female",
          "location": "New Orleans, LA",
          "name": "Jessica Rodriguez",
          "first_name": "Jessica",
          "last_name": "Rodriguez"
        },
        "medical_history": {
          "primary_condition": "Copd",
          "conditions": [
            "Copd"
          ],
          "medications": [
            "Breo Ellipta"
          ],
          "duration_years": 6
        },
        "expected_behavior": {
          "should_find_trials": true,
          "likely_eligible": true,
          "expected_question_count_range": [
            4,
            8
          ]
        }
      },
      "conversation_result": {
        "session_id": "AUTO_TEST_random_000",
        "patient_id": "AUTO_TEST_random_000",
        "conversation_log": [
          {
            "user_message": "Copd trials in New Orleans, LA",
            "bot_response": "Great! I found 5 clinical trial(s) available in New Orleans:\n\n**Dr. Patrick Dennis**\n  \u2022 Overweight (1 trial)\n  \u2022 Respiratory Syncytial Virus (RSV) (1 trial)\n  \u2022 Uncontrolled Hypertension (1 trial)\n  \u2022 Osteoarthritis of the Knee (1 trial)\n  \u2022 COVID-19 (1 trial)\n\nWould you like to:\n1. Check your eligibility for any of these trials?\n2. Learn more about a specific condition?\n3. See trials in a different location?",
            "metadata": {
              "session_id": "AUTO_TEST_random_000",
              "current_state": "trials_shown",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Copd",
                "location": "New Orleans",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Copd",
                  "location": "New Orleans"
                },
                "response_text": "Of course. Switching our search to COPD trials in New Orleans, LA. I'm looking for studies in that area now and will share what I find with you shortly.",
                "new_state": "trials_found",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided a new condition ('Copd') and a new location ('New Orleans'), which overrides the previous conversation context. Since I have all the necessary information to fulfill their request, the most direct and helpful action is to perform the search. The response acknowledges the context switch, confirms the search parameters, and sets expectations for the next step."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "trials_found": 5,
              "condition": "Copd",
              "location": "New Orleans",
              "trials_data": [
                {
                  "id": 111,
                  "trial_name": "A Randomized, Double-Blind, Phase 2 Trial of Once Weekly Petrelintide Compared with Placebo in Participants with Overweight or Obesity and Type 2 Diabetes",
                  "conditions": "Overweight",
                  "description": "This is a Phase 2 clinical research study, sponsored by Zealand Pharma A/S, to learn about an investigational weekly injection called petrelintide. The study is designed to see if petrelintide can help people with overweight or obesity and type 2 diabetes lose weight and manage their blood sugar. It is a \"randomized, double-blind, placebo-controlled\" trial, which means you will be randomly assigned (like a coin flip) to receive either petrelintide or a placebo, an inactive substance with no medicine. Neither you nor your study doctor will know which treatment you are receiving to ensure the results are unbiased. The study will take place at multiple research sites across the United States, and your total participation will last for approximately 39 weeks.\n\nThis study is looking for approximately 216 adults who have been diagnosed with both type 2 diabetes and have overweight or obesity. To be eligible, you must be willing to follow a reduced-calorie diet and increase your physical activity, as you will receive counseling on these lifestyle changes throughout the trial. The study aims to include a balanced number of men and women. As a participant, you will be closely monitored by a team of healthcare professionals. Your commitment to attending all study visits and following the study plan is essential for us to gather accurate information about the investigational drug's safety and effectiveness.\n\nIf you join the study, you will be assigned to one of six groups to receive a once-weekly injection, which you will learn to give yourself at home. Three groups will receive different doses of the investigational drug, petrelintide, and three groups will receive a matching placebo. The main goal is to see how the treatment affects your body weight after 28 weeks. We will also monitor changes in your blood sugar (HbA1c), waist circumference, cholesterol, and blood pressure. Your participation involves regular clinic visits over about 39 weeks, including a screening period, a 28-week treatment phase, and a 9-week follow-up. During these visits, you can expect procedures like blood tests, physical exams, ECGs, and completing health questionnaires.",
                  "investigator_name": "Dr. Patrick Dennis",
                  "site_location": "New Orleans, LA",
                  "protocol_summary": "This is a Phase 2 clinical research study, sponsored by Zealand Pharma A/S, to learn about an investigational weekly injection called petrelintide. The study is designed to see if petrelintide can help people with overweight or obesity and type 2 diabetes lose weight and manage their blood sugar. It is a \"randomized, double-blind, placebo-controlled\" trial, which means you will be randomly assigned (like a coin flip) to receive either petrelintide or a placebo, an inactive substance with no medicine. Neither you nor your study doctor will know which treatment you are receiving to ensure the results are unbiased. The study will take place at multiple research sites across the United States, and your total participation will last for approximately 39 weeks.\n\nThis study is looking for approximately 216 adults who have been diagnosed with both type 2 diabetes and have overweight or obesity. To be eligible, you must be willing to follow a reduced-calorie diet and increase your physical activity, as you will receive counseling on these lifestyle changes throughout the trial. The study aims to include a balanced number of men and women. As a participant, you will be closely monitored by a team of healthcare professionals. Your commitment to attending all study visits and following the study plan is essential for us to gather accurate information about the investigational drug's safety and effectiveness.\n\nIf you join the study, you will be assigned to one of six groups to receive a once-weekly injection, which you will learn to give yourself at home. Three groups will receive different doses of the investigational drug, petrelintide, and three groups will receive a matching placebo. The main goal is to see how the treatment affects your body weight after 28 weeks. We will also monitor changes in your blood sugar (HbA1c), waist circumference, cholesterol, and blood pressure. Your participation involves regular clinic visits over about 39 weeks, including a screening period, a 28-week treatment phase, and a 9-week follow-up. During these visits, you can expect procedures like blood tests, physical exams, ECGs, and completing health questionnaires.",
                  "total_sites": 1,
                  "similarity_score": 0.7461803002311971
                },
                {
                  "id": 43,
                  "trial_name": "A Phase 3 Study to Evaluate the Safety, Tolerability, and Immunogenicity of a Respiratory Syncytial Virus (RSV) Prefusion F Subunit Vaccine in Adults 60 Years of Age and Older",
                  "conditions": "Respiratory Syncytial Virus (RSV)",
                  "description": "This Phase 3, multicenter, placebo-controlled study will assess the safety, tolerability, and immunogenicity of Pfizer\u2019s RSVpreF in adults 60 years of age and older.  The study will enroll two cohorts: a China cohort receiving the study interventions double-blinded and a US cohort receiving the study intervention open-label, serving as both an immunobridging and safety profile control.",
                  "investigator_name": "Dr. Patrick Dennis",
                  "site_location": "New Orleans, LA",
                  "protocol_summary": "This is a Phase 3, multi-center, placebo-controlled study evaluating the safety, tolerability, and effectiveness of Pfizer\u2019s RSVpreF vaccine in adults aged 60 and older.  The study is being conducted in China and the US and will last approximately 6 months, with an optional follow-up at 12 months for some participants.  Participants in China will be randomly assigned to receive either the vaccine or a placebo, while US participants will all receive the vaccine. This helps researchers compare the vaccine's effects in a Chinese population to those previously observed in a primarily US-based study.\n\nYou may be eligible for this study if you are 60 years or older and live in either China or the US.  The study aims to include a representative sample across different age groups within this population (60-69, 70-79, and 80+ years).  Approximately 10% of participants will have stable chronic cardiopulmonary conditions.  You will not be able to participate if you have certain medical conditions or have recently received another vaccine.  Participants will be asked to report any symptoms they experience, attend several study visits, and provide blood samples.\n\nParticipants will receive either a single dose of the RSVpreF vaccine or a placebo.  Researchers will monitor participants for any side effects (like redness, swelling, or pain at the injection site, fever, fatigue, headache, etc.) and measure their immune response to the vaccine by analyzing blood samples. The main goals are to determine the vaccine's safety profile in Chinese adults and compare their immune response to that of US participants.  Participants will keep a daily diary of any symptoms, have a safety visit one week after vaccination, and attend follow-up visits for up to 6 months.  A smaller group will have an additional blood draw at 12 months.  Participants in China will also be monitored for respiratory illnesses and asked to provide nasal swabs if they develop symptoms.",
                  "total_sites": 1,
                  "similarity_score": 0.7377308422025914
                },
                {
                  "id": 106,
                  "trial_name": "A Randomized, Double-Blind, Placebo Controlled, Parallel Group, Multicenter Study of Modified Release RTN-001 In Patients with Uncontrolled Hypertension",
                  "conditions": "Uncontrolled Hypertension",
                  "description": "This is a Phase 2b clinical research study sponsored by Retension Pharmaceuticals, Inc., which will take place at multiple medical centers across the United States. The study is designed as a randomized, double-blind, placebo-controlled trial, which means you will be assigned by chance (like a coin toss) to receive either the investigational drug or a placebo (an inactive substance). Neither you nor your study doctor will know which treatment you are receiving, which helps ensure the results are unbiased. Your total participation will last approximately 16 weeks, which includes an initial screening and run-in period, a 12-week treatment period, and a final follow-up phone call two weeks after your last dose.\n\nThis study is seeking approximately 280 adults between the ages of 18 and 70 who have uncontrolled high blood pressure. To be eligible, you must currently be taking a stable regimen of two or more blood pressure medications, but still have a blood pressure reading of at least 130/80 mm Hg. There are several reasons you may not be able to participate, such as having very high blood pressure (over 170/110 mm Hg), a recent history of a heart attack or stroke, or current use of certain medications like nitrates or alpha-blockers. The study aims to enroll a diverse population, including patients with resistant hypertension who are on three or more medications.\n\nIf you qualify and choose to participate, you will first complete a 2-week period taking a placebo to ensure you can follow the study requirements. Afterwards, you will be randomly assigned to take a once-daily pill for 12 weeks, which will be one of three different doses of the investigational drug RTN-001 or a matching placebo. The main purpose of the study is to see if RTN-001 can effectively lower systolic blood pressure. Throughout the study, you will attend several clinic visits (at weeks 2, 4, 8, and 12) for procedures that include blood pressure measurements in the office, wearing a 24-hour blood pressure monitor at home, blood tests, heart tracings (ECGs), and physical exams.",
                  "investigator_name": "Dr. Patrick Dennis",
                  "site_location": "New Orleans, LA",
                  "protocol_summary": "This is a Phase 2b clinical research study sponsored by Retension Pharmaceuticals, Inc., which will take place at multiple medical centers across the United States. The study is designed as a randomized, double-blind, placebo-controlled trial, which means you will be assigned by chance (like a coin toss) to receive either the investigational drug or a placebo (an inactive substance). Neither you nor your study doctor will know which treatment you are receiving, which helps ensure the results are unbiased. Your total participation will last approximately 16 weeks, which includes an initial screening and run-in period, a 12-week treatment period, and a final follow-up phone call two weeks after your last dose.\n\nThis study is seeking approximately 280 adults between the ages of 18 and 70 who have uncontrolled high blood pressure. To be eligible, you must currently be taking a stable regimen of two or more blood pressure medications, but still have a blood pressure reading of at least 130/80 mm Hg. There are several reasons you may not be able to participate, such as having very high blood pressure (over 170/110 mm Hg), a recent history of a heart attack or stroke, or current use of certain medications like nitrates or alpha-blockers. The study aims to enroll a diverse population, including patients with resistant hypertension who are on three or more medications.\n\nIf you qualify and choose to participate, you will first complete a 2-week period taking a placebo to ensure you can follow the study requirements. Afterwards, you will be randomly assigned to take a once-daily pill for 12 weeks, which will be one of three different doses of the investigational drug RTN-001 or a matching placebo. The main purpose of the study is to see if RTN-001 can effectively lower systolic blood pressure. Throughout the study, you will attend several clinic visits (at weeks 2, 4, 8, and 12) for procedures that include blood pressure measurements in the office, wearing a 24-hour blood pressure monitor at home, blood tests, heart tracings (ECGs), and physical exams.",
                  "total_sites": 8,
                  "similarity_score": 0.732281108186311
                }
              ],
              "semantic_search": true
            },
            "response_time": 23.898568868637085,
            "timestamp": "2025-12-16T04:59:14.049710"
          },
          {
            "user_message": "Yes, check my eligibility",
            "bot_response": "I'm having trouble loading the prescreening questions for this trial. Please try searching for trials again, or contact support if this continues.",
            "metadata": {
              "session_id": "AUTO_TEST_random_000",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "start_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "start_prescreening",
                "parameters": {},
                "response_text": "Great! I can help with that. I'll ask a few simple questions to see if you might be a match for any of these trials. This is just a preliminary check, and the final decision is always up to the study team.\n\nFirst, could you please tell me your age?",
                "new_state": "prescreening",
                "collect_entities": [
                  "age"
                ],
                "metadata": {
                  "reasoning": "The user has explicitly confirmed they want to check their eligibility after being shown a list of trials (current state is 'trials_shown'). The most appropriate action is to initiate the prescreening process. The response acknowledges their request, sets expectations about the process, and asks the first common eligibility question (age) to begin. The state is transitioned to 'prescreening' to reflect this new phase of the conversation."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "prescreening_error": "failed_to_load_questions",
              "error_details": "No criteria found for trial 111"
            },
            "response_time": 16.58450984954834,
            "timestamp": "2025-12-16T04:59:30.635510"
          }
        ],
        "final_state": "completed",
        "total_turns": 2,
        "total_questions_asked": 0,
        "errors": [
          {
            "type": "prescreening_not_started",
            "bot_response": "I'm having trouble loading the prescreening questions for this trial. Please try searching for trials again, or contact support if this continues."
          }
        ]
      },
      "validation": {
        "passed": false,
        "overall_score": 66.0,
        "crash_prevention": {
          "passed": true,
          "score": 100.0,
          "error_count": 0,
          "errors": [],
          "failures": []
        },
        "eligibility_accuracy": {
          "passed": false,
          "score": 0.0,
          "reason": "Could not extract eligibility result",
          "failures": [
            {
              "type": "eligibility_logic_error",
              "reason": "No eligibility determination found in conversation",
              "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
              "severity": "high"
            }
          ]
        },
        "conversation_quality": {
          "passed": true,
          "score": 80.0,
          "total_questions_asked": 0,
          "issues": [
            "Too few questions asked (0, expected at least 4)"
          ],
          "failures": [
            {
              "type": "conversation_quality_issue",
              "issue": "Too few questions asked (0, expected at least 4)",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            }
          ]
        },
        "edge_case_handling": {
          "passed": true,
          "score": 100.0,
          "applicable": false,
          "failures": []
        },
        "performance": {
          "passed": false,
          "score": 40.0,
          "avg_response_time": 20.241539359092712,
          "max_response_time": 23.898568868637085,
          "status": "slow",
          "failures": [
            {
              "type": "performance_issue",
              "avg_response_time": 20.241539359092712,
              "max_response_time": 23.898568868637085,
              "severity": "low",
              "recommendation": "Investigate slow API responses or Gemini API delays"
            }
          ]
        },
        "failure_points": [
          {
            "type": "eligibility_logic_error",
            "reason": "No eligibility determination found in conversation",
            "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
            "severity": "high"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Too few questions asked (0, expected at least 4)",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "performance_issue",
            "avg_response_time": 20.241539359092712,
            "max_response_time": 23.898568868637085,
            "severity": "low",
            "recommendation": "Investigate slow API responses or Gemini API delays"
          }
        ],
        "recommendations": [
          "\u26a0\ufe0f HIGH: Review eligibility evaluation logic in gemini_prescreening_manager.py",
          "\u2139\ufe0f LOW: Slow response times. Optimize API calls or consider caching."
        ]
      },
      "timestamp": "2025-12-16T04:59:30.637843"
    },
    {
      "patient_id": "AUTO_TEST_random_002",
      "patient_profile": {
        "patient_id": "AUTO_TEST_random_002",
        "profile_type": "random",
        "demographics": {
          "age": 63,
          "gender": "non-binary",
          "location": "New Orleans, LA",
          "name": "Elizabeth Garcia",
          "first_name": "Elizabeth",
          "last_name": "Garcia"
        },
        "medical_history": {
          "primary_condition": "Hypertension",
          "conditions": [
            "Hypertension"
          ],
          "medications": [
            "Amlodipine"
          ],
          "duration_years": 10
        },
        "expected_behavior": {
          "should_find_trials": true,
          "likely_eligible": true,
          "expected_question_count_range": [
            4,
            8
          ]
        }
      },
      "conversation_result": {
        "session_id": "AUTO_TEST_random_002",
        "patient_id": "AUTO_TEST_random_002",
        "conversation_log": [
          {
            "user_message": "Hypertension trials in New Orleans, LA",
            "bot_response": "Great! I found 5 clinical trial(s) available in New Orleans:\n\n**Dr. Patrick Dennis**\n  \u2022 Uncontrolled Hypertension (1 trial)\n  \u2022 Overweight (1 trial)\n  \u2022 Overweight or Obesity and Type 2 Diabetes (1 trial)\n  \u2022 Osteoarthritis of the Knee (1 trial)\n  \u2022 COVID-19 (1 trial)\n\nWould you like to:\n1. Check your eligibility for any of these trials?\n2. Learn more about a specific condition?\n3. See trials in a different location?",
            "metadata": {
              "session_id": "AUTO_TEST_random_002",
              "current_state": "trials_shown",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Hypertension",
                "location": "New Orleans",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Hypertension",
                  "location": "New Orleans"
                },
                "response_text": "Of course. Switching our search to Hypertension trials in New Orleans, LA. Let me see what I can find for you.",
                "new_state": "trials_found",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided a new condition ('Hypertension') and a new location ('New Orleans, LA'), which overrides the previous context of 'Alzheimers' in 'Charlotte'. Since both required pieces of information are present, the correct action is to perform a new search. The response acknowledges the context switch and confirms the new search parameters before proceeding."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "trials_found": 5,
              "condition": "Hypertension",
              "location": "New Orleans",
              "trials_data": [
                {
                  "id": 106,
                  "trial_name": "A Randomized, Double-Blind, Placebo Controlled, Parallel Group, Multicenter Study of Modified Release RTN-001 In Patients with Uncontrolled Hypertension",
                  "conditions": "Uncontrolled Hypertension",
                  "description": "This is a Phase 2b clinical research study sponsored by Retension Pharmaceuticals, Inc., which will take place at multiple medical centers across the United States. The study is designed as a randomized, double-blind, placebo-controlled trial, which means you will be assigned by chance (like a coin toss) to receive either the investigational drug or a placebo (an inactive substance). Neither you nor your study doctor will know which treatment you are receiving, which helps ensure the results are unbiased. Your total participation will last approximately 16 weeks, which includes an initial screening and run-in period, a 12-week treatment period, and a final follow-up phone call two weeks after your last dose.\n\nThis study is seeking approximately 280 adults between the ages of 18 and 70 who have uncontrolled high blood pressure. To be eligible, you must currently be taking a stable regimen of two or more blood pressure medications, but still have a blood pressure reading of at least 130/80 mm Hg. There are several reasons you may not be able to participate, such as having very high blood pressure (over 170/110 mm Hg), a recent history of a heart attack or stroke, or current use of certain medications like nitrates or alpha-blockers. The study aims to enroll a diverse population, including patients with resistant hypertension who are on three or more medications.\n\nIf you qualify and choose to participate, you will first complete a 2-week period taking a placebo to ensure you can follow the study requirements. Afterwards, you will be randomly assigned to take a once-daily pill for 12 weeks, which will be one of three different doses of the investigational drug RTN-001 or a matching placebo. The main purpose of the study is to see if RTN-001 can effectively lower systolic blood pressure. Throughout the study, you will attend several clinic visits (at weeks 2, 4, 8, and 12) for procedures that include blood pressure measurements in the office, wearing a 24-hour blood pressure monitor at home, blood tests, heart tracings (ECGs), and physical exams.",
                  "investigator_name": "Dr. Patrick Dennis",
                  "site_location": "New Orleans, LA",
                  "protocol_summary": "This is a Phase 2b clinical research study sponsored by Retension Pharmaceuticals, Inc., which will take place at multiple medical centers across the United States. The study is designed as a randomized, double-blind, placebo-controlled trial, which means you will be assigned by chance (like a coin toss) to receive either the investigational drug or a placebo (an inactive substance). Neither you nor your study doctor will know which treatment you are receiving, which helps ensure the results are unbiased. Your total participation will last approximately 16 weeks, which includes an initial screening and run-in period, a 12-week treatment period, and a final follow-up phone call two weeks after your last dose.\n\nThis study is seeking approximately 280 adults between the ages of 18 and 70 who have uncontrolled high blood pressure. To be eligible, you must currently be taking a stable regimen of two or more blood pressure medications, but still have a blood pressure reading of at least 130/80 mm Hg. There are several reasons you may not be able to participate, such as having very high blood pressure (over 170/110 mm Hg), a recent history of a heart attack or stroke, or current use of certain medications like nitrates or alpha-blockers. The study aims to enroll a diverse population, including patients with resistant hypertension who are on three or more medications.\n\nIf you qualify and choose to participate, you will first complete a 2-week period taking a placebo to ensure you can follow the study requirements. Afterwards, you will be randomly assigned to take a once-daily pill for 12 weeks, which will be one of three different doses of the investigational drug RTN-001 or a matching placebo. The main purpose of the study is to see if RTN-001 can effectively lower systolic blood pressure. Throughout the study, you will attend several clinic visits (at weeks 2, 4, 8, and 12) for procedures that include blood pressure measurements in the office, wearing a 24-hour blood pressure monitor at home, blood tests, heart tracings (ECGs), and physical exams.",
                  "total_sites": 8,
                  "similarity_score": 0.8068209341486747
                },
                {
                  "id": 111,
                  "trial_name": "A Randomized, Double-Blind, Phase 2 Trial of Once Weekly Petrelintide Compared with Placebo in Participants with Overweight or Obesity and Type 2 Diabetes",
                  "conditions": "Overweight",
                  "description": "This is a Phase 2 clinical research study, sponsored by Zealand Pharma A/S, to learn about an investigational weekly injection called petrelintide. The study is designed to see if petrelintide can help people with overweight or obesity and type 2 diabetes lose weight and manage their blood sugar. It is a \"randomized, double-blind, placebo-controlled\" trial, which means you will be randomly assigned (like a coin flip) to receive either petrelintide or a placebo, an inactive substance with no medicine. Neither you nor your study doctor will know which treatment you are receiving to ensure the results are unbiased. The study will take place at multiple research sites across the United States, and your total participation will last for approximately 39 weeks.\n\nThis study is looking for approximately 216 adults who have been diagnosed with both type 2 diabetes and have overweight or obesity. To be eligible, you must be willing to follow a reduced-calorie diet and increase your physical activity, as you will receive counseling on these lifestyle changes throughout the trial. The study aims to include a balanced number of men and women. As a participant, you will be closely monitored by a team of healthcare professionals. Your commitment to attending all study visits and following the study plan is essential for us to gather accurate information about the investigational drug's safety and effectiveness.\n\nIf you join the study, you will be assigned to one of six groups to receive a once-weekly injection, which you will learn to give yourself at home. Three groups will receive different doses of the investigational drug, petrelintide, and three groups will receive a matching placebo. The main goal is to see how the treatment affects your body weight after 28 weeks. We will also monitor changes in your blood sugar (HbA1c), waist circumference, cholesterol, and blood pressure. Your participation involves regular clinic visits over about 39 weeks, including a screening period, a 28-week treatment phase, and a 9-week follow-up. During these visits, you can expect procedures like blood tests, physical exams, ECGs, and completing health questionnaires.",
                  "investigator_name": "Dr. Patrick Dennis",
                  "site_location": "New Orleans, LA",
                  "protocol_summary": "This is a Phase 2 clinical research study, sponsored by Zealand Pharma A/S, to learn about an investigational weekly injection called petrelintide. The study is designed to see if petrelintide can help people with overweight or obesity and type 2 diabetes lose weight and manage their blood sugar. It is a \"randomized, double-blind, placebo-controlled\" trial, which means you will be randomly assigned (like a coin flip) to receive either petrelintide or a placebo, an inactive substance with no medicine. Neither you nor your study doctor will know which treatment you are receiving to ensure the results are unbiased. The study will take place at multiple research sites across the United States, and your total participation will last for approximately 39 weeks.\n\nThis study is looking for approximately 216 adults who have been diagnosed with both type 2 diabetes and have overweight or obesity. To be eligible, you must be willing to follow a reduced-calorie diet and increase your physical activity, as you will receive counseling on these lifestyle changes throughout the trial. The study aims to include a balanced number of men and women. As a participant, you will be closely monitored by a team of healthcare professionals. Your commitment to attending all study visits and following the study plan is essential for us to gather accurate information about the investigational drug's safety and effectiveness.\n\nIf you join the study, you will be assigned to one of six groups to receive a once-weekly injection, which you will learn to give yourself at home. Three groups will receive different doses of the investigational drug, petrelintide, and three groups will receive a matching placebo. The main goal is to see how the treatment affects your body weight after 28 weeks. We will also monitor changes in your blood sugar (HbA1c), waist circumference, cholesterol, and blood pressure. Your participation involves regular clinic visits over about 39 weeks, including a screening period, a 28-week treatment phase, and a 9-week follow-up. During these visits, you can expect procedures like blood tests, physical exams, ECGs, and completing health questionnaires.",
                  "total_sites": 1,
                  "similarity_score": 0.7461803002311971
                },
                {
                  "id": 55,
                  "trial_name": "A Randomized, Double-Blind, Phase 2 Trial of Once-Weekly Petrelintide Compared with Placebo in Participants with Overweight or Obesity and Type 2 Diabetes",
                  "conditions": "Overweight or Obesity and Type 2 Diabetes",
                  "description": "This is a Phase 2, randomized, double-blind, placebo-controlled, multi-center clinical trial sponsored by Zealand Pharma A/S.  \"Double-blind\" means neither you nor the study staff will know whether you are receiving the study drug or a placebo. \"Randomized\" means you will be assigned to a treatment group by chance, like flipping a coin. The study will be conducted at multiple locations and will last approximately 40 weeks.\n\nThis study is for adults with type 2 diabetes who are overweight or obese.  You must be willing to follow a reduced-calorie diet and increase your physical activity. Key inclusion criteria include a diagnosis of type 2 diabetes and a Body Mass Index (BMI) indicating overweight or obesity. You may not be eligible to participate if you have certain medical conditions, such as a history of pancreatitis, or are taking certain medications. During the study, you will receive either petrelintide or a placebo injection once a week. You will also attend regular study visits where your weight, blood sugar levels, and other health measures will be monitored. \n\nThis study is investigating the effectiveness and safety of petrelintide for weight management.  You will receive one of three doses of petrelintide or a placebo injection once weekly.  Researchers will measure changes in your body weight, waist circumference, blood sugar levels (HbA1c and fasting glucose), cholesterol levels, blood pressure, and other health indicators. The primary outcome is the percentage change in body weight from the start of the study to week 28. Secondary outcomes include the proportion of participants achieving at least 5% or 10% weight loss, changes in other health measures, and any side effects experienced.  You will have study visits approximately every 4 weeks for the first 16 weeks, then every 4 weeks until week 28, with a final follow-up visit 10 weeks after your last injection.",
                  "investigator_name": "Dr. Patrick Dennis",
                  "site_location": "New Orleans, LA",
                  "protocol_summary": "This is a Phase 2, randomized, double-blind, placebo-controlled, multi-center clinical trial sponsored by Zealand Pharma A/S.  \"Double-blind\" means neither you nor the study staff will know whether you are receiving the study drug or a placebo. \"Randomized\" means you will be assigned to a treatment group by chance, like flipping a coin. The study will be conducted at multiple locations and will last approximately 40 weeks.\n\nThis study is for adults with type 2 diabetes who are overweight or obese.  You must be willing to follow a reduced-calorie diet and increase your physical activity. Key inclusion criteria include a diagnosis of type 2 diabetes and a Body Mass Index (BMI) indicating overweight or obesity. You may not be eligible to participate if you have certain medical conditions, such as a history of pancreatitis, or are taking certain medications. During the study, you will receive either petrelintide or a placebo injection once a week. You will also attend regular study visits where your weight, blood sugar levels, and other health measures will be monitored. \n\nThis study is investigating the effectiveness and safety of petrelintide for weight management.  You will receive one of three doses of petrelintide or a placebo injection once weekly.  Researchers will measure changes in your body weight, waist circumference, blood sugar levels (HbA1c and fasting glucose), cholesterol levels, blood pressure, and other health indicators. The primary outcome is the percentage change in body weight from the start of the study to week 28. Secondary outcomes include the proportion of participants achieving at least 5% or 10% weight loss, changes in other health measures, and any side effects experienced.  You will have study visits approximately every 4 weeks for the first 16 weeks, then every 4 weeks until week 28, with a final follow-up visit 10 weeks after your last injection.",
                  "total_sites": 1,
                  "similarity_score": 0.7389034331649902
                }
              ],
              "semantic_search": true
            },
            "response_time": 24.594531059265137,
            "timestamp": "2025-12-16T04:59:14.758399"
          },
          {
            "user_message": "Yes, check my eligibility",
            "bot_response": "Great! I'll help you check your eligibility.\n\nI need to ask you a few questions about the hypertension trial.\n\n**Question 1 of 5:** What is your age?",
            "metadata": {
              "session_id": "AUTO_TEST_random_002",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "start_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": "yes",
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "start_prescreening",
                "parameters": {},
                "response_text": "Great! To get started, could you please tell me the name or number of the trial you're interested in from the list I provided? We can go through the questions for it together.",
                "new_state": "prescreening_started",
                "collect_entities": [
                  "trial_name",
                  "number"
                ],
                "metadata": {
                  "reasoning": "The user has explicitly agreed to an eligibility check after being shown a list of trials. The current state is 'trials_shown', and the user's intent is clearly 'eligibility'. The most appropriate action is to start the prescreening process. The first step is to ask the user to specify which trial they are interested in, as they did not mention one in their message. This moves the conversation forward and transitions the state to 'prescreening_started'."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "prescreening_started": true,
              "trial_id": 106,
              "trial_name": "A Randomized, Double-Blind, Placebo Controlled, Parallel Group, Multicenter Study of Modified Release RTN-001 In Patients with Uncontrolled Hypertension",
              "current_question_index": 0,
              "total_questions": 5,
              "current_question": "What is your age?",
              "expected_answer_type": "number"
            },
            "response_time": 17.655755043029785,
            "timestamp": "2025-12-16T04:59:32.414780"
          },
          {
            "user_message": "63",
            "bot_response": "Got it.\n\nAre you currently taking any medications related to your condition? If yes, would you be able to adjust them as needed for the trial?",
            "metadata": {
              "session_id": "AUTO_TEST_random_002",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "continue_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": 63,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "continue_prescreening",
                "parameters": {},
                "response_text": "Great, thanks for sharing that. Next question: Have you been diagnosed with Type 2 Diabetes?",
                "new_state": "prescreening_active",
                "collect_entities": [
                  "boolean_answer"
                ],
                "metadata": {
                  "reasoning": "The user is in an active prescreening state and has just provided their age in response to a direct question. The most logical and helpful next step is to continue with the next question in the prescreening sequence to determine their eligibility. The state remains 'prescreening_active' as the process is ongoing."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "current_question_index": 1,
              "total_questions": 5,
              "current_question": "Are you currently taking any medications related to your condition? If yes, would you be able to adjust them as needed for the trial?",
              "expected_answer_type": "text",
              "parsed_answer": {
                "interpretation": "number",
                "confidence": 1.0
              }
            },
            "response_time": 16.43629789352417,
            "timestamp": "2025-12-16T04:59:48.852280"
          }
        ],
        "final_state": "failed",
        "total_turns": 3,
        "total_questions_asked": 5,
        "errors": [
          {
            "type": "timeout",
            "message": "Yes, I have Hypertension",
            "response_time": 30.51434087753296
          },
          {
            "type": "conversation_failure",
            "error": "",
            "state": "prescreening_active",
            "timestamp": "2025-12-16T05:00:19.367290"
          }
        ]
      },
      "validation": {
        "passed": false,
        "overall_score": 30.0,
        "crash_prevention": {
          "passed": false,
          "score": 0.0,
          "error_count": 2,
          "errors": [
            {
              "type": "timeout",
              "message": "Yes, I have Hypertension",
              "response_time": 30.51434087753296
            },
            {
              "type": "conversation_failure",
              "error": "",
              "state": "prescreening_active",
              "timestamp": "2025-12-16T05:00:19.367290"
            }
          ],
          "failures": [
            {
              "type": "crash",
              "error_type": "timeout",
              "error_message": "Unknown error",
              "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
              "severity": "critical"
            },
            {
              "type": "crash",
              "error_type": "conversation_failure",
              "error_message": "",
              "likely_location": "Unknown - check full error trace",
              "severity": "critical"
            }
          ]
        },
        "eligibility_accuracy": {
          "passed": false,
          "score": 0.0,
          "reason": "Prescreening did not complete",
          "failures": [
            {
              "type": "eligibility_logic_error",
              "reason": "Prescreening flow did not complete",
              "final_state": "failed",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
              "severity": "high"
            }
          ]
        },
        "conversation_quality": {
          "passed": true,
          "score": 100.0,
          "total_questions_asked": 5,
          "issues": [],
          "failures": []
        },
        "edge_case_handling": {
          "passed": true,
          "score": 100.0,
          "applicable": false,
          "failures": []
        },
        "performance": {
          "passed": true,
          "score": 70.0,
          "avg_response_time": 19.56219466527303,
          "max_response_time": 24.594531059265137,
          "status": "acceptable",
          "failures": []
        },
        "failure_points": [
          {
            "type": "crash",
            "error_type": "timeout",
            "error_message": "Unknown error",
            "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
            "severity": "critical"
          },
          {
            "type": "crash",
            "error_type": "conversation_failure",
            "error_message": "",
            "likely_location": "Unknown - check full error trace",
            "severity": "critical"
          },
          {
            "type": "eligibility_logic_error",
            "reason": "Prescreening flow did not complete",
            "final_state": "failed",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
            "severity": "high"
          }
        ],
        "recommendations": [
          "\ud83d\udea8 CRITICAL: Fix crashes and exceptions. Review error logs and add error handling.",
          "\u26a0\ufe0f HIGH: Review eligibility evaluation logic in gemini_prescreening_manager.py"
        ]
      },
      "timestamp": "2025-12-16T05:00:19.367451"
    },
    {
      "patient_id": "AUTO_TEST_targeted_psoriasis_003",
      "patient_profile": {
        "patient_id": "AUTO_TEST_targeted_psoriasis_003",
        "profile_type": "targeted",
        "demographics": {
          "age": 32,
          "gender": "male",
          "location": "Baton Rouge, LA",
          "name": "Test Psoriasis Patient",
          "first_name": "Test",
          "last_name": "Patient"
        },
        "medical_history": {
          "primary_condition": "Psoriasis",
          "conditions": [
            "Plaque Psoriasis"
          ],
          "medications": [
            "Topical Corticosteroids"
          ],
          "duration_years": 5,
          "pasi_score": 15,
          "body_surface_area": "20%"
        },
        "expected_behavior": {
          "should_find_trials": true,
          "likely_eligible": true,
          "expected_question_count_range": [
            4,
            7
          ],
          "target_trial_keywords": [
            "psoriasis",
            "dermatology"
          ]
        }
      },
      "conversation_result": {
        "session_id": "AUTO_TEST_targeted_psoriasis_003",
        "patient_id": "AUTO_TEST_targeted_psoriasis_003",
        "conversation_log": [
          {
            "user_message": "Psoriasis trials in Baton Rouge, LA",
            "bot_response": "Great! I found 5 clinical trial(s) available in Baton Rouge:\n\n**Dr. Ira Thorla**\n  \u2022 Female Pattern Hair Loss (Androgenetic Alopecia) (1 trial)\n  \u2022 Hidradenitis Suppurativa (1 trial)\n  \u2022 Acne Vulgaris (1 trial)\n  \u2022 Atopic Dermatitis (1 trial)\n\n**Dr. Taylor Sanders**\n  \u2022 Nonsegmental Vitiligo (1 trial)\n\nWould you like to:\n1. Check your eligibility for any of these trials?\n2. Learn more about a specific condition?\n3. See trials in a different location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_003",
              "current_state": "trials_shown",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Psoriasis",
                "location": "Baton Rouge",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Psoriasis",
                  "location": "Baton Rouge"
                },
                "response_text": "Of course. I'm now searching for Psoriasis clinical trials in Baton Rouge, Louisiana for you. I'll bring back a list of studies, and from there, we can look closer at any that seem interesting to you.",
                "new_state": "trials_found",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both a condition (Psoriasis) and a new location (Baton Rouge), which are the two required pieces of information to perform a trial search. The previous location was Jackson, so this is an updated search request. The `search_trials` action is the most direct way to fulfill the user's explicit request."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "trials_found": 5,
              "condition": "Psoriasis",
              "location": "Baton Rouge",
              "trials_data": [
                {
                  "id": 14,
                  "trial_name": "Clinical Trial 250-13951-306",
                  "conditions": "Female Pattern Hair Loss (Androgenetic Alopecia)",
                  "description": null,
                  "investigator_name": "Dr. Ira Thorla",
                  "site_location": "Baton Rouge, LA",
                  "protocol_summary": "This clinical trial aims to investigate the effectiveness and safety of an oral medication called VDPHL01 for treating female pattern hair loss (androgenetic alopecia).  The study will evaluate two different dosing regimens of VDPHL01: twice daily and once daily.  It will compare these regimens against a placebo to see if the medication promotes hair growth and improves patient satisfaction with their hair.\n\nWomen aged 18-65 with mild to moderate hair loss, as measured by the Savin Scale, are eligible to participate.  Key inclusion criteria include good general health, adequate kidney and liver function, and a commitment to maintaining consistent hair care routines throughout the study.  Women who are pregnant, breastfeeding, have certain medical conditions (like uncontrolled blood pressure or a history of heart problems), or have recently used other hair growth treatments are excluded.\n\nThe study will last approximately 13 months and consist of two parts. Part A is a 6-month placebo-controlled period, where participants are randomly assigned to one of four groups: VDPHL01 twice daily, VDPHL01 once daily plus placebo, placebo twice daily, or placebo twice daily.  Part B is a 6-month treatment extension, where those initially receiving placebo will start taking VDPHL01 according to their initial group assignment, while those already on VDPHL01 will continue.  Participants will have regular clinic visits (approximately 11) for assessments including physical exams, blood and urine tests, electrocardiograms, photographs of the scalp, and questionnaires about their hair and quality of life. A small group of participants will also take part in interviews.  A final follow-up will occur one month after the treatment period ends.\n",
                  "total_sites": 2,
                  "similarity_score": 0.8174656906579815
                },
                {
                  "id": 109,
                  "trial_name": "A Phase 2, Multicenter, Randomized, Placebo-Controlled, Double-Blind, Dose-Ranging Study to Evaluate the Efficacy and Safety of Zasocitinib in Participants with Nonsegmental Vitiligo",
                  "conditions": "Nonsegmental Vitiligo",
                  "description": "This is a Phase 2 clinical research study sponsored by Takeda Pharmaceuticals to test an investigational oral medication called zasocitinib for adults with nonsegmental vitiligo. The study is designed to be multicenter, meaning it will take place at various clinics and hospitals. It is a randomized, double-blind, placebo-controlled trial. This means participants will be randomly assigned (like a coin flip) to receive one of several different doses of zasocitinib or a placebo, which contains no active medicine. The double-blind design ensures that neither the participant nor the study doctor will know which treatment is being administered, which helps prevent bias in the results. The study will involve a screening period to determine eligibility, a treatment period, and a follow-up period.\n\nTo be eligible for this study, you must be an adult with a confirmed diagnosis of nonsegmental vitiligo. The study is looking for individuals whose vitiligo affects a certain amount of their body surface area and is considered stable or active. You may not be able to participate if you are pregnant or breastfeeding, have certain other medical conditions, or have recently used specific medications or therapies for vitiligo, including other JAK inhibitors or phototherapy. Before joining, the study team will explain all the details in an informed consent document, and you will have the opportunity to ask any questions to decide if participation is right for you.\n\nThe primary goal of this study is to evaluate how effective different doses of zasocitinib are at promoting skin repigmentation compared to a placebo. This will be measured by the study doctor using a standardized scoring system (Vitiligo Area Scoring Index, or VASI) that assesses changes in vitiligo on your face and body. The study will also assess the drug's safety and its impact on your quality of life through questionnaires. Participation requires regular visits to the study clinic for assessments, which will include physical exams, blood tests, medical photography to document skin changes, and completing surveys about your symptoms and well-being.",
                  "investigator_name": "Dr. Taylor Sanders",
                  "site_location": "Baton Rouge, LA",
                  "protocol_summary": "This is a Phase 2 clinical research study sponsored by Takeda Pharmaceuticals to test an investigational oral medication called zasocitinib for adults with nonsegmental vitiligo. The study is designed to be multicenter, meaning it will take place at various clinics and hospitals. It is a randomized, double-blind, placebo-controlled trial. This means participants will be randomly assigned (like a coin flip) to receive one of several different doses of zasocitinib or a placebo, which contains no active medicine. The double-blind design ensures that neither the participant nor the study doctor will know which treatment is being administered, which helps prevent bias in the results. The study will involve a screening period to determine eligibility, a treatment period, and a follow-up period.\n\nTo be eligible for this study, you must be an adult with a confirmed diagnosis of nonsegmental vitiligo. The study is looking for individuals whose vitiligo affects a certain amount of their body surface area and is considered stable or active. You may not be able to participate if you are pregnant or breastfeeding, have certain other medical conditions, or have recently used specific medications or therapies for vitiligo, including other JAK inhibitors or phototherapy. Before joining, the study team will explain all the details in an informed consent document, and you will have the opportunity to ask any questions to decide if participation is right for you.\n\nThe primary goal of this study is to evaluate how effective different doses of zasocitinib are at promoting skin repigmentation compared to a placebo. This will be measured by the study doctor using a standardized scoring system (Vitiligo Area Scoring Index, or VASI) that assesses changes in vitiligo on your face and body. The study will also assess the drug's safety and its impact on your quality of life through questionnaires. Participation requires regular visits to the study clinic for assessments, which will include physical exams, blood tests, medical photography to document skin changes, and completing surveys about your symptoms and well-being.",
                  "total_sites": 2,
                  "similarity_score": 0.7841763997694425
                },
                {
                  "id": 80,
                  "trial_name": "A Maximal Use Trial of Ruxolitinib Cream in Adult and Adolescent Participants With Hidradenitis Suppurativa",
                  "conditions": "Hidradenitis Suppurativa",
                  "description": "This is a Phase 1, open-label (not blinded), single-group study sponsored by Incyte Corporation.  The study will be conducted at multiple locations (multicenter) and is designed to evaluate the safety and tolerability of ruxolitinib cream. The total study duration, including screening, treatment, and follow-up, could be up to approximately 24 weeks.\n\nThis study is for adults and adolescents aged 12 to 75 years who have been diagnosed with hidradenitis suppurativa (HS) for at least 6 months.  To be eligible, you must have at least 4 abscesses and inflammatory nodules affecting at least 3 different areas of your body, with a total treatment area greater than 20% of your body surface area.  You may not be eligible if you have certain other skin conditions or are taking specific medications. During the study, you will be asked to apply the study cream twice daily to all affected areas and attend regular visits for check-ups and assessments.\n\nIn this study, you will apply ruxolitinib 1.5% cream twice daily to all affected areas for 4 weeks.  Researchers will monitor your health through blood tests, physical exams, and by asking you about any side effects.  The main goals are to assess the safety and tolerability of the cream, including any side effects, and to measure how much of the drug gets into your bloodstream.  Secondary goals include evaluating the cream's effect on your HS lesions, pain, itching, and quality of life.  You will have regular visits during the 4-week treatment period and potentially for a longer extension period, followed by a final safety follow-up visit.",
                  "investigator_name": "Dr. Ira Thorla",
                  "site_location": "Baton Rouge, LA",
                  "protocol_summary": "This is a Phase 1, open-label (not blinded), single-group study sponsored by Incyte Corporation.  The study will be conducted at multiple locations (multicenter) and is designed to evaluate the safety and tolerability of ruxolitinib cream. The total study duration, including screening, treatment, and follow-up, could be up to approximately 24 weeks.\n\nThis study is for adults and adolescents aged 12 to 75 years who have been diagnosed with hidradenitis suppurativa (HS) for at least 6 months.  To be eligible, you must have at least 4 abscesses and inflammatory nodules affecting at least 3 different areas of your body, with a total treatment area greater than 20% of your body surface area.  You may not be eligible if you have certain other skin conditions or are taking specific medications. During the study, you will be asked to apply the study cream twice daily to all affected areas and attend regular visits for check-ups and assessments.\n\nIn this study, you will apply ruxolitinib 1.5% cream twice daily to all affected areas for 4 weeks.  Researchers will monitor your health through blood tests, physical exams, and by asking you about any side effects.  The main goals are to assess the safety and tolerability of the cream, including any side effects, and to measure how much of the drug gets into your bloodstream.  Secondary goals include evaluating the cream's effect on your HS lesions, pain, itching, and quality of life.  You will have regular visits during the 4-week treatment period and potentially for a longer extension period, followed by a final safety follow-up visit.",
                  "total_sites": 1,
                  "similarity_score": 0.7694749411748597
                }
              ],
              "semantic_search": true
            },
            "response_time": 22.55450701713562,
            "timestamp": "2025-12-16T04:59:12.702987"
          },
          {
            "user_message": "Yes, check my eligibility",
            "bot_response": "Great! I'll help you check your eligibility.\n\nI need to ask you a few questions about the psoriasis trial.\n\n**Question 1 of 4:** What is your age?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_003",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "start_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": true,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "start_prescreening",
                "parameters": {},
                "response_text": "Great, I can help with that. I'll ask a few simple questions to see if you might be a match for any of these studies. To start, could you please tell me your age?",
                "new_state": "prescreening_in_progress",
                "collect_entities": [
                  "age"
                ],
                "metadata": {
                  "reasoning": "The user has seen a list of trials and has explicitly confirmed they want to check their eligibility. The current state is 'trials_shown', and we have the necessary condition and location. Therefore, the most appropriate action is to 'start_prescreening' by asking the first eligibility question, which is typically age. The state will be updated to 'prescreening_in_progress' to reflect this new phase of the conversation."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "prescreening_started": true,
              "trial_id": 14,
              "trial_name": "Clinical Trial 250-13951-306",
              "current_question_index": 0,
              "total_questions": 4,
              "current_question": "What is your age?",
              "expected_answer_type": "number"
            },
            "response_time": 18.218228816986084,
            "timestamp": "2025-12-16T04:59:30.922129"
          },
          {
            "user_message": "32",
            "bot_response": "Got it.\n\nHave you been diagnosed with mild to moderate aga with a score of i-4 by a doctor?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_003",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "continue_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": 32,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "continue_prescreening",
                "parameters": {
                  "answered_question": "age",
                  "value": 32
                },
                "response_text": "Great, thank you. Just a couple more questions. For this trial, they are looking for patients who have been diagnosed with Psoriasis for at least 6 months. Does this apply to you?",
                "new_state": "prescreening_active",
                "collect_entities": [
                  "boolean_answer"
                ],
                "metadata": {
                  "reasoning": "The user is in an active prescreening state and has provided their age in response to the previous question. The correct action is to continue the prescreening process by asking the next logical eligibility question. This question about the duration of their diagnosis is a common criterion for Psoriasis trials. The response acknowledges their input, sets expectations ('a couple more questions'), and clearly asks the next yes/no question in a supportive manner."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "current_question_index": 1,
              "total_questions": 4,
              "current_question": "Have you been diagnosed with mild to moderate aga with a score of i-4 by a doctor?",
              "expected_answer_type": "yes_no",
              "parsed_answer": {
                "interpretation": "number",
                "confidence": 1.0
              }
            },
            "response_time": 19.96685791015625,
            "timestamp": "2025-12-16T04:59:50.890230"
          }
        ],
        "final_state": "failed",
        "total_turns": 3,
        "total_questions_asked": 4,
        "errors": [
          {
            "type": "timeout",
            "message": "Yes, I have Psoriasis",
            "response_time": 30.47686004638672
          },
          {
            "type": "conversation_failure",
            "error": "",
            "state": "prescreening_active",
            "timestamp": "2025-12-16T05:00:21.367688"
          }
        ]
      },
      "validation": {
        "passed": false,
        "overall_score": 30.0,
        "crash_prevention": {
          "passed": false,
          "score": 0.0,
          "error_count": 2,
          "errors": [
            {
              "type": "timeout",
              "message": "Yes, I have Psoriasis",
              "response_time": 30.47686004638672
            },
            {
              "type": "conversation_failure",
              "error": "",
              "state": "prescreening_active",
              "timestamp": "2025-12-16T05:00:21.367688"
            }
          ],
          "failures": [
            {
              "type": "crash",
              "error_type": "timeout",
              "error_message": "Unknown error",
              "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
              "severity": "critical"
            },
            {
              "type": "crash",
              "error_type": "conversation_failure",
              "error_message": "",
              "likely_location": "Unknown - check full error trace",
              "severity": "critical"
            }
          ]
        },
        "eligibility_accuracy": {
          "passed": false,
          "score": 0.0,
          "reason": "Prescreening did not complete",
          "failures": [
            {
              "type": "eligibility_logic_error",
              "reason": "Prescreening flow did not complete",
              "final_state": "failed",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
              "severity": "high"
            }
          ]
        },
        "conversation_quality": {
          "passed": true,
          "score": 100.0,
          "total_questions_asked": 4,
          "issues": [],
          "failures": []
        },
        "edge_case_handling": {
          "passed": true,
          "score": 100.0,
          "applicable": false,
          "failures": []
        },
        "performance": {
          "passed": false,
          "score": 40.0,
          "avg_response_time": 20.24653124809265,
          "max_response_time": 22.55450701713562,
          "status": "slow",
          "failures": [
            {
              "type": "performance_issue",
              "avg_response_time": 20.24653124809265,
              "max_response_time": 22.55450701713562,
              "severity": "low",
              "recommendation": "Investigate slow API responses or Gemini API delays"
            }
          ]
        },
        "failure_points": [
          {
            "type": "crash",
            "error_type": "timeout",
            "error_message": "Unknown error",
            "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
            "severity": "critical"
          },
          {
            "type": "crash",
            "error_type": "conversation_failure",
            "error_message": "",
            "likely_location": "Unknown - check full error trace",
            "severity": "critical"
          },
          {
            "type": "eligibility_logic_error",
            "reason": "Prescreening flow did not complete",
            "final_state": "failed",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
            "severity": "high"
          },
          {
            "type": "performance_issue",
            "avg_response_time": 20.24653124809265,
            "max_response_time": 22.55450701713562,
            "severity": "low",
            "recommendation": "Investigate slow API responses or Gemini API delays"
          }
        ],
        "recommendations": [
          "\ud83d\udea8 CRITICAL: Fix crashes and exceptions. Review error logs and add error handling.",
          "\u26a0\ufe0f HIGH: Review eligibility evaluation logic in gemini_prescreening_manager.py",
          "\u2139\ufe0f LOW: Slow response times. Optimize API calls or consider caching."
        ]
      },
      "timestamp": "2025-12-16T05:00:21.367846"
    },
    {
      "patient_id": "AUTO_TEST_edge_age_001",
      "patient_profile": {
        "patient_id": "AUTO_TEST_edge_age_001",
        "profile_type": "edge_case",
        "demographics": {
          "age": 18,
          "gender": "male",
          "location": "New Orleans, LA",
          "name": "Edge Age Patient",
          "first_name": "Edge",
          "last_name": "Patient"
        },
        "medical_history": {
          "primary_condition": "Hypertension",
          "conditions": [
            "Hypertension"
          ],
          "medications": [
            "Lisinopril"
          ],
          "duration_years": 1
        },
        "expected_behavior": {
          "should_find_trials": true,
          "likely_eligible": true,
          "expected_question_count_range": [
            3,
            8
          ],
          "edge_case_type": "extreme_age"
        }
      },
      "conversation_result": {
        "session_id": "AUTO_TEST_edge_age_001",
        "patient_id": "AUTO_TEST_edge_age_001",
        "conversation_log": [
          {
            "user_message": "Hypertension trials in New Orleans, LA",
            "bot_response": "Great! I found 5 clinical trial(s) available in New Orleans, LA:\n\n**Dr. Patrick Dennis**\n  \u2022 Uncontrolled Hypertension (1 trial)\n  \u2022 Overweight (1 trial)\n  \u2022 Overweight or Obesity and Type 2 Diabetes (1 trial)\n  \u2022 Osteoarthritis of the Knee (1 trial)\n  \u2022 COVID-19 (1 trial)\n\nWould you like to:\n1. Check your eligibility for any of these trials?\n2. Learn more about a specific condition?\n3. See trials in a different location?",
            "metadata": {
              "session_id": "AUTO_TEST_edge_age_001",
              "current_state": "trials_shown",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Hypertension",
                "location": "New Orleans",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Hypertension",
                  "location": "New Orleans, LA"
                },
                "response_text": "Of course. Finding the right clinical trial is an important step, and I can help with that. Let me look for hypertension trials happening in the New Orleans, LA area for you. One moment...",
                "new_state": "trials_displayed",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided all the necessary information (condition: 'Hypertension' and location: 'New Orleans, LA') to perform a trial search. The `search_trials` action is the most direct and helpful next step to fulfill their request. The response confirms their request, sets the expectation that a search is being performed, and maintains a supportive tone, moving the conversation directly towards their goal."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "trials_found": 5,
              "condition": "Hypertension",
              "location": "New Orleans, LA",
              "trials_data": [
                {
                  "id": 106,
                  "trial_name": "A Randomized, Double-Blind, Placebo Controlled, Parallel Group, Multicenter Study of Modified Release RTN-001 In Patients with Uncontrolled Hypertension",
                  "conditions": "Uncontrolled Hypertension",
                  "description": "This is a Phase 2b clinical research study sponsored by Retension Pharmaceuticals, Inc., which will take place at multiple medical centers across the United States. The study is designed as a randomized, double-blind, placebo-controlled trial, which means you will be assigned by chance (like a coin toss) to receive either the investigational drug or a placebo (an inactive substance). Neither you nor your study doctor will know which treatment you are receiving, which helps ensure the results are unbiased. Your total participation will last approximately 16 weeks, which includes an initial screening and run-in period, a 12-week treatment period, and a final follow-up phone call two weeks after your last dose.\n\nThis study is seeking approximately 280 adults between the ages of 18 and 70 who have uncontrolled high blood pressure. To be eligible, you must currently be taking a stable regimen of two or more blood pressure medications, but still have a blood pressure reading of at least 130/80 mm Hg. There are several reasons you may not be able to participate, such as having very high blood pressure (over 170/110 mm Hg), a recent history of a heart attack or stroke, or current use of certain medications like nitrates or alpha-blockers. The study aims to enroll a diverse population, including patients with resistant hypertension who are on three or more medications.\n\nIf you qualify and choose to participate, you will first complete a 2-week period taking a placebo to ensure you can follow the study requirements. Afterwards, you will be randomly assigned to take a once-daily pill for 12 weeks, which will be one of three different doses of the investigational drug RTN-001 or a matching placebo. The main purpose of the study is to see if RTN-001 can effectively lower systolic blood pressure. Throughout the study, you will attend several clinic visits (at weeks 2, 4, 8, and 12) for procedures that include blood pressure measurements in the office, wearing a 24-hour blood pressure monitor at home, blood tests, heart tracings (ECGs), and physical exams.",
                  "investigator_name": "Dr. Patrick Dennis",
                  "site_location": "New Orleans, LA",
                  "protocol_summary": "This is a Phase 2b clinical research study sponsored by Retension Pharmaceuticals, Inc., which will take place at multiple medical centers across the United States. The study is designed as a randomized, double-blind, placebo-controlled trial, which means you will be assigned by chance (like a coin toss) to receive either the investigational drug or a placebo (an inactive substance). Neither you nor your study doctor will know which treatment you are receiving, which helps ensure the results are unbiased. Your total participation will last approximately 16 weeks, which includes an initial screening and run-in period, a 12-week treatment period, and a final follow-up phone call two weeks after your last dose.\n\nThis study is seeking approximately 280 adults between the ages of 18 and 70 who have uncontrolled high blood pressure. To be eligible, you must currently be taking a stable regimen of two or more blood pressure medications, but still have a blood pressure reading of at least 130/80 mm Hg. There are several reasons you may not be able to participate, such as having very high blood pressure (over 170/110 mm Hg), a recent history of a heart attack or stroke, or current use of certain medications like nitrates or alpha-blockers. The study aims to enroll a diverse population, including patients with resistant hypertension who are on three or more medications.\n\nIf you qualify and choose to participate, you will first complete a 2-week period taking a placebo to ensure you can follow the study requirements. Afterwards, you will be randomly assigned to take a once-daily pill for 12 weeks, which will be one of three different doses of the investigational drug RTN-001 or a matching placebo. The main purpose of the study is to see if RTN-001 can effectively lower systolic blood pressure. Throughout the study, you will attend several clinic visits (at weeks 2, 4, 8, and 12) for procedures that include blood pressure measurements in the office, wearing a 24-hour blood pressure monitor at home, blood tests, heart tracings (ECGs), and physical exams.",
                  "total_sites": 8,
                  "similarity_score": 0.8068209341486747
                },
                {
                  "id": 111,
                  "trial_name": "A Randomized, Double-Blind, Phase 2 Trial of Once Weekly Petrelintide Compared with Placebo in Participants with Overweight or Obesity and Type 2 Diabetes",
                  "conditions": "Overweight",
                  "description": "This is a Phase 2 clinical research study, sponsored by Zealand Pharma A/S, to learn about an investigational weekly injection called petrelintide. The study is designed to see if petrelintide can help people with overweight or obesity and type 2 diabetes lose weight and manage their blood sugar. It is a \"randomized, double-blind, placebo-controlled\" trial, which means you will be randomly assigned (like a coin flip) to receive either petrelintide or a placebo, an inactive substance with no medicine. Neither you nor your study doctor will know which treatment you are receiving to ensure the results are unbiased. The study will take place at multiple research sites across the United States, and your total participation will last for approximately 39 weeks.\n\nThis study is looking for approximately 216 adults who have been diagnosed with both type 2 diabetes and have overweight or obesity. To be eligible, you must be willing to follow a reduced-calorie diet and increase your physical activity, as you will receive counseling on these lifestyle changes throughout the trial. The study aims to include a balanced number of men and women. As a participant, you will be closely monitored by a team of healthcare professionals. Your commitment to attending all study visits and following the study plan is essential for us to gather accurate information about the investigational drug's safety and effectiveness.\n\nIf you join the study, you will be assigned to one of six groups to receive a once-weekly injection, which you will learn to give yourself at home. Three groups will receive different doses of the investigational drug, petrelintide, and three groups will receive a matching placebo. The main goal is to see how the treatment affects your body weight after 28 weeks. We will also monitor changes in your blood sugar (HbA1c), waist circumference, cholesterol, and blood pressure. Your participation involves regular clinic visits over about 39 weeks, including a screening period, a 28-week treatment phase, and a 9-week follow-up. During these visits, you can expect procedures like blood tests, physical exams, ECGs, and completing health questionnaires.",
                  "investigator_name": "Dr. Patrick Dennis",
                  "site_location": "New Orleans, LA",
                  "protocol_summary": "This is a Phase 2 clinical research study, sponsored by Zealand Pharma A/S, to learn about an investigational weekly injection called petrelintide. The study is designed to see if petrelintide can help people with overweight or obesity and type 2 diabetes lose weight and manage their blood sugar. It is a \"randomized, double-blind, placebo-controlled\" trial, which means you will be randomly assigned (like a coin flip) to receive either petrelintide or a placebo, an inactive substance with no medicine. Neither you nor your study doctor will know which treatment you are receiving to ensure the results are unbiased. The study will take place at multiple research sites across the United States, and your total participation will last for approximately 39 weeks.\n\nThis study is looking for approximately 216 adults who have been diagnosed with both type 2 diabetes and have overweight or obesity. To be eligible, you must be willing to follow a reduced-calorie diet and increase your physical activity, as you will receive counseling on these lifestyle changes throughout the trial. The study aims to include a balanced number of men and women. As a participant, you will be closely monitored by a team of healthcare professionals. Your commitment to attending all study visits and following the study plan is essential for us to gather accurate information about the investigational drug's safety and effectiveness.\n\nIf you join the study, you will be assigned to one of six groups to receive a once-weekly injection, which you will learn to give yourself at home. Three groups will receive different doses of the investigational drug, petrelintide, and three groups will receive a matching placebo. The main goal is to see how the treatment affects your body weight after 28 weeks. We will also monitor changes in your blood sugar (HbA1c), waist circumference, cholesterol, and blood pressure. Your participation involves regular clinic visits over about 39 weeks, including a screening period, a 28-week treatment phase, and a 9-week follow-up. During these visits, you can expect procedures like blood tests, physical exams, ECGs, and completing health questionnaires.",
                  "total_sites": 1,
                  "similarity_score": 0.7461803002311971
                },
                {
                  "id": 55,
                  "trial_name": "A Randomized, Double-Blind, Phase 2 Trial of Once-Weekly Petrelintide Compared with Placebo in Participants with Overweight or Obesity and Type 2 Diabetes",
                  "conditions": "Overweight or Obesity and Type 2 Diabetes",
                  "description": "This is a Phase 2, randomized, double-blind, placebo-controlled, multi-center clinical trial sponsored by Zealand Pharma A/S.  \"Double-blind\" means neither you nor the study staff will know whether you are receiving the study drug or a placebo. \"Randomized\" means you will be assigned to a treatment group by chance, like flipping a coin. The study will be conducted at multiple locations and will last approximately 40 weeks.\n\nThis study is for adults with type 2 diabetes who are overweight or obese.  You must be willing to follow a reduced-calorie diet and increase your physical activity. Key inclusion criteria include a diagnosis of type 2 diabetes and a Body Mass Index (BMI) indicating overweight or obesity. You may not be eligible to participate if you have certain medical conditions, such as a history of pancreatitis, or are taking certain medications. During the study, you will receive either petrelintide or a placebo injection once a week. You will also attend regular study visits where your weight, blood sugar levels, and other health measures will be monitored. \n\nThis study is investigating the effectiveness and safety of petrelintide for weight management.  You will receive one of three doses of petrelintide or a placebo injection once weekly.  Researchers will measure changes in your body weight, waist circumference, blood sugar levels (HbA1c and fasting glucose), cholesterol levels, blood pressure, and other health indicators. The primary outcome is the percentage change in body weight from the start of the study to week 28. Secondary outcomes include the proportion of participants achieving at least 5% or 10% weight loss, changes in other health measures, and any side effects experienced.  You will have study visits approximately every 4 weeks for the first 16 weeks, then every 4 weeks until week 28, with a final follow-up visit 10 weeks after your last injection.",
                  "investigator_name": "Dr. Patrick Dennis",
                  "site_location": "New Orleans, LA",
                  "protocol_summary": "This is a Phase 2, randomized, double-blind, placebo-controlled, multi-center clinical trial sponsored by Zealand Pharma A/S.  \"Double-blind\" means neither you nor the study staff will know whether you are receiving the study drug or a placebo. \"Randomized\" means you will be assigned to a treatment group by chance, like flipping a coin. The study will be conducted at multiple locations and will last approximately 40 weeks.\n\nThis study is for adults with type 2 diabetes who are overweight or obese.  You must be willing to follow a reduced-calorie diet and increase your physical activity. Key inclusion criteria include a diagnosis of type 2 diabetes and a Body Mass Index (BMI) indicating overweight or obesity. You may not be eligible to participate if you have certain medical conditions, such as a history of pancreatitis, or are taking certain medications. During the study, you will receive either petrelintide or a placebo injection once a week. You will also attend regular study visits where your weight, blood sugar levels, and other health measures will be monitored. \n\nThis study is investigating the effectiveness and safety of petrelintide for weight management.  You will receive one of three doses of petrelintide or a placebo injection once weekly.  Researchers will measure changes in your body weight, waist circumference, blood sugar levels (HbA1c and fasting glucose), cholesterol levels, blood pressure, and other health indicators. The primary outcome is the percentage change in body weight from the start of the study to week 28. Secondary outcomes include the proportion of participants achieving at least 5% or 10% weight loss, changes in other health measures, and any side effects experienced.  You will have study visits approximately every 4 weeks for the first 16 weeks, then every 4 weeks until week 28, with a final follow-up visit 10 weeks after your last injection.",
                  "total_sites": 1,
                  "similarity_score": 0.7389034331649902
                }
              ],
              "semantic_search": true
            },
            "response_time": 25.04991626739502,
            "timestamp": "2025-12-16T05:00:46.436831"
          },
          {
            "user_message": "Yes, check my eligibility",
            "bot_response": "Great! I'll help you check your eligibility.\n\nI need to ask you a few questions about the hypertension trial.\n\n**Question 1 of 5:** What is your age?",
            "metadata": {
              "session_id": "AUTO_TEST_edge_age_001",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "start_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": "yes",
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "start_prescreening",
                "parameters": {},
                "response_text": "Great, I can help with that. To see if you might be a match for any of these trials, I'll need to ask a few questions based on their criteria. This is just a preliminary check, not a final decision.\n\nTo start, could you please tell me your age?",
                "new_state": "prescreening_started",
                "collect_entities": [
                  "age"
                ],
                "metadata": {
                  "reasoning": "The user has explicitly agreed to an eligibility check after being shown a list of trials. The current state is 'trials_shown', and we have the necessary condition and location. Therefore, the correct action is to 'start_prescreening'. The response confirms the user's request, sets expectations for the process, and asks the first common screening question (age) to begin collecting the necessary information. The state is transitioned to 'prescreening_started' to reflect this new phase of the conversation."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "prescreening_started": true,
              "trial_id": 106,
              "trial_name": "A Randomized, Double-Blind, Placebo Controlled, Parallel Group, Multicenter Study of Modified Release RTN-001 In Patients with Uncontrolled Hypertension",
              "current_question_index": 0,
              "total_questions": 5,
              "current_question": "What is your age?",
              "expected_answer_type": "number"
            },
            "response_time": 19.414144039154053,
            "timestamp": "2025-12-16T05:01:05.851198"
          },
          {
            "user_message": "18",
            "bot_response": "Got it.\n\nAre you currently taking any medications related to your condition? If yes, would you be able to adjust them as needed for the trial?",
            "metadata": {
              "session_id": "AUTO_TEST_edge_age_001",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "continue_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": 18,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "continue_prescreening",
                "parameters": {
                  "age": 18
                },
                "response_text": "Great, thanks for sharing that. Just a couple more questions to go. Are you currently taking any medications for your hypertension?",
                "new_state": "prescreening_active",
                "collect_entities": [
                  "boolean_answer",
                  "medication"
                ],
                "metadata": {
                  "reasoning": "The user is in an active prescreening state and has just answered the question about their age. The correct action is to continue the prescreening process by asking the next relevant eligibility question. In this case, asking about current medications for hypertension is a logical next step to determine potential eligibility for a trial. The state remains 'prescreening_active' as the process is not yet complete."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "current_question_index": 1,
              "total_questions": 5,
              "current_question": "Are you currently taking any medications related to your condition? If yes, would you be able to adjust them as needed for the trial?",
              "expected_answer_type": "text",
              "parsed_answer": {
                "interpretation": "number",
                "confidence": 1.0
              }
            },
            "response_time": 23.789411067962646,
            "timestamp": "2025-12-16T05:01:29.640899"
          }
        ],
        "final_state": "failed",
        "total_turns": 3,
        "total_questions_asked": 5,
        "errors": [
          {
            "type": "timeout",
            "message": "Yes, I have Hypertension",
            "response_time": 30.727426052093506
          },
          {
            "type": "conversation_failure",
            "error": "",
            "state": "prescreening_active",
            "timestamp": "2025-12-16T05:02:00.368547"
          }
        ]
      },
      "validation": {
        "passed": false,
        "overall_score": 25.0,
        "crash_prevention": {
          "passed": false,
          "score": 0.0,
          "error_count": 2,
          "errors": [
            {
              "type": "timeout",
              "message": "Yes, I have Hypertension",
              "response_time": 30.727426052093506
            },
            {
              "type": "conversation_failure",
              "error": "",
              "state": "prescreening_active",
              "timestamp": "2025-12-16T05:02:00.368547"
            }
          ],
          "failures": [
            {
              "type": "crash",
              "error_type": "timeout",
              "error_message": "Unknown error",
              "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
              "severity": "critical"
            },
            {
              "type": "crash",
              "error_type": "conversation_failure",
              "error_message": "",
              "likely_location": "Unknown - check full error trace",
              "severity": "critical"
            }
          ]
        },
        "eligibility_accuracy": {
          "passed": false,
          "score": 0.0,
          "reason": "Prescreening did not complete",
          "failures": [
            {
              "type": "eligibility_logic_error",
              "reason": "Prescreening flow did not complete",
              "final_state": "failed",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
              "severity": "high"
            }
          ]
        },
        "conversation_quality": {
          "passed": true,
          "score": 100.0,
          "total_questions_asked": 5,
          "issues": [],
          "failures": []
        },
        "edge_case_handling": {
          "passed": false,
          "score": 50.0,
          "applicable": true,
          "edge_case_type": "extreme_age",
          "completed": false,
          "failures": [
            {
              "type": "edge_case_handling_failure",
              "edge_case_type": "extreme_age",
              "final_state": "failed",
              "reason": "Edge case caused conversation to fail",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            }
          ]
        },
        "performance": {
          "passed": false,
          "score": 40.0,
          "avg_response_time": 22.75115712483724,
          "max_response_time": 25.04991626739502,
          "status": "slow",
          "failures": [
            {
              "type": "performance_issue",
              "avg_response_time": 22.75115712483724,
              "max_response_time": 25.04991626739502,
              "severity": "low",
              "recommendation": "Investigate slow API responses or Gemini API delays"
            }
          ]
        },
        "failure_points": [
          {
            "type": "crash",
            "error_type": "timeout",
            "error_message": "Unknown error",
            "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
            "severity": "critical"
          },
          {
            "type": "crash",
            "error_type": "conversation_failure",
            "error_message": "",
            "likely_location": "Unknown - check full error trace",
            "severity": "critical"
          },
          {
            "type": "eligibility_logic_error",
            "reason": "Prescreening flow did not complete",
            "final_state": "failed",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
            "severity": "high"
          },
          {
            "type": "edge_case_handling_failure",
            "edge_case_type": "extreme_age",
            "final_state": "failed",
            "reason": "Edge case caused conversation to fail",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "performance_issue",
            "avg_response_time": 22.75115712483724,
            "max_response_time": 25.04991626739502,
            "severity": "low",
            "recommendation": "Investigate slow API responses or Gemini API delays"
          }
        ],
        "recommendations": [
          "\ud83d\udea8 CRITICAL: Fix crashes and exceptions. Review error logs and add error handling.",
          "\u26a0\ufe0f HIGH: Review eligibility evaluation logic in gemini_prescreening_manager.py",
          "\u26a0\ufe0f MEDIUM: Improve edge case handling. Add input validation and clarification prompts.",
          "\u2139\ufe0f LOW: Slow response times. Optimize API calls or consider caching."
        ]
      },
      "timestamp": "2025-12-16T05:02:00.368756"
    },
    {
      "patient_id": "AUTO_TEST_random_003",
      "patient_profile": {
        "patient_id": "AUTO_TEST_random_003",
        "profile_type": "random",
        "demographics": {
          "age": 48,
          "gender": "non-binary",
          "location": "Jackson, MS",
          "name": "Sarah Smith",
          "first_name": "Sarah",
          "last_name": "Smith"
        },
        "medical_history": {
          "primary_condition": "Gout",
          "conditions": [
            "Gout",
            "Diabetes"
          ],
          "medications": [
            "Probenecid",
            "Allopurinol"
          ],
          "duration_years": 3
        },
        "expected_behavior": {
          "should_find_trials": true,
          "likely_eligible": true,
          "expected_question_count_range": [
            4,
            8
          ]
        }
      },
      "conversation_result": {
        "session_id": "AUTO_TEST_random_003",
        "patient_id": "AUTO_TEST_random_003",
        "conversation_log": [
          {
            "user_message": "Gout trials in Jackson, MS",
            "bot_response": "I couldn't find any trials for Gout in Jackson, MS at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_random_003",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Gout",
                "location": "Jackson",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Jackson, MS"
                },
                "response_text": "Of course, I can help with that. Searching for Gout clinical trials near Jackson, MS for you now.",
                "new_state": "trials_found",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided a new condition (Gout) and a new location (Jackson, MS), which is a clear context switch from the previous topic of Psoriasis in New Orleans. Since I have all the necessary information (condition and location) to fulfill their explicit request, the most appropriate action is to perform a new trial search. The response acknowledges the new request and confirms the search parameters before proceeding."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Jackson, MS"
            },
            "response_time": 16.27504825592041,
            "timestamp": "2025-12-16T05:00:37.644247"
          }
        ],
        "final_state": "failed",
        "total_turns": 1,
        "total_questions_asked": 0,
        "errors": [
          {
            "type": "timeout",
            "message": "Yes, check my eligibility",
            "response_time": 30.722818851470947
          },
          {
            "type": "conversation_failure",
            "error": "",
            "state": "trials_shown",
            "timestamp": "2025-12-16T05:01:08.368003"
          }
        ]
      },
      "validation": {
        "passed": false,
        "overall_score": 26.0,
        "crash_prevention": {
          "passed": false,
          "score": 0.0,
          "error_count": 2,
          "errors": [
            {
              "type": "timeout",
              "message": "Yes, check my eligibility",
              "response_time": 30.722818851470947
            },
            {
              "type": "conversation_failure",
              "error": "",
              "state": "trials_shown",
              "timestamp": "2025-12-16T05:01:08.368003"
            }
          ],
          "failures": [
            {
              "type": "crash",
              "error_type": "timeout",
              "error_message": "Unknown error",
              "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
              "severity": "critical"
            },
            {
              "type": "crash",
              "error_type": "conversation_failure",
              "error_message": "",
              "likely_location": "Unknown - check full error trace",
              "severity": "critical"
            }
          ]
        },
        "eligibility_accuracy": {
          "passed": false,
          "score": 0.0,
          "reason": "Prescreening did not complete",
          "failures": [
            {
              "type": "eligibility_logic_error",
              "reason": "Prescreening flow did not complete",
              "final_state": "failed",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
              "severity": "high"
            }
          ]
        },
        "conversation_quality": {
          "passed": true,
          "score": 80.0,
          "total_questions_asked": 0,
          "issues": [
            "Too few questions asked (0, expected at least 4)"
          ],
          "failures": [
            {
              "type": "conversation_quality_issue",
              "issue": "Too few questions asked (0, expected at least 4)",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            }
          ]
        },
        "edge_case_handling": {
          "passed": true,
          "score": 100.0,
          "applicable": false,
          "failures": []
        },
        "performance": {
          "passed": true,
          "score": 70.0,
          "avg_response_time": 16.27504825592041,
          "max_response_time": 16.27504825592041,
          "status": "acceptable",
          "failures": []
        },
        "failure_points": [
          {
            "type": "crash",
            "error_type": "timeout",
            "error_message": "Unknown error",
            "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
            "severity": "critical"
          },
          {
            "type": "crash",
            "error_type": "conversation_failure",
            "error_message": "",
            "likely_location": "Unknown - check full error trace",
            "severity": "critical"
          },
          {
            "type": "eligibility_logic_error",
            "reason": "Prescreening flow did not complete",
            "final_state": "failed",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
            "severity": "high"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Too few questions asked (0, expected at least 4)",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          }
        ],
        "recommendations": [
          "\ud83d\udea8 CRITICAL: Fix crashes and exceptions. Review error logs and add error handling.",
          "\u26a0\ufe0f HIGH: Review eligibility evaluation logic in gemini_prescreening_manager.py"
        ]
      },
      "timestamp": "2025-12-16T05:01:08.368122"
    },
    {
      "patient_id": "AUTO_TEST_targeted_gout_000",
      "patient_profile": {
        "patient_id": "AUTO_TEST_targeted_gout_000",
        "profile_type": "targeted",
        "demographics": {
          "age": 34,
          "gender": "female",
          "location": "Jackson, MS",
          "name": "Test Gout Patient",
          "first_name": "Test",
          "last_name": "Patient"
        },
        "medical_history": {
          "primary_condition": "Gout",
          "conditions": [
            "Gout",
            "Hypertension"
          ],
          "medications": [
            "Lisinopril"
          ],
          "duration_years": 3,
          "flares_per_year": 4,
          "uric_acid_level": 8.5
        },
        "expected_behavior": {
          "should_find_trials": true,
          "likely_eligible": true,
          "expected_question_count_range": [
            5,
            8
          ],
          "target_trial_keywords": [
            "gout"
          ]
        }
      },
      "conversation_result": {
        "session_id": "AUTO_TEST_targeted_gout_000",
        "patient_id": "AUTO_TEST_targeted_gout_000",
        "conversation_log": [
          {
            "user_message": "Gout trials in Jackson, MS",
            "bot_response": "I couldn't find any trials for Gout in Jackson, MS at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_000",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Gout",
                "location": "Jackson",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Jackson, MS"
                },
                "response_text": "Of course. Searching for Gout clinical trials near Jackson, Mississippi for you now. One moment...",
                "new_state": "trials_found",
                "collect_entities": null,
                "metadata": {
                  "reasoning": "The user has provided both a condition ('Gout') and a new, specific location ('Jackson, MS'), which are the two required pieces of information to perform a trial search. The `search_trials` action is the most direct way to fulfill their explicit request. The response confirms the new search parameters and sets the expectation that results are forthcoming."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Jackson, MS"
            },
            "response_time": 17.995115041732788,
            "timestamp": "2025-12-16T05:00:39.364610"
          },
          {
            "user_message": "Yes, check my eligibility",
            "bot_response": "I need to know which specific trial you'd like to check eligibility for. Could you please search for trials first, or let me know what condition and location you're interested in?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_000",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "start_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "start_prescreening",
                "parameters": {
                  "condition": "Gout",
                  "location": "Jackson"
                },
                "response_text": "Of course. I'll ask a few questions to see if you might be a match for any Gout trials in the Jackson area. This is just a preliminary check, and the final decision is always up to the study team.\n\nTo start, could you please tell me your age?",
                "new_state": "prescreening",
                "collect_entities": [
                  "age"
                ],
                "metadata": {
                  "reasoning": "The user has explicitly confirmed their intent to check eligibility with 'Yes, check my eligibility'. The necessary information (condition: Gout, location: Jackson) has already been collected in previous turns. Therefore, the most appropriate action is to initiate the prescreening process. The response confirms the user's request, sets clear expectations about the preliminary nature of the screening, and asks the first common eligibility question (age) to move the conversation forward into the prescreening state."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "prescreening_error": "no_trial_id_found"
            },
            "response_time": 16.055853128433228,
            "timestamp": "2025-12-16T05:00:55.420708"
          },
          {
            "user_message": "Jackson, MS",
            "bot_response": "I couldn't find any trials for Gout in Jackson, MS at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_000",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": null,
                "location": "Jackson, MS",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Gout",
                  "location": "Jackson, MS"
                },
                "response_text": "Great, thank you. I'm now searching for clinical trials for Gout in or near Jackson, MS. I'll have some results for you in just a moment.",
                "new_state": "trials_found",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided their location, 'Jackson, MS'. Combined with the previously established condition 'Gout', I now have all the necessary information to fulfill their request to find clinical trials. The `search_trials` action is the logical next step to move the user towards their goal. The response confirms the action and sets expectations for the user."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Gout",
              "location": "Jackson, MS"
            },
            "response_time": 21.464671850204468,
            "timestamp": "2025-12-16T05:01:16.885589"
          },
          {
            "user_message": "Jackson, MS",
            "bot_response": "I understand you're looking for trials in Jackson, MS. I double-checked, and unfortunately, there don't seem to be any Gout studies in that immediate area right now. I know that can be disappointing. Would you be open to expanding the search to a wider area, perhaps within 50 or 100 miles?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_gout_000",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "general_response",
              "entities_collected": {
                "condition": null,
                "location": "Jackson, MS",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "general_response",
                "parameters": {},
                "response_text": "I understand you're looking for trials in Jackson, MS. I double-checked, and unfortunately, there don't seem to be any Gout studies in that immediate area right now. I know that can be disappointing. Would you be open to expanding the search to a wider area, perhaps within 50 or 100 miles?",
                "new_state": "initial",
                "collect_entities": [
                  "location",
                  "boolean_answer"
                ],
                "metadata": {
                  "reasoning": "The user has repeated their location after a previous search likely yielded no results. Running the same search again would be unhelpful and create a frustrating loop. The best action is to acknowledge their location, confirm the lack of results, and proactively suggest a constructive next step, such as expanding the search radius. This approach is empathetic and helps guide the user toward a more productive path."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "general_response": true
            },
            "response_time": 25.12214708328247,
            "timestamp": "2025-12-16T05:01:42.008044"
          }
        ],
        "final_state": "failed",
        "total_turns": 4,
        "total_questions_asked": 0,
        "errors": [
          {
            "type": "timeout",
            "message": "I'm not sure, can you clarify?",
            "response_time": 30.359981775283813
          },
          {
            "type": "conversation_failure",
            "error": "",
            "state": "prescreening_active",
            "timestamp": "2025-12-16T05:02:12.368334"
          }
        ]
      },
      "validation": {
        "passed": false,
        "overall_score": 23.0,
        "crash_prevention": {
          "passed": false,
          "score": 0.0,
          "error_count": 2,
          "errors": [
            {
              "type": "timeout",
              "message": "I'm not sure, can you clarify?",
              "response_time": 30.359981775283813
            },
            {
              "type": "conversation_failure",
              "error": "",
              "state": "prescreening_active",
              "timestamp": "2025-12-16T05:02:12.368334"
            }
          ],
          "failures": [
            {
              "type": "crash",
              "error_type": "timeout",
              "error_message": "Unknown error",
              "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
              "severity": "critical"
            },
            {
              "type": "crash",
              "error_type": "conversation_failure",
              "error_message": "",
              "likely_location": "Unknown - check full error trace",
              "severity": "critical"
            }
          ]
        },
        "eligibility_accuracy": {
          "passed": false,
          "score": 0.0,
          "reason": "Prescreening did not complete",
          "failures": [
            {
              "type": "eligibility_logic_error",
              "reason": "Prescreening flow did not complete",
              "final_state": "failed",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
              "severity": "high"
            }
          ]
        },
        "conversation_quality": {
          "passed": false,
          "score": 65.0,
          "total_questions_asked": 0,
          "issues": [
            "Too few questions asked (0, expected at least 5)",
            "Repeated question: I couldn't find any trials for Gout in Jackson, MS..."
          ],
          "failures": [
            {
              "type": "conversation_quality_issue",
              "issue": "Too few questions asked (0, expected at least 5)",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            },
            {
              "type": "conversation_quality_issue",
              "issue": "Repeated question: I couldn't find any trials for Gout in Jackson, MS...",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            }
          ]
        },
        "edge_case_handling": {
          "passed": true,
          "score": 100.0,
          "applicable": false,
          "failures": []
        },
        "performance": {
          "passed": false,
          "score": 40.0,
          "avg_response_time": 20.15944677591324,
          "max_response_time": 25.12214708328247,
          "status": "slow",
          "failures": [
            {
              "type": "performance_issue",
              "avg_response_time": 20.15944677591324,
              "max_response_time": 25.12214708328247,
              "severity": "low",
              "recommendation": "Investigate slow API responses or Gemini API delays"
            }
          ]
        },
        "failure_points": [
          {
            "type": "crash",
            "error_type": "timeout",
            "error_message": "Unknown error",
            "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
            "severity": "critical"
          },
          {
            "type": "crash",
            "error_type": "conversation_failure",
            "error_message": "",
            "likely_location": "Unknown - check full error trace",
            "severity": "critical"
          },
          {
            "type": "eligibility_logic_error",
            "reason": "Prescreening flow did not complete",
            "final_state": "failed",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
            "severity": "high"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Too few questions asked (0, expected at least 5)",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Repeated question: I couldn't find any trials for Gout in Jackson, MS...",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "performance_issue",
            "avg_response_time": 20.15944677591324,
            "max_response_time": 25.12214708328247,
            "severity": "low",
            "recommendation": "Investigate slow API responses or Gemini API delays"
          }
        ],
        "recommendations": [
          "\ud83d\udea8 CRITICAL: Fix crashes and exceptions. Review error logs and add error handling.",
          "\u26a0\ufe0f HIGH: Review eligibility evaluation logic in gemini_prescreening_manager.py",
          "\u2139\ufe0f LOW: Minor conversation quality issues. Consider refining prompts and validation.",
          "\u2139\ufe0f LOW: Slow response times. Optimize API calls or consider caching."
        ]
      },
      "timestamp": "2025-12-16T05:02:12.368485"
    },
    {
      "patient_id": "AUTO_TEST_targeted_diabetes_001",
      "patient_profile": {
        "patient_id": "AUTO_TEST_targeted_diabetes_001",
        "profile_type": "targeted",
        "demographics": {
          "age": 49,
          "gender": "male",
          "location": "Charlotte, NC",
          "name": "Test Diabetes Patient",
          "first_name": "Test",
          "last_name": "Patient"
        },
        "medical_history": {
          "primary_condition": "Type 2 Diabetes",
          "conditions": [
            "Type 2 Diabetes",
            "Hypertension"
          ],
          "medications": [
            "Metformin",
            "Lisinopril"
          ],
          "duration_years": 7,
          "a1c": 8.2,
          "blood_glucose": 180
        },
        "expected_behavior": {
          "should_find_trials": true,
          "likely_eligible": true,
          "expected_question_count_range": [
            5,
            9
          ],
          "target_trial_keywords": [
            "diabetes"
          ]
        }
      },
      "conversation_result": {
        "session_id": "AUTO_TEST_targeted_diabetes_001",
        "patient_id": "AUTO_TEST_targeted_diabetes_001",
        "conversation_log": [
          {
            "user_message": "Type 2 Diabetes trials in Charlotte, NC",
            "bot_response": "Great! I found 5 clinical trial(s) available in Charlotte, NC:\n\n**Dr. Melissa\tJones**\n  \u2022 Type 2 Diabetes (1 trial)\n  \u2022 Obesity (1 trial)\n  \u2022 Uncontrolled Hypertension (1 trial)\n  \u2022 COVID-19 (1 trial)\n\n**Dr. Keith Logan**\n  \u2022 Bipolar Depression (1 trial)\n\nWould you like to:\n1. Check your eligibility for any of these trials?\n2. Learn more about a specific condition?\n3. See trials in a different location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_diabetes_001",
              "current_state": "trials_shown",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Type 2 Diabetes",
                "location": "Charlotte",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Type 2 Diabetes",
                  "location": "Charlotte, NC"
                },
                "response_text": "Of course. It looks like you'd like to search in a new location. I can definitely look for Type 2 Diabetes trials in Charlotte, NC for you. One moment while I find the latest studies.",
                "new_state": "awaiting_search_results",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has explicitly provided a new location ('Charlotte, NC') for their search, while the condition ('Type 2 Diabetes') remains the same as the previous context. Since I have both the necessary pieces of information (condition and location), the most direct and helpful action is to perform a new search. The response acknowledges the change in location, confirms the search parameters, and sets the expectation that a search is underway."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "trials_found": 5,
              "condition": "Type 2 Diabetes",
              "location": "Charlotte, NC",
              "trials_data": [
                {
                  "id": 86,
                  "trial_name": "A Phase 3 Randomized, Double-Blind, Placebo-Controlled, 78-Week Efficacy and Safety Study of VK2735 Administered Subcutaneously for Weight Management in Participants with Type 2 Diabetes who are Obese, or Overweight (VANQUISH-2)",
                  "conditions": "Type 2 Diabetes",
                  "description": "This is a Phase 3, randomized, double-blind, placebo-controlled, multi-center study sponsored by Viking Therapeutics Inc.  This means that some participants will receive VK2735 while others receive a placebo, and neither the participants nor the study staff will know who is receiving which.  The study will last for approximately 88 weeks, including a screening period, 78 weeks of treatment, and a 6-week follow-up period.  The study will be conducted at multiple locations across the US. \n\nThis study is for adults with type 2 diabetes who are obese (BMI \u226530 kg/m\u00b2) or overweight (BMI \u226527 kg/m\u00b2).  You must be willing to attend regular study visits and follow the study procedures. Key exclusion criteria include having a history of pancreatitis, certain heart conditions, or currently taking certain medications.  The study aims to include a diverse group of participants, including those of different ethnic and racial backgrounds and those over 65.  During the study, you will receive either VK2735 or a placebo by weekly injection.  You will need to attend weekly visits for the first 33 weeks, then monthly visits thereafter. \n\nThe study will investigate the effectiveness and safety of VK2735 for weight loss.  Your weight, BMI, waist circumference, blood pressure, blood sugar levels (HbA1c and fasting plasma glucose), and cholesterol levels will be measured.  The primary goal is to see if VK2735 is better than placebo at helping participants lose weight.  Secondary goals include assessing the impact of VK2735 on other health measures like blood sugar control and cholesterol levels.  You will have regular check-ups and assessments, including blood tests, physical exams, and questionnaires about your health and quality of life.",
                  "investigator_name": "Dr. Melissa\tJones",
                  "site_location": "Charlotte, NC",
                  "protocol_summary": "This is a Phase 3, randomized, double-blind, placebo-controlled, multi-center study sponsored by Viking Therapeutics Inc.  This means that some participants will receive VK2735 while others receive a placebo, and neither the participants nor the study staff will know who is receiving which.  The study will last for approximately 88 weeks, including a screening period, 78 weeks of treatment, and a 6-week follow-up period.  The study will be conducted at multiple locations across the US. \n\nThis study is for adults with type 2 diabetes who are obese (BMI \u226530 kg/m\u00b2) or overweight (BMI \u226527 kg/m\u00b2).  You must be willing to attend regular study visits and follow the study procedures. Key exclusion criteria include having a history of pancreatitis, certain heart conditions, or currently taking certain medications.  The study aims to include a diverse group of participants, including those of different ethnic and racial backgrounds and those over 65.  During the study, you will receive either VK2735 or a placebo by weekly injection.  You will need to attend weekly visits for the first 33 weeks, then monthly visits thereafter. \n\nThe study will investigate the effectiveness and safety of VK2735 for weight loss.  Your weight, BMI, waist circumference, blood pressure, blood sugar levels (HbA1c and fasting plasma glucose), and cholesterol levels will be measured.  The primary goal is to see if VK2735 is better than placebo at helping participants lose weight.  Secondary goals include assessing the impact of VK2735 on other health measures like blood sugar control and cholesterol levels.  You will have regular check-ups and assessments, including blood tests, physical exams, and questionnaires about your health and quality of life.",
                  "total_sites": 4,
                  "similarity_score": 0.7753052578511981
                },
                {
                  "id": 85,
                  "trial_name": "A Phase 3 Randomized, Double-Blind, Placebo-Controlled, 78-Week Efficacy and Safety Study of VK2735 Administered Subcutaneously for Weight Management in Participants without Type 2 Diabetes who are Obese, or Overweight with at Least One Weight-related Comorbid Condition (VANQUISH-1)",
                  "conditions": "Obesity",
                  "description": "This is a Phase 3, randomized, double-blind, placebo-controlled, multi-center study sponsored by Viking Therapeutics Inc.  This means that some participants will receive VK2735 while others receive a placebo, and neither the participants nor the study staff will know who is receiving which.  The study will take place over approximately 88 weeks, including a screening period, 78 weeks of treatment, and a follow-up period. The study aims to evaluate the effectiveness and safety of VK2735 for weight loss.  The locations of the study sites are not specified in this protocol excerpt.\n\nThis study is for adults who are obese (BMI \u226530 kg/m\u00b2) or overweight (BMI \u226527 kg/m\u00b2) with at least one weight-related health issue, but who do *not* have Type 2 Diabetes.  You must be willing to attend regular study visits and follow the study procedures.  Women make up no more than 65% of the participants to ensure enough men are included. The study aims to include people from diverse ethnic and racial backgrounds and those over 65.  If you are eligible and choose to participate, you will be randomly assigned to receive either VK2735 or a placebo.  You will need to attend study visits regularly, especially in the first 33 weeks.\n\nParticipants will receive weekly injections of VK2735 or placebo under the skin. The dose of VK2735 will be gradually increased over several weeks until the target dose is reached.  The study will measure changes in body weight, BMI, waist circumference, blood pressure, cholesterol, and other health indicators.  The main goal is to see if VK2735 is better than placebo at helping people lose weight.  Other goals include assessing the percentage of participants achieving various levels of weight loss (e.g., 5%, 10%, 15%, 20%), and evaluating the impact of VK2735 on blood sugar, cholesterol levels, and quality of life.  Visits will be weekly for the first 33 weeks, then monthly, with self-administered injections between monthly visits.  You will also undergo regular blood tests, vital sign checks, and other assessments.",
                  "investigator_name": "Dr. Melissa\tJones",
                  "site_location": "Charlotte, NC",
                  "protocol_summary": "This is a Phase 3, randomized, double-blind, placebo-controlled, multi-center study sponsored by Viking Therapeutics Inc.  This means that some participants will receive VK2735 while others receive a placebo, and neither the participants nor the study staff will know who is receiving which.  The study will take place over approximately 88 weeks, including a screening period, 78 weeks of treatment, and a follow-up period. The study aims to evaluate the effectiveness and safety of VK2735 for weight loss.  The locations of the study sites are not specified in this protocol excerpt.\n\nThis study is for adults who are obese (BMI \u226530 kg/m\u00b2) or overweight (BMI \u226527 kg/m\u00b2) with at least one weight-related health issue, but who do *not* have Type 2 Diabetes.  You must be willing to attend regular study visits and follow the study procedures.  Women make up no more than 65% of the participants to ensure enough men are included. The study aims to include people from diverse ethnic and racial backgrounds and those over 65.  If you are eligible and choose to participate, you will be randomly assigned to receive either VK2735 or a placebo.  You will need to attend study visits regularly, especially in the first 33 weeks.\n\nParticipants will receive weekly injections of VK2735 or placebo under the skin. The dose of VK2735 will be gradually increased over several weeks until the target dose is reached.  The study will measure changes in body weight, BMI, waist circumference, blood pressure, cholesterol, and other health indicators.  The main goal is to see if VK2735 is better than placebo at helping people lose weight.  Other goals include assessing the percentage of participants achieving various levels of weight loss (e.g., 5%, 10%, 15%, 20%), and evaluating the impact of VK2735 on blood sugar, cholesterol levels, and quality of life.  Visits will be weekly for the first 33 weeks, then monthly, with self-administered injections between monthly visits.  You will also undergo regular blood tests, vital sign checks, and other assessments.",
                  "total_sites": 4,
                  "similarity_score": 0.7676449959903872
                },
                {
                  "id": 112,
                  "trial_name": "A Phase 3, Randomized, Double-blind, Placebo-Controlled, Multicenter Study to Evaluate the Efficacy and Safety of Investigational Product in Depressive Episodes Associated With Bipolar I or II Disorder (Bipolar Depression)",
                  "conditions": "Bipolar Depression",
                  "description": "This is a Phase 3 clinical research study for a new investigational product for bipolar depression. It is a global study taking place at multiple centers. The study is \"randomized\" and \"double-blind,\" which means you will be assigned by chance (like a coin flip) to receive either the investigational product or a placebo, a pill with no active medicine. Neither you nor your study doctor will know which treatment you are receiving, which helps ensure the results are unbiased. Your total participation in the study will last for approximately 18 weeks, which includes screening, a 6-week treatment period, and an 8-week follow-up period.\n\nThis study is looking for adults between the ages of 18 and 74 who have been diagnosed with Bipolar I or Bipolar II disorder and are currently experiencing a moderate to severe depressive episode. To be eligible, your current depressive episode must have lasted between 4 weeks and 12 months, and you must meet specific scores on depression rating scales. You may not be able to participate if you have recently had suicidal plans, have been found to be resistant to two or more previous treatments for your current episode, or are taking certain other psychiatric medications. The study team will review all eligibility criteria with you to determine if this study is a good fit.\n\nIf you join the study, you will take one capsule by mouth each day for 6 weeks; this will be either the investigational product or a placebo. The main purpose of the study is to see if the investigational product can reduce symptoms of depression more effectively than a placebo, which will be measured using a standard depression questionnaire (the MADRS). Researchers will also assess the product's effects on the loss of pleasure (anhedonia), its safety, and how quickly it may begin to work. Your participation will involve regular visits to the study center for assessments, which include questionnaires, vital signs checks, blood tests, and heart tracings (ECGs).",
                  "investigator_name": "Dr. Keith Logan",
                  "site_location": "Charlotte, NC",
                  "protocol_summary": "This is a Phase 3 clinical research study for a new investigational product for bipolar depression. It is a global study taking place at multiple centers. The study is \"randomized\" and \"double-blind,\" which means you will be assigned by chance (like a coin flip) to receive either the investigational product or a placebo, a pill with no active medicine. Neither you nor your study doctor will know which treatment you are receiving, which helps ensure the results are unbiased. Your total participation in the study will last for approximately 18 weeks, which includes screening, a 6-week treatment period, and an 8-week follow-up period.\n\nThis study is looking for adults between the ages of 18 and 74 who have been diagnosed with Bipolar I or Bipolar II disorder and are currently experiencing a moderate to severe depressive episode. To be eligible, your current depressive episode must have lasted between 4 weeks and 12 months, and you must meet specific scores on depression rating scales. You may not be able to participate if you have recently had suicidal plans, have been found to be resistant to two or more previous treatments for your current episode, or are taking certain other psychiatric medications. The study team will review all eligibility criteria with you to determine if this study is a good fit.\n\nIf you join the study, you will take one capsule by mouth each day for 6 weeks; this will be either the investigational product or a placebo. The main purpose of the study is to see if the investigational product can reduce symptoms of depression more effectively than a placebo, which will be measured using a standard depression questionnaire (the MADRS). Researchers will also assess the product's effects on the loss of pleasure (anhedonia), its safety, and how quickly it may begin to work. Your participation will involve regular visits to the study center for assessments, which include questionnaires, vital signs checks, blood tests, and heart tracings (ECGs).",
                  "total_sites": 1,
                  "similarity_score": 0.7226466325821072
                }
              ],
              "semantic_search": true
            },
            "response_time": 19.082780361175537,
            "timestamp": "2025-12-16T05:02:31.457303"
          },
          {
            "user_message": "Yes, check my eligibility",
            "bot_response": "Great! I'll help you check your eligibility.\n\nI need to ask you a few questions about the diabetes trial.\n\n**Question 1 of 5:** What is your age?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_diabetes_001",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "start_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": true,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "start_prescreening",
                "parameters": {},
                "response_text": "Great! I can help with that. I'll ask a few simple questions to see if you might be a match for any of these trials. This is just a preliminary check, and your answers are kept private.\n\nTo start, could you please tell me your age?",
                "new_state": "prescreening_in_progress",
                "collect_entities": [
                  "age"
                ],
                "metadata": {
                  "reasoning": "The user has explicitly agreed to an eligibility check after being shown a list of trials. The current state is 'trials_shown', and the user's intent is 'trial_interest'. The most logical and helpful next step is to begin the prescreening process by asking the first eligibility question, which is typically age. This transitions the conversation state to 'prescreening_in_progress'."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "prescreening_started": true,
              "trial_id": 86,
              "trial_name": "A Phase 3 Randomized, Double-Blind, Placebo-Controlled, 78-Week Efficacy and Safety Study of VK2735 Administered Subcutaneously for Weight Management in Participants with Type 2 Diabetes who are Obese, or Overweight (VANQUISH-2)",
              "current_question_index": 0,
              "total_questions": 5,
              "current_question": "What is your age?",
              "expected_answer_type": "number"
            },
            "response_time": 18.012213945388794,
            "timestamp": "2025-12-16T05:02:49.469800"
          },
          {
            "user_message": "49",
            "bot_response": "Got it.\n\nWhat is your current weight and height?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_diabetes_001",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "continue_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": 49,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "continue_prescreening",
                "parameters": {},
                "response_text": "Great, thanks for sharing that. Next, how long ago were you diagnosed with Type 2 Diabetes?",
                "new_state": "prescreening_active",
                "collect_entities": [
                  "duration"
                ],
                "metadata": {
                  "reasoning": "The user is in an active prescreening flow (state: prescreening_active) and has just provided their age in response to a question. The most logical and helpful next step is to acknowledge their answer and proceed with the next question in the prescreening sequence to determine their eligibility for the trial. This maintains the conversational flow and moves the user closer to their goal of checking eligibility."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "current_question_index": 1,
              "total_questions": 5,
              "current_question": "What is your current weight and height?",
              "expected_answer_type": "text",
              "parsed_answer": {
                "interpretation": "number",
                "confidence": 1.0
              }
            },
            "response_time": 19.662484884262085,
            "timestamp": "2025-12-16T05:03:09.133041"
          },
          {
            "user_message": "5'10\"",
            "bot_response": "I found your height (5'10\") but couldn't determine your weight. Could you specify your weight?\n\nExamples: '180 pounds', '180 lbs', '215', or '82 kg'",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_diabetes_001",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "continue_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": "5'10\"",
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "continue_prescreening",
                "parameters": {},
                "response_text": "Thanks for sharing that. Next question: Do you know your most recent A1c level? If so, what was it?",
                "new_state": "prescreening_active",
                "collect_entities": [
                  "number"
                ],
                "metadata": {
                  "reasoning": "The user is in an active prescreening session and has provided their height in response to a previous question. The most logical and helpful next step is to acknowledge their answer and proceed with the next question in the prescreening sequence. A question about A1c level is a standard and crucial data point for a Type 2 Diabetes trial, making it an appropriate next step to determine eligibility."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "validation_error": true,
              "awaiting_correction": true,
              "current_question_index": 1
            },
            "response_time": 20.171195030212402,
            "timestamp": "2025-12-16T05:03:29.304693"
          }
        ],
        "final_state": "completed",
        "total_turns": 4,
        "total_questions_asked": 5,
        "errors": [
          {
            "type": "unexpected_state",
            "bot_response": "I found your height (5'10\") but couldn't determine your weight. Could you specify your weight?\n\nExamples: '180 pounds', '180 lbs', '215', or '82 kg'"
          }
        ]
      },
      "validation": {
        "passed": false,
        "overall_score": 70.0,
        "crash_prevention": {
          "passed": true,
          "score": 100.0,
          "error_count": 0,
          "errors": [],
          "failures": []
        },
        "eligibility_accuracy": {
          "passed": false,
          "score": 0.0,
          "reason": "Could not extract eligibility result",
          "failures": [
            {
              "type": "eligibility_logic_error",
              "reason": "No eligibility determination found in conversation",
              "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
              "severity": "high"
            }
          ]
        },
        "conversation_quality": {
          "passed": true,
          "score": 100.0,
          "total_questions_asked": 5,
          "issues": [],
          "failures": []
        },
        "edge_case_handling": {
          "passed": true,
          "score": 100.0,
          "applicable": false,
          "failures": []
        },
        "performance": {
          "passed": true,
          "score": 70.0,
          "avg_response_time": 19.232168555259705,
          "max_response_time": 20.171195030212402,
          "status": "acceptable",
          "failures": []
        },
        "failure_points": [
          {
            "type": "eligibility_logic_error",
            "reason": "No eligibility determination found in conversation",
            "likely_location": "core/prescreening/gemini_prescreening_manager.py:evaluate_eligibility()",
            "severity": "high"
          }
        ],
        "recommendations": [
          "\u26a0\ufe0f HIGH: Review eligibility evaluation logic in gemini_prescreening_manager.py"
        ]
      },
      "timestamp": "2025-12-16T05:03:29.305797"
    },
    {
      "patient_id": "AUTO_TEST_random_001",
      "patient_profile": {
        "patient_id": "AUTO_TEST_random_001",
        "profile_type": "random",
        "demographics": {
          "age": 48,
          "gender": "non-binary",
          "location": "Baton Rouge, LA",
          "name": "Mary Garcia",
          "first_name": "Mary",
          "last_name": "Garcia"
        },
        "medical_history": {
          "primary_condition": "Psoriasis",
          "conditions": [
            "Psoriasis"
          ],
          "medications": [
            "Cyclosporine",
            "Methotrexate",
            "Topical Corticosteroids"
          ],
          "duration_years": 4
        },
        "expected_behavior": {
          "should_find_trials": true,
          "likely_eligible": true,
          "expected_question_count_range": [
            4,
            8
          ]
        }
      },
      "conversation_result": {
        "session_id": "AUTO_TEST_random_001",
        "patient_id": "AUTO_TEST_random_001",
        "conversation_log": [
          {
            "user_message": "Psoriasis trials in Baton Rouge, LA",
            "bot_response": "Great! I found 5 clinical trial(s) available in Baton Rouge, LA:\n\n**Dr. Ira Thorla**\n  \u2022 Female Pattern Hair Loss (Androgenetic Alopecia) (1 trial)\n  \u2022 Hidradenitis Suppurativa (1 trial)\n  \u2022 Acne Vulgaris (1 trial)\n  \u2022 Atopic Dermatitis (1 trial)\n\n**Dr. Taylor Sanders**\n  \u2022 Nonsegmental Vitiligo (1 trial)\n\nWould you like to:\n1. Check your eligibility for any of these trials?\n2. Learn more about a specific condition?\n3. See trials in a different location?",
            "metadata": {
              "session_id": "AUTO_TEST_random_001",
              "current_state": "trials_shown",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Psoriasis",
                "location": "Baton Rouge",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Psoriasis",
                  "location": "Baton Rouge, LA"
                },
                "response_text": "Happy to switch gears and look into that for you. Searching for Psoriasis clinical trials near Baton Rouge, Louisiana now...",
                "new_state": "trials_found",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided a new condition ('Psoriasis') and a new location ('Baton Rouge, LA'), which overrides the previous conversation context. Since I have all the necessary information for a new search, the correct action is 'search_trials'. The response acknowledges the context switch gracefully and confirms the new search parameters to the user before presenting the results."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "trials_found": 5,
              "condition": "Psoriasis",
              "location": "Baton Rouge, LA",
              "trials_data": [
                {
                  "id": 14,
                  "trial_name": "Clinical Trial 250-13951-306",
                  "conditions": "Female Pattern Hair Loss (Androgenetic Alopecia)",
                  "description": null,
                  "investigator_name": "Dr. Ira Thorla",
                  "site_location": "Baton Rouge, LA",
                  "protocol_summary": "This clinical trial aims to investigate the effectiveness and safety of an oral medication called VDPHL01 for treating female pattern hair loss (androgenetic alopecia).  The study will evaluate two different dosing regimens of VDPHL01: twice daily and once daily.  It will compare these regimens against a placebo to see if the medication promotes hair growth and improves patient satisfaction with their hair.\n\nWomen aged 18-65 with mild to moderate hair loss, as measured by the Savin Scale, are eligible to participate.  Key inclusion criteria include good general health, adequate kidney and liver function, and a commitment to maintaining consistent hair care routines throughout the study.  Women who are pregnant, breastfeeding, have certain medical conditions (like uncontrolled blood pressure or a history of heart problems), or have recently used other hair growth treatments are excluded.\n\nThe study will last approximately 13 months and consist of two parts. Part A is a 6-month placebo-controlled period, where participants are randomly assigned to one of four groups: VDPHL01 twice daily, VDPHL01 once daily plus placebo, placebo twice daily, or placebo twice daily.  Part B is a 6-month treatment extension, where those initially receiving placebo will start taking VDPHL01 according to their initial group assignment, while those already on VDPHL01 will continue.  Participants will have regular clinic visits (approximately 11) for assessments including physical exams, blood and urine tests, electrocardiograms, photographs of the scalp, and questionnaires about their hair and quality of life. A small group of participants will also take part in interviews.  A final follow-up will occur one month after the treatment period ends.\n",
                  "total_sites": 2,
                  "similarity_score": 0.8174656906579815
                },
                {
                  "id": 109,
                  "trial_name": "A Phase 2, Multicenter, Randomized, Placebo-Controlled, Double-Blind, Dose-Ranging Study to Evaluate the Efficacy and Safety of Zasocitinib in Participants with Nonsegmental Vitiligo",
                  "conditions": "Nonsegmental Vitiligo",
                  "description": "This is a Phase 2 clinical research study sponsored by Takeda Pharmaceuticals to test an investigational oral medication called zasocitinib for adults with nonsegmental vitiligo. The study is designed to be multicenter, meaning it will take place at various clinics and hospitals. It is a randomized, double-blind, placebo-controlled trial. This means participants will be randomly assigned (like a coin flip) to receive one of several different doses of zasocitinib or a placebo, which contains no active medicine. The double-blind design ensures that neither the participant nor the study doctor will know which treatment is being administered, which helps prevent bias in the results. The study will involve a screening period to determine eligibility, a treatment period, and a follow-up period.\n\nTo be eligible for this study, you must be an adult with a confirmed diagnosis of nonsegmental vitiligo. The study is looking for individuals whose vitiligo affects a certain amount of their body surface area and is considered stable or active. You may not be able to participate if you are pregnant or breastfeeding, have certain other medical conditions, or have recently used specific medications or therapies for vitiligo, including other JAK inhibitors or phototherapy. Before joining, the study team will explain all the details in an informed consent document, and you will have the opportunity to ask any questions to decide if participation is right for you.\n\nThe primary goal of this study is to evaluate how effective different doses of zasocitinib are at promoting skin repigmentation compared to a placebo. This will be measured by the study doctor using a standardized scoring system (Vitiligo Area Scoring Index, or VASI) that assesses changes in vitiligo on your face and body. The study will also assess the drug's safety and its impact on your quality of life through questionnaires. Participation requires regular visits to the study clinic for assessments, which will include physical exams, blood tests, medical photography to document skin changes, and completing surveys about your symptoms and well-being.",
                  "investigator_name": "Dr. Taylor Sanders",
                  "site_location": "Baton Rouge, LA",
                  "protocol_summary": "This is a Phase 2 clinical research study sponsored by Takeda Pharmaceuticals to test an investigational oral medication called zasocitinib for adults with nonsegmental vitiligo. The study is designed to be multicenter, meaning it will take place at various clinics and hospitals. It is a randomized, double-blind, placebo-controlled trial. This means participants will be randomly assigned (like a coin flip) to receive one of several different doses of zasocitinib or a placebo, which contains no active medicine. The double-blind design ensures that neither the participant nor the study doctor will know which treatment is being administered, which helps prevent bias in the results. The study will involve a screening period to determine eligibility, a treatment period, and a follow-up period.\n\nTo be eligible for this study, you must be an adult with a confirmed diagnosis of nonsegmental vitiligo. The study is looking for individuals whose vitiligo affects a certain amount of their body surface area and is considered stable or active. You may not be able to participate if you are pregnant or breastfeeding, have certain other medical conditions, or have recently used specific medications or therapies for vitiligo, including other JAK inhibitors or phototherapy. Before joining, the study team will explain all the details in an informed consent document, and you will have the opportunity to ask any questions to decide if participation is right for you.\n\nThe primary goal of this study is to evaluate how effective different doses of zasocitinib are at promoting skin repigmentation compared to a placebo. This will be measured by the study doctor using a standardized scoring system (Vitiligo Area Scoring Index, or VASI) that assesses changes in vitiligo on your face and body. The study will also assess the drug's safety and its impact on your quality of life through questionnaires. Participation requires regular visits to the study clinic for assessments, which will include physical exams, blood tests, medical photography to document skin changes, and completing surveys about your symptoms and well-being.",
                  "total_sites": 2,
                  "similarity_score": 0.7841763997694425
                },
                {
                  "id": 80,
                  "trial_name": "A Maximal Use Trial of Ruxolitinib Cream in Adult and Adolescent Participants With Hidradenitis Suppurativa",
                  "conditions": "Hidradenitis Suppurativa",
                  "description": "This is a Phase 1, open-label (not blinded), single-group study sponsored by Incyte Corporation.  The study will be conducted at multiple locations (multicenter) and is designed to evaluate the safety and tolerability of ruxolitinib cream. The total study duration, including screening, treatment, and follow-up, could be up to approximately 24 weeks.\n\nThis study is for adults and adolescents aged 12 to 75 years who have been diagnosed with hidradenitis suppurativa (HS) for at least 6 months.  To be eligible, you must have at least 4 abscesses and inflammatory nodules affecting at least 3 different areas of your body, with a total treatment area greater than 20% of your body surface area.  You may not be eligible if you have certain other skin conditions or are taking specific medications. During the study, you will be asked to apply the study cream twice daily to all affected areas and attend regular visits for check-ups and assessments.\n\nIn this study, you will apply ruxolitinib 1.5% cream twice daily to all affected areas for 4 weeks.  Researchers will monitor your health through blood tests, physical exams, and by asking you about any side effects.  The main goals are to assess the safety and tolerability of the cream, including any side effects, and to measure how much of the drug gets into your bloodstream.  Secondary goals include evaluating the cream's effect on your HS lesions, pain, itching, and quality of life.  You will have regular visits during the 4-week treatment period and potentially for a longer extension period, followed by a final safety follow-up visit.",
                  "investigator_name": "Dr. Ira Thorla",
                  "site_location": "Baton Rouge, LA",
                  "protocol_summary": "This is a Phase 1, open-label (not blinded), single-group study sponsored by Incyte Corporation.  The study will be conducted at multiple locations (multicenter) and is designed to evaluate the safety and tolerability of ruxolitinib cream. The total study duration, including screening, treatment, and follow-up, could be up to approximately 24 weeks.\n\nThis study is for adults and adolescents aged 12 to 75 years who have been diagnosed with hidradenitis suppurativa (HS) for at least 6 months.  To be eligible, you must have at least 4 abscesses and inflammatory nodules affecting at least 3 different areas of your body, with a total treatment area greater than 20% of your body surface area.  You may not be eligible if you have certain other skin conditions or are taking specific medications. During the study, you will be asked to apply the study cream twice daily to all affected areas and attend regular visits for check-ups and assessments.\n\nIn this study, you will apply ruxolitinib 1.5% cream twice daily to all affected areas for 4 weeks.  Researchers will monitor your health through blood tests, physical exams, and by asking you about any side effects.  The main goals are to assess the safety and tolerability of the cream, including any side effects, and to measure how much of the drug gets into your bloodstream.  Secondary goals include evaluating the cream's effect on your HS lesions, pain, itching, and quality of life.  You will have regular visits during the 4-week treatment period and potentially for a longer extension period, followed by a final safety follow-up visit.",
                  "total_sites": 1,
                  "similarity_score": 0.7694749411748597
                }
              ],
              "semantic_search": true
            },
            "response_time": 22.05758309364319,
            "timestamp": "2025-12-16T05:02:34.427186"
          },
          {
            "user_message": "Yes, check my eligibility",
            "bot_response": "Great! I'll help you check your eligibility.\n\nI need to ask you a few questions about the psoriasis trial.\n\n**Question 1 of 4:** What is your age?",
            "metadata": {
              "session_id": "AUTO_TEST_random_001",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "start_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": "yes",
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "start_prescreening",
                "parameters": {},
                "response_text": "Great, I can help with that. I'll ask a few questions to see if you might be a match for these studies. Please keep in mind that this is just a preliminary check, and the final decision is always made by the study team.\n\nFirst, how old are you?",
                "new_state": "prescreening",
                "collect_entities": [
                  "age"
                ],
                "metadata": {
                  "reasoning": "The user has explicitly confirmed their interest in checking eligibility ('Yes, check my eligibility') after trials were shown (state: 'trials_shown'). The most appropriate action is to initiate the prescreening process. The response acknowledges their request, sets expectations about the preliminary nature of the check, and asks the first common eligibility question (age) to begin the screening flow. The state is transitioned to 'prescreening' to reflect this new stage of the conversation."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "prescreening_started": true,
              "trial_id": 14,
              "trial_name": "Clinical Trial 250-13951-306",
              "current_question_index": 0,
              "total_questions": 4,
              "current_question": "What is your age?",
              "expected_answer_type": "number"
            },
            "response_time": 18.8102548122406,
            "timestamp": "2025-12-16T05:02:53.237749"
          },
          {
            "user_message": "48",
            "bot_response": "Got it.\n\nHave you been diagnosed with mild to moderate aga with a score of i-4 by a doctor?",
            "metadata": {
              "session_id": "AUTO_TEST_random_001",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "continue_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": 48,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "continue_prescreening",
                "parameters": {},
                "response_text": "Got it, thanks. Next question: Have you previously been treated with a biologic medication for your psoriasis, such as Humira, Stelara, or Cosentyx?",
                "new_state": "prescreening_active",
                "collect_entities": [
                  "boolean_answer"
                ],
                "metadata": {
                  "reasoning": "The user is in an active prescreening flow ('prescreening_active' state) and has just provided their age in response to a question. The correct action is to acknowledge their answer and proceed with the next question in the prescreening sequence to continue determining their eligibility. The chosen next question about prior biologic treatments is a common and relevant screener for psoriasis trials. The state remains 'prescreening_active' as the process is not yet complete."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "current_question_index": 1,
              "total_questions": 4,
              "current_question": "Have you been diagnosed with mild to moderate aga with a score of i-4 by a doctor?",
              "expected_answer_type": "yes_no",
              "parsed_answer": {
                "interpretation": "number",
                "confidence": 1.0
              }
            },
            "response_time": 19.64621901512146,
            "timestamp": "2025-12-16T05:03:12.884754"
          }
        ],
        "final_state": "failed",
        "total_turns": 3,
        "total_questions_asked": 4,
        "errors": [
          {
            "type": "timeout",
            "message": "Yes, I have Psoriasis",
            "response_time": 30.484838724136353
          },
          {
            "type": "conversation_failure",
            "error": "",
            "state": "prescreening_active",
            "timestamp": "2025-12-16T05:03:43.370078"
          }
        ]
      },
      "validation": {
        "passed": false,
        "overall_score": 30.0,
        "crash_prevention": {
          "passed": false,
          "score": 0.0,
          "error_count": 2,
          "errors": [
            {
              "type": "timeout",
              "message": "Yes, I have Psoriasis",
              "response_time": 30.484838724136353
            },
            {
              "type": "conversation_failure",
              "error": "",
              "state": "prescreening_active",
              "timestamp": "2025-12-16T05:03:43.370078"
            }
          ],
          "failures": [
            {
              "type": "crash",
              "error_type": "timeout",
              "error_message": "Unknown error",
              "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
              "severity": "critical"
            },
            {
              "type": "crash",
              "error_type": "conversation_failure",
              "error_message": "",
              "likely_location": "Unknown - check full error trace",
              "severity": "critical"
            }
          ]
        },
        "eligibility_accuracy": {
          "passed": false,
          "score": 0.0,
          "reason": "Prescreening did not complete",
          "failures": [
            {
              "type": "eligibility_logic_error",
              "reason": "Prescreening flow did not complete",
              "final_state": "failed",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
              "severity": "high"
            }
          ]
        },
        "conversation_quality": {
          "passed": true,
          "score": 100.0,
          "total_questions_asked": 4,
          "issues": [],
          "failures": []
        },
        "edge_case_handling": {
          "passed": true,
          "score": 100.0,
          "applicable": false,
          "failures": []
        },
        "performance": {
          "passed": false,
          "score": 40.0,
          "avg_response_time": 20.17135230700175,
          "max_response_time": 22.05758309364319,
          "status": "slow",
          "failures": [
            {
              "type": "performance_issue",
              "avg_response_time": 20.17135230700175,
              "max_response_time": 22.05758309364319,
              "severity": "low",
              "recommendation": "Investigate slow API responses or Gemini API delays"
            }
          ]
        },
        "failure_points": [
          {
            "type": "crash",
            "error_type": "timeout",
            "error_message": "Unknown error",
            "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
            "severity": "critical"
          },
          {
            "type": "crash",
            "error_type": "conversation_failure",
            "error_message": "",
            "likely_location": "Unknown - check full error trace",
            "severity": "critical"
          },
          {
            "type": "eligibility_logic_error",
            "reason": "Prescreening flow did not complete",
            "final_state": "failed",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
            "severity": "high"
          },
          {
            "type": "performance_issue",
            "avg_response_time": 20.17135230700175,
            "max_response_time": 22.05758309364319,
            "severity": "low",
            "recommendation": "Investigate slow API responses or Gemini API delays"
          }
        ],
        "recommendations": [
          "\ud83d\udea8 CRITICAL: Fix crashes and exceptions. Review error logs and add error handling.",
          "\u26a0\ufe0f HIGH: Review eligibility evaluation logic in gemini_prescreening_manager.py",
          "\u2139\ufe0f LOW: Slow response times. Optimize API calls or consider caching."
        ]
      },
      "timestamp": "2025-12-16T05:03:43.370942"
    },
    {
      "patient_id": "AUTO_TEST_targeted_psoriasis_002",
      "patient_profile": {
        "patient_id": "AUTO_TEST_targeted_psoriasis_002",
        "profile_type": "targeted",
        "demographics": {
          "age": 25,
          "gender": "male",
          "location": "Atlanta, GA",
          "name": "Test Psoriasis Patient",
          "first_name": "Test",
          "last_name": "Patient"
        },
        "medical_history": {
          "primary_condition": "Psoriasis",
          "conditions": [
            "Plaque Psoriasis"
          ],
          "medications": [
            "Topical Corticosteroids"
          ],
          "duration_years": 5,
          "pasi_score": 15,
          "body_surface_area": "20%"
        },
        "expected_behavior": {
          "should_find_trials": true,
          "likely_eligible": true,
          "expected_question_count_range": [
            4,
            7
          ],
          "target_trial_keywords": [
            "psoriasis",
            "dermatology"
          ]
        }
      },
      "conversation_result": {
        "session_id": "AUTO_TEST_targeted_psoriasis_002",
        "patient_id": "AUTO_TEST_targeted_psoriasis_002",
        "conversation_log": [
          {
            "user_message": "Psoriasis trials in Atlanta, GA",
            "bot_response": "Great! I found 5 clinical trial(s) available in Atlanta, GA:\n\n**Dr. Robert Springer**\n  \u2022 Female Pattern Hair Loss (Androgenetic Alopecia) (1 trial)\n  \u2022 Idiopathic Gastroparesis (1 trial)\n  \u2022 Gout (1 trial)\n  \u2022 Fibromyalgia (1 trial)\n\n**Dr. Zachary Eyre**\n  \u2022 Moderate to Severe Hidradenitis Suppurativa (1 trial)\n\nWould you like to:\n1. Check your eligibility for any of these trials?\n2. Learn more about a specific condition?\n3. See trials in a different location?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_002",
              "current_state": "trials_shown",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Psoriasis",
                "location": "Atlanta",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Psoriasis",
                  "location": "Atlanta, GA"
                },
                "response_text": "I can certainly help you find Psoriasis trials in the Atlanta, GA area. I'm looking up the latest studies for you now. \n\nOnce I have the list, we can also go through a few questions to see if you might be a good fit for any of them. Does that sound like a good next step?",
                "new_state": "trial_results_displayed",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided all the necessary information (condition: 'Psoriasis' and location: 'Atlanta, GA') to perform a trial search. Therefore, the `search_trials` action is the most appropriate and direct way to fulfill their request. The response confirms their request, states the action being taken, and proactively offers the next logical step (eligibility prescreening) to guide the user effectively and manage their expectations."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "trials_found": 5,
              "condition": "Psoriasis",
              "location": "Atlanta, GA",
              "trials_data": [
                {
                  "id": 14,
                  "trial_name": "Clinical Trial 250-13951-306",
                  "conditions": "Female Pattern Hair Loss (Androgenetic Alopecia)",
                  "description": null,
                  "investigator_name": "Dr. Robert Springer",
                  "site_location": "Atlanta, GA",
                  "protocol_summary": "This clinical trial aims to investigate the effectiveness and safety of an oral medication called VDPHL01 for treating female pattern hair loss (androgenetic alopecia).  The study will evaluate two different dosing regimens of VDPHL01: twice daily and once daily.  It will compare these regimens against a placebo to see if the medication promotes hair growth and improves patient satisfaction with their hair.\n\nWomen aged 18-65 with mild to moderate hair loss, as measured by the Savin Scale, are eligible to participate.  Key inclusion criteria include good general health, adequate kidney and liver function, and a commitment to maintaining consistent hair care routines throughout the study.  Women who are pregnant, breastfeeding, have certain medical conditions (like uncontrolled blood pressure or a history of heart problems), or have recently used other hair growth treatments are excluded.\n\nThe study will last approximately 13 months and consist of two parts. Part A is a 6-month placebo-controlled period, where participants are randomly assigned to one of four groups: VDPHL01 twice daily, VDPHL01 once daily plus placebo, placebo twice daily, or placebo twice daily.  Part B is a 6-month treatment extension, where those initially receiving placebo will start taking VDPHL01 according to their initial group assignment, while those already on VDPHL01 will continue.  Participants will have regular clinic visits (approximately 11) for assessments including physical exams, blood and urine tests, electrocardiograms, photographs of the scalp, and questionnaires about their hair and quality of life. A small group of participants will also take part in interviews.  A final follow-up will occur one month after the treatment period ends.\n",
                  "total_sites": 2,
                  "similarity_score": 0.8174656906579815
                },
                {
                  "id": 15,
                  "trial_name": "CIN-102-124",
                  "conditions": "Idiopathic Gastroparesis",
                  "description": null,
                  "investigator_name": "Dr. Robert Springer",
                  "site_location": "Atlanta, GA",
                  "protocol_summary": "This clinical trial aims to investigate the effectiveness and safety of CIN-102 (deudomperidone) in adults with idiopathic gastroparesis, a condition that slows the movement of food through the stomach.  Participants will receive either a placebo or one of two doses of CIN-102 (10mg or 15mg twice daily) for 12 weeks. The study's main goal is to determine if CIN-102 can reduce nausea severity compared to placebo.  Researchers will also assess changes in other gastroparesis symptoms like vomiting, fullness, early satiety, and abdominal pain.\n\nTo be eligible for the study, participants must be 18 years or older with a confirmed diagnosis of idiopathic gastroparesis, including both persistent symptoms and evidence of delayed gastric emptying.  Key exclusion criteria include having a known cause for their gastroparesis (like diabetes or surgery), certain heart conditions, specific gastrointestinal issues, or use of certain medications that could interfere with the study drug.  Women who are pregnant, breastfeeding, or planning to become pregnant are also excluded.\n\nThe study will last approximately 18 weeks, including a prescreening period, a screening and lead-in period of up to 5 weeks, a 12-week treatment period, and a follow-up period of up to 1 week.  Participants will attend up to 8 scheduled visits, including a gastric emptying breath test.  Throughout the study, they will track their symptoms daily using an electronic diary and will have regular assessments of their overall health and well-being.  Some participants may also choose to participate in additional assessments to help researchers understand how the drug is absorbed and processed by the body.",
                  "total_sites": 1,
                  "similarity_score": 0.7605316085699039
                },
                {
                  "id": 10,
                  "trial_name": "A Phase 2b, Randomized, Double-Blind, Placebo-Controlled, Multicenter Study of the Efficacy and Safety of Brensocatib in Adults with Moderate to Severe Hidradenitis Suppurativa \u2013 The CEDAR Study",
                  "conditions": "Moderate to Severe Hidradenitis Suppurativa",
                  "description": "",
                  "investigator_name": "Dr. Zachary Eyre",
                  "site_location": "Atlanta, GA",
                  "protocol_summary": "This study, called CEDAR, is investigating the effectiveness and safety of a new oral drug, brensocatib, for adults with moderate to severe hidradenitis suppurativa (HS). HS is a chronic skin condition that causes painful lumps, abscesses, and tunnels under the skin, often leaving scars.  Researchers believe brensocatib may help by reducing the activity of certain inflammatory cells involved in HS. The study aims to determine if brensocatib can reduce the number of skin lesions and improve overall skin condition in people with HS.\n\nTo be eligible for the study, participants must be between 18 and 80 years old with a confirmed HS diagnosis for at least six months. They must have at least six inflammatory lesions for at least eight weeks before joining the study and these lesions must be located in at least two different areas of the body, with at least one area having a certain level of severity (Hurley Stage II or III).  People with an excessively high number of draining tunnels or certain other skin conditions will be excluded, as will those who have recently received certain medications like systemic antibiotics (except for stable doses of doxycycline or minocycline), opioid painkillers (except tramadol), or biologic treatments for HS.\n\nThe CEDAR study is a 52-week, randomized, double-blind, placebo-controlled trial. This means participants are randomly assigned to receive either brensocatib (at a dose of 10mg or 40mg once daily) or a placebo pill. The study is divided into two treatment periods.  Period 1 lasts 16 weeks and compares brensocatib to placebo. Period 2 lasts 36 weeks, and all participants receive brensocatib (those initially on placebo will switch to either the 10mg or 40mg dose).  Throughout the study, participants will have regular visits to the clinic for assessments of their skin condition, pain levels, and overall quality of life. Blood samples will also be collected to monitor the drug's safety and measure its levels in the body.  Some participants will also be part of a sub-study involving skin tissue samples.  After the treatment periods, there is a 4-week follow-up period.",
                  "total_sites": 2,
                  "similarity_score": 0.7400376333369378
                }
              ],
              "semantic_search": true
            },
            "response_time": 19.993961095809937,
            "timestamp": "2025-12-16T05:02:32.366496"
          },
          {
            "user_message": "Yes, check my eligibility",
            "bot_response": "Great! I'll help you check your eligibility.\n\nI need to ask you a few questions about the psoriasis trial.\n\n**Question 1 of 4:** What is your age?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_002",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "start_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": "yes",
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "start_prescreening",
                "parameters": {},
                "response_text": "Great, I can help with that. I'll ask a few simple questions to see if you might be a match for these Psoriasis trials. This is just a preliminary check, and the final decision is always up to the study team.\n\nTo start, could you please tell me your age?",
                "new_state": "prescreening",
                "collect_entities": [
                  "age"
                ],
                "metadata": {
                  "reasoning": "The user has explicitly agreed to an eligibility check after being shown a list of trials. The current state is 'trials_shown', and we have the necessary condition and location. Therefore, the most appropriate action is to begin the prescreening process by asking the first eligibility question, which is typically age. The state will be updated to 'prescreening' to reflect this new phase of the conversation."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "prescreening_started": true,
              "trial_id": 14,
              "trial_name": "Clinical Trial 250-13951-306",
              "current_question_index": 0,
              "total_questions": 4,
              "current_question": "What is your age?",
              "expected_answer_type": "number"
            },
            "response_time": 17.390812158584595,
            "timestamp": "2025-12-16T05:02:49.757769"
          },
          {
            "user_message": "25",
            "bot_response": "Got it.\n\nHave you been diagnosed with mild to moderate aga with a score of i-4 by a doctor?",
            "metadata": {
              "session_id": "AUTO_TEST_targeted_psoriasis_002",
              "current_state": "prescreening_active",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "continue_prescreening",
              "entities_collected": {
                "condition": null,
                "location": null,
                "age": 25,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "continue_prescreening",
                "parameters": {
                  "last_answer": {
                    "age": 25
                  },
                  "next_question_id": "psoriasis_q3_biologics"
                },
                "response_text": "Thanks for sharing that. Next question: Have you ever been treated with a biologic medication for your psoriasis, such as Humira, Stelara, or Cosentyx?",
                "new_state": "prescreening_active",
                "collect_entities": [
                  "boolean_answer"
                ],
                "metadata": {
                  "reasoning": "The user is in an active prescreening flow (state: prescreening_active) and has provided their age in response to the previous question. The correct action is to continue the prescreening process by asking the next logical eligibility question. A question about prior biologic medication use is a common and important inclusion/exclusion criterion for psoriasis trials, making it a suitable next step to determine the user's potential eligibility."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "current_question_index": 1,
              "total_questions": 4,
              "current_question": "Have you been diagnosed with mild to moderate aga with a score of i-4 by a doctor?",
              "expected_answer_type": "yes_no",
              "parsed_answer": {
                "interpretation": "number",
                "confidence": 1.0
              }
            },
            "response_time": 22.56448197364807,
            "timestamp": "2025-12-16T05:03:12.322545"
          }
        ],
        "final_state": "failed",
        "total_turns": 3,
        "total_questions_asked": 4,
        "errors": [
          {
            "type": "timeout",
            "message": "Yes, I have Psoriasis",
            "response_time": 30.044678926467896
          },
          {
            "type": "conversation_failure",
            "error": "",
            "state": "prescreening_active",
            "timestamp": "2025-12-16T05:03:42.367802"
          }
        ]
      },
      "validation": {
        "passed": false,
        "overall_score": 30.0,
        "crash_prevention": {
          "passed": false,
          "score": 0.0,
          "error_count": 2,
          "errors": [
            {
              "type": "timeout",
              "message": "Yes, I have Psoriasis",
              "response_time": 30.044678926467896
            },
            {
              "type": "conversation_failure",
              "error": "",
              "state": "prescreening_active",
              "timestamp": "2025-12-16T05:03:42.367802"
            }
          ],
          "failures": [
            {
              "type": "crash",
              "error_type": "timeout",
              "error_message": "Unknown error",
              "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
              "severity": "critical"
            },
            {
              "type": "crash",
              "error_type": "conversation_failure",
              "error_message": "",
              "likely_location": "Unknown - check full error trace",
              "severity": "critical"
            }
          ]
        },
        "eligibility_accuracy": {
          "passed": false,
          "score": 0.0,
          "reason": "Prescreening did not complete",
          "failures": [
            {
              "type": "eligibility_logic_error",
              "reason": "Prescreening flow did not complete",
              "final_state": "failed",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
              "severity": "high"
            }
          ]
        },
        "conversation_quality": {
          "passed": true,
          "score": 100.0,
          "total_questions_asked": 4,
          "issues": [],
          "failures": []
        },
        "edge_case_handling": {
          "passed": true,
          "score": 100.0,
          "applicable": false,
          "failures": []
        },
        "performance": {
          "passed": true,
          "score": 70.0,
          "avg_response_time": 19.983085076014202,
          "max_response_time": 22.56448197364807,
          "status": "acceptable",
          "failures": []
        },
        "failure_points": [
          {
            "type": "crash",
            "error_type": "timeout",
            "error_message": "Unknown error",
            "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
            "severity": "critical"
          },
          {
            "type": "crash",
            "error_type": "conversation_failure",
            "error_message": "",
            "likely_location": "Unknown - check full error trace",
            "severity": "critical"
          },
          {
            "type": "eligibility_logic_error",
            "reason": "Prescreening flow did not complete",
            "final_state": "failed",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
            "severity": "high"
          }
        ],
        "recommendations": [
          "\ud83d\udea8 CRITICAL: Fix crashes and exceptions. Review error logs and add error handling.",
          "\u26a0\ufe0f HIGH: Review eligibility evaluation logic in gemini_prescreening_manager.py"
        ]
      },
      "timestamp": "2025-12-16T05:03:42.367954"
    },
    {
      "patient_id": "AUTO_TEST_edge_unclear_000",
      "patient_profile": {
        "patient_id": "AUTO_TEST_edge_unclear_000",
        "profile_type": "edge_case",
        "demographics": {
          "age": 50,
          "gender": "female",
          "location": "Birmingham, AL",
          "name": "Unclear Patient",
          "first_name": "Unclear",
          "last_name": "Patient"
        },
        "medical_history": {
          "primary_condition": "Hypertension",
          "conditions": [
            "Hypertension"
          ],
          "medications": [
            "Lisinopril"
          ],
          "duration_years": 5,
          "response_style": "unclear"
        },
        "expected_behavior": {
          "should_find_trials": true,
          "likely_eligible": "unclear",
          "expected_question_count_range": [
            5,
            12
          ],
          "edge_case_type": "unclear_responses",
          "should_ask_for_clarification": true
        }
      },
      "conversation_result": {
        "session_id": "AUTO_TEST_edge_unclear_000",
        "patient_id": "AUTO_TEST_edge_unclear_000",
        "conversation_log": [
          {
            "user_message": "Hypertension trials in Birmingham, AL",
            "bot_response": "I couldn't find any trials for Hypertension in Birmingham at the moment. Would you like to try a different condition or location?",
            "metadata": {
              "session_id": "AUTO_TEST_edge_unclear_000",
              "current_state": "initial",
              "handler_used": "GeminiConversationManager",
              "processing_method": "gemini_conversation_manager",
              "action_type": "search_trials",
              "entities_collected": {
                "condition": "Hypertension",
                "location": "Birmingham",
                "age": null,
                "medication": null,
                "number": null,
                "trial_name": null,
                "boolean_answer": null,
                "confidence_scores": {}
              },
              "conversation_action": {
                "action_type": "search_trials",
                "parameters": {
                  "condition": "Hypertension",
                  "location": "Birmingham"
                },
                "response_text": "Of course. I'm now searching for clinical trials for Hypertension in the Birmingham area. I'll share what I find in just a moment. If any of them look interesting, we can then check to see if you might be eligible.",
                "new_state": "trials_presented",
                "collect_entities": [],
                "metadata": {
                  "reasoning": "The user has provided both a specific condition ('Hypertension') and a location ('Birmingham'), which are the two required pieces of information to perform a trial search. The `search_trials` action is the most direct and helpful next step to fulfill their request. The response confirms the action, sets expectations, and proactively offers the next logical step (eligibility prescreening) to guide the conversation forward."
                }
              },
              "user_analysis": {
                "sentiment": "neutral",
                "communication_style": "standard",
                "complexity_preference": "moderate"
              },
              "no_trials_found": true,
              "condition": "Hypertension",
              "location": "Birmingham"
            },
            "response_time": 18.19021487236023,
            "timestamp": "2025-12-16T05:04:01.561646"
          }
        ],
        "final_state": "failed",
        "total_turns": 1,
        "total_questions_asked": 0,
        "errors": [
          {
            "type": "timeout",
            "message": "Yes, check my eligibility",
            "response_time": 30.809153079986572
          },
          {
            "type": "conversation_failure",
            "error": "",
            "state": "trials_shown",
            "timestamp": "2025-12-16T05:04:32.371017"
          }
        ]
      },
      "validation": {
        "passed": false,
        "overall_score": 19.0,
        "crash_prevention": {
          "passed": false,
          "score": 0.0,
          "error_count": 2,
          "errors": [
            {
              "type": "timeout",
              "message": "Yes, check my eligibility",
              "response_time": 30.809153079986572
            },
            {
              "type": "conversation_failure",
              "error": "",
              "state": "trials_shown",
              "timestamp": "2025-12-16T05:04:32.371017"
            }
          ],
          "failures": [
            {
              "type": "crash",
              "error_type": "timeout",
              "error_message": "Unknown error",
              "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
              "severity": "critical"
            },
            {
              "type": "crash",
              "error_type": "conversation_failure",
              "error_message": "",
              "likely_location": "Unknown - check full error trace",
              "severity": "critical"
            }
          ]
        },
        "eligibility_accuracy": {
          "passed": false,
          "score": 0.0,
          "reason": "Prescreening did not complete",
          "failures": [
            {
              "type": "eligibility_logic_error",
              "reason": "Prescreening flow did not complete",
              "final_state": "failed",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
              "severity": "high"
            }
          ]
        },
        "conversation_quality": {
          "passed": true,
          "score": 80.0,
          "total_questions_asked": 0,
          "issues": [
            "Too few questions asked (0, expected at least 5)"
          ],
          "failures": [
            {
              "type": "conversation_quality_issue",
              "issue": "Too few questions asked (0, expected at least 5)",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            }
          ]
        },
        "edge_case_handling": {
          "passed": false,
          "score": 30.0,
          "applicable": true,
          "edge_case_type": "unclear_responses",
          "completed": false,
          "failures": [
            {
              "type": "edge_case_handling_failure",
              "edge_case_type": "unclear_responses",
              "final_state": "failed",
              "reason": "Edge case caused conversation to fail",
              "severity": "medium",
              "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
            }
          ]
        },
        "performance": {
          "passed": true,
          "score": 70.0,
          "avg_response_time": 18.19021487236023,
          "max_response_time": 18.19021487236023,
          "status": "acceptable",
          "failures": []
        },
        "failure_points": [
          {
            "type": "crash",
            "error_type": "timeout",
            "error_message": "Unknown error",
            "likely_location": "aiohttp timeout in conversation_simulator.py or slow Gemini API response",
            "severity": "critical"
          },
          {
            "type": "crash",
            "error_type": "conversation_failure",
            "error_message": "",
            "likely_location": "Unknown - check full error trace",
            "severity": "critical"
          },
          {
            "type": "eligibility_logic_error",
            "reason": "Prescreening flow did not complete",
            "final_state": "failed",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py",
            "severity": "high"
          },
          {
            "type": "conversation_quality_issue",
            "issue": "Too few questions asked (0, expected at least 5)",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          },
          {
            "type": "edge_case_handling_failure",
            "edge_case_type": "unclear_responses",
            "final_state": "failed",
            "reason": "Edge case caused conversation to fail",
            "severity": "medium",
            "likely_location": "core/conversation/gemini_conversation_manager.py or core/prescreening/gemini_prescreening_manager.py"
          }
        ],
        "recommendations": [
          "\ud83d\udea8 CRITICAL: Fix crashes and exceptions. Review error logs and add error handling.",
          "\u26a0\ufe0f HIGH: Review eligibility evaluation logic in gemini_prescreening_manager.py",
          "\u26a0\ufe0f MEDIUM: Improve edge case handling. Add input validation and clarification prompts."
        ]
      },
      "timestamp": "2025-12-16T05:04:32.371405"
    }
  ]
}